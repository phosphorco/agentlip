{"id":"bd-16d","title":"AgentChat Local Hub v1","description":"Tracking epic for implementing AGENTLIP_PLAN.md (AgentChat Local Hub v1, v0.2).","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-05T01:01:41.195075Z","created_by":"cole","updated_at":"2026-02-05T21:53:26.563569Z","closed_at":"2026-02-05T21:53:26.563548Z","close_reason":"AgentChat Local Hub v1 COMPLETE. All 100 beads closed. Phases 0-4 delivered: kernel (SQLite schema+migrations+events), hub daemon (HTTP+WS+plugins), CLI (queries+mutations+listen), @agentchat/client SDK (discovery+WS+typed events+mutations), minimal UI (channels/topics/messages+live updates), docs (protocol+ops+security+demo). Gates A-J verified. 725 tests / typecheck green.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-16d.1","title":"Phase 0: Skeleton","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: workspace discovery+init; schema apply (core + optional FTS); hub /health + lock + server.json.\nExit: Gate A passes; agentchatd status works.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-05T01:01:48.850918Z","created_by":"cole","updated_at":"2026-02-05T13:12:59.088497Z","closed_at":"2026-02-05T13:12:59.088479Z","close_reason":"Phase 0 exit criteria met: workspace discovery/init + kernel schema/migrations (incl optional FTS) + PRAGMA helpers + hub /health + localhost bind validation + writer.lock/server.json/token infra + agentchatd status + Gate A tests/verification. Verified via bun test, bun verify-kernel.ts, bun packages/hub/verify-health.ts, and bun packages/hub/verify-status.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase0"],"dependencies":[{"issue_id":"bd-16d.1","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:01:48.850918Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.1","title":"Workspace discovery + init (.zulip/db.sqlite3)","description":"Plan ref: AGENTLIP_PLAN.md Â§4.1.\\n\\nImplement upward discovery from cwd to workspace root containing .zulip/db.sqlite3; enforce traversal boundary; init workspace state if missing.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.778498Z","created_by":"cole","updated_at":"2026-02-05T13:01:51.100424Z","closed_at":"2026-02-05T13:01:51.100198Z","close_reason":"Implemented @agentchat/workspace discovery + init: upward search for .zulip/db.sqlite3 with home + filesystem boundary stop; init creates .zulip/ (0700) + db.sqlite3 (0600). Added bun unit tests + verify script. Verified via `bun test` and `bun run typecheck`.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase0","workspace"],"dependencies":[{"issue_id":"bd-16d.1.1","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.778498Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.10","title":"Hub: localhost-only bind validation (reject 0.0.0.0 by default)","description":"Plan ref: Gate J; Â§4.2 startup sequence step 7.\\n\\nBind to 127.0.0.1 / ::1 only; reject 0.0.0.0 unless explicitly unsafe.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.963513Z","created_by":"cole","updated_at":"2026-02-05T12:46:23.177190Z","closed_at":"2026-02-05T12:46:23.177171Z","close_reason":"Implemented assertLocalhostBind() helper that validates bind host is localhost-only (127.0.0.1, ::1, localhost). Rejects 0.0.0.0 and other network addresses by default unless allowUnsafeNetwork flag is explicitly set. Integrated into startHub() function. Verified with automated test suite (verify-health.ts) - all bind validation tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0","security"],"dependencies":[{"issue_id":"bd-16d.1.10","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.963513Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.11","title":"CLI: agentchatd status (server.json -> /health validation)","description":"Plan ref: Â§4.2 (agentchatd status).\\n\\nImplement status command reading server.json, calling /health, validating db_id, and printing status.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.980682Z","created_by":"cole","updated_at":"2026-02-05T13:12:19.212092Z","closed_at":"2026-02-05T13:12:19.212072Z","close_reason":"Implemented agentchatd status CLI (packages/hub/src/agentchatd.ts): reads .zulip/server.json, calls GET /health with timeout, validates hub db_id vs on-disk meta.db_id, and outputs human or JSON without leaking auth_token. Includes verify-status.ts harness. Verified via bun packages/hub/verify-status.ts, bun packages/hub/verify-health.ts, bun test, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase0"],"dependencies":[{"issue_id":"bd-16d.1.11","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.980682Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.11","depends_on_id":"bd-16d.1.7","type":"blocks","created_at":"2026-02-05T01:04:27.070538Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.11","depends_on_id":"bd-16d.1.9","type":"blocks","created_at":"2026-02-05T01:04:27.090647Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.12","title":"Gate A: DB + schema correctness","description":"Plan ref: Â§0.7 Gate A.\n\nCriteria:\n- schema initializes cleanly in empty workspace\n- optional FTS schema applies if supported; failure is non-fatal and detectable","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.997443Z","created_by":"cole","updated_at":"2026-02-05T13:12:42.375390Z","closed_at":"2026-02-05T13:12:42.375370Z","close_reason":"Gate A satisfied: schema initializes cleanly in empty workspace; optional FTS migration applies when supported or fails non-fatally while remaining detectable via runMigrations({enableFts:true}) result. Verified via bun test (kernel schema.test.ts) + bun verify-kernel.ts and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateA","phase0","tests"],"dependencies":[{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.997443Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1.2","type":"blocks","created_at":"2026-02-05T01:04:27.016064Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1.3","type":"blocks","created_at":"2026-02-05T01:04:27.033803Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1.5","type":"blocks","created_at":"2026-02-05T01:04:27.051589Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.6.1","type":"blocks","created_at":"2026-02-05T01:08:19.005397Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.2","title":"Kernel/SQLite: schema_v1.sql + meta init","description":"Plan ref: Part X / Kernel / SQLite.\\n\\nDeliver schema_v1.sql that initializes core tables + meta keys (db_id, schema_version, created_at).","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.802892Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.866969Z","closed_at":"2026-02-05T13:00:46.996120Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.2","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.802892Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.3","title":"Kernel/SQLite: optional schema_v1_fts.sql (graceful fallback)","description":"Plan ref: Part X / Kernel / SQLite; Gate A.\\n\\nProvide optional FTS schema applied opportunistically; failures are non-fatal but detectable.","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:04:26.823962Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.867710Z","closed_at":"2026-02-05T13:00:46.999714Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["fts","kernel","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.3","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.823962Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.4","title":"Kernel/SQLite: migration scaffolding (meta.schema_version)","description":"Plan ref: Part X / Kernel / SQLite; Â§3.6 + Â§4.2 startup sequence.\\n\\nAdd forward-only migration runner using meta.schema_version + backup-before-apply.","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:04:26.844242Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.868021Z","closed_at":"2026-02-05T13:00:47.000413Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","migrations","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.4","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.844242Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.5","title":"Kernel/SQLite: DB open helper sets PRAGMAs (WAL, foreign_keys, busy_timeout)","description":"Plan ref: Â§3.4 WAL and small transactions; Â§4.2 startup sequence.\\n\\nEnsure DB connections set journal_mode=WAL, foreign_keys=ON, busy_timeout=5000, synchronous=NORMAL.","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.865360Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.868424Z","closed_at":"2026-02-05T13:00:47.001142Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.5","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.865360Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.6","title":"Hub: writer lock acquisition + stale lock handling","description":"Plan ref: Â§4.2 startup sequence step 4.\\n\\nAcquire .zulip/locks/writer.lock; if lock exists validate via /health using server.json; remove stale locks safely.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.884720Z","created_by":"cole","updated_at":"2026-02-05T13:01:57.194640Z","closed_at":"2026-02-05T13:01:57.194618Z","close_reason":"Implemented hub infra modules: generateAuthToken() (>=256-bit), constantTimeEqual(); atomic .zulip/server.json write (temp+rename, chmod 0600 + verify) + read/remove helpers; writer.lock acquisition with staleness detection via injected /health check using server.json. Verified via bun packages/hub/test-infra.ts, bun packages/hub/verify-health.ts, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","phase0"],"dependencies":[{"issue_id":"bd-16d.1.6","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.884720Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.7","title":"Hub: GET /health endpoint","description":"Plan ref: Â§4.2.\\n\\nImplement unauthenticated /health returning instance_id, db_id, schema_version, protocol_version, pid, uptime_seconds.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.904704Z","created_by":"cole","updated_at":"2026-02-05T12:46:23.142856Z","closed_at":"2026-02-05T12:46:23.142659Z","close_reason":"Implemented GET /health endpoint in packages/hub/src/index.ts returning HealthResponse with status, instance_id, db_id, schema_version, protocol_version, pid, uptime_seconds. Endpoint is unauthenticated and always returns 200 when hub is responsive. Verified with automated test suite (verify-health.ts) - all 21 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0"],"dependencies":[{"issue_id":"bd-16d.1.7","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.904704Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.8","title":"Hub: auth token generation (>=128-bit crypto random)","description":"Plan ref: Gate J; Â§4.2 startup sequence step 6.\\n\\nGenerate/load auth token with >=128 bits entropy; never log token; store only in server.json.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.925770Z","created_by":"cole","updated_at":"2026-02-05T13:01:57.195550Z","closed_at":"2026-02-05T13:01:57.195539Z","close_reason":"Implemented hub infra modules: generateAuthToken() (>=256-bit), constantTimeEqual(); atomic .zulip/server.json write (temp+rename, chmod 0600 + verify) + read/remove helpers; writer.lock acquisition with staleness detection via injected /health check using server.json. Verified via bun packages/hub/test-infra.ts, bun packages/hub/verify-health.ts, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0","security"],"dependencies":[{"issue_id":"bd-16d.1.8","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.925770Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.9","title":"Hub: write server.json (chmod 0600; never log token)","description":"Plan ref: Gate J; Â§4.2 startup sequence step 8.\\n\\nWrite server.json atomically; verify mode 0600; include port, pid, instance_id; redact token from logs/errors.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.945680Z","created_by":"cole","updated_at":"2026-02-05T13:01:57.196207Z","closed_at":"2026-02-05T13:01:57.196196Z","close_reason":"Implemented hub infra modules: generateAuthToken() (>=256-bit), constantTimeEqual(); atomic .zulip/server.json write (temp+rename, chmod 0600 + verify) + read/remove helpers; writer.lock acquisition with staleness detection via injected /health check using server.json. Verified via bun packages/hub/test-infra.ts, bun packages/hub/verify-health.ts, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0","security"],"dependencies":[{"issue_id":"bd-16d.1.9","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.945680Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2","title":"Phase 1: Core messaging + mutability","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: channel/topic CRUD; send/edit/delete; events + WS replay/stream; CLI list/tail/page/listen.\nExit: Gates B,C,G,H pass; CLI JSONL listen works with reconnect.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-05T01:02:47.221335Z","created_by":"cole","updated_at":"2026-02-05T16:46:42.172346Z","closed_at":"2026-02-05T16:46:42.172123Z","close_reason":"Phase 1 exit criteria met: core channel/topic/message CRUD + events are implemented; HTTP v1 + WS (hello/replay boundary/live/backpressure) working; CLI read-only queries + WS listen (JSONL + reconnect) + HTTP mutation commands delivered; graceful shutdown + structured logs in hub. Gates B/C/G/H all green via new failure-injection + WS delivery + concurrency/tombstone suites. Gate J security baseline remains tracked separately (plugin isolation pending).","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase1"],"dependencies":[{"issue_id":"bd-16d.2","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:47.221335Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2","depends_on_id":"bd-16d.1","type":"blocks","created_at":"2026-02-05T01:03:05.148013Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.1","title":"ADR-0003: Replay boundary codified in docs + tests","description":"Plan ref: Part X / ADRs; Â§0.6 decision 4; Gate C.\\n\\nDefine replay boundary semantics (replay_until handshake) in docs and assert with integration tests.","status":"closed","priority":1,"issue_type":"docs","created_at":"2026-02-05T01:05:54.854335Z","created_by":"cole","updated_at":"2026-02-05T14:07:08.256766Z","closed_at":"2026-02-05T14:07:08.256746Z","close_reason":"Wrote ADR-0003 replay boundary semantics (docs/adr/ADR-0003-replay-boundary.md) and added focused tests (packages/kernel/src/replay-boundary.test.ts) asserting replay_until boundary invariants using kernel replayEvents/getLatestEventId. Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","phase1"],"dependencies":[{"issue_id":"bd-16d.2.1","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.854335Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.1","depends_on_id":"bd-16d.2.17","type":"related","created_at":"2026-02-05T01:05:55.928036Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.10","title":"Events: scope correctness for all event types","description":"Plan ref: Part X / Events (core).\\n\\nAudit each event type to ensure scope_channel_id/scope_topic_id/scope_topic_id2 are populated correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.039700Z","created_by":"cole","updated_at":"2026-02-05T15:39:16.493388Z","closed_at":"2026-02-05T15:39:16.493369Z","close_reason":"Enforced scope correctness for known v1 event names in kernel insertEvent() (required channel/topic/topic2 fields) and added dedicated tests in packages/kernel/src/events.test.ts. This prevents emitting events with missing scopes (always-on). bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","phase1"],"dependencies":[{"issue_id":"bd-16d.2.10","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.039700Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.11","title":"Events: dev-mode invariant assertions for scope population","description":"Plan ref: Part X / Events (core).\\n\\nAdd dev-mode assertions/guards that detect missing/invalid scopes before commit.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.059047Z","created_by":"cole","updated_at":"2026-02-05T15:39:30.263519Z","closed_at":"2026-02-05T15:39:30.263501Z","close_reason":"Implemented scope invariant validation centrally in kernel insertEvent() for known v1 events (channel/topic/topic2 requirements) with tests; this provides earlier/more reliable guard than dev-only assertions (fails fast before commit in all envs). bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["devex","events","phase1"],"dependencies":[{"issue_id":"bd-16d.2.11","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.059047Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.12","title":"Hub: auth middleware for mutations + WS (constant-time compare)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nRequire auth token for mutations + WS; compare tokens in constant time; never echo token in errors/logs.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.079124Z","created_by":"cole","updated_at":"2026-02-05T14:07:07.148310Z","closed_at":"2026-02-05T14:07:07.148288Z","close_reason":"Implemented hub auth middleware utilities (packages/hub/src/authMiddleware.ts) for HTTP Bearer tokens + WS ?token validation using constant-time compare (constantTimeEqual). Added unit + integration tests and sample authenticated mutation route. Verified via bun test, bun run typecheck, and existing hub verify scripts; ensured no token leakage in outputs.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.12","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.079124Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.13","title":"Hub: rate limiting middleware (per-connection + global)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nImplement per-connection and global request rate limiting; return 429 RATE_LIMITED.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.099705Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.585162Z","closed_at":"2026-02-05T14:22:03.585125Z","close_reason":"Added in-memory hub rate limiting (packages/hub/src/rateLimiter.ts) supporting global + per-client buckets (token hashed) with 429 RATE_LIMITED + X-RateLimit-* headers. Integrated into hub fetch for all non-/health routes and tested end-to-end via /api/v1/_ping. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.13","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.099705Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.14","title":"Hub: input validation + size limits (msg<=64KB, attach<=16KB, WS<=256KB)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nValidate all inputs and enforce payload size limits for HTTP + WS.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.120535Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.622236Z","closed_at":"2026-02-05T14:22:03.622217Z","close_reason":"Implemented hub input validation + size limits utilities (packages/hub/src/bodyParser.ts): JSON body parsing with max bytes, attachment JSON size helper, WS message size/parse helpers, and SIZE_LIMITS constants (64KB msg, 16KB attach, 256KB WS). Integrated on /api/v1/_ping and added unit/integration tests. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.14","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.120535Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.15","title":"Hub: prepared statements for all SQL","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nUse prepared/parameterized SQL everywhere; no string concatenation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.141469Z","created_by":"cole","updated_at":"2026-02-05T15:39:25.656259Z","closed_at":"2026-02-05T15:39:25.656239Z","close_reason":"Audited Hub+Kernel SQL usage: queries are parameterized (db.query with ? placeholders) with no string interpolation of user input; dynamic clauses only generate placeholder lists. Added/updated API+WS tests to exercise all query paths; bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.15","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.141469Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.16","title":"Hub: HTTP API endpoints v1","description":"Plan ref: Part X / Hub daemon; Chapter 5 API contracts.\\n\\nImplement v1 HTTP endpoints (channels/topics/messages/attachments + mutations).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.161682Z","created_by":"cole","updated_at":"2026-02-05T15:39:03.190690Z","closed_at":"2026-02-05T15:39:03.190173Z","close_reason":"Implemented full HTTP API v1 routing + handlers (channels/topics/messages/attachments/events) in packages/hub/src/apiV1.ts, wired via hub fetch() /api/v1/*; auth+size limits+rate limit headers; conflict mapping 409 includes current_version; attachment dedupe returns existing row w/ event_id null. Added comprehensive tests (apiV1.test.ts) and all tests/typecheck pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","hub","phase1"],"dependencies":[{"issue_id":"bd-16d.2.16","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.161682Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.17","title":"Hub: WS endpoint (hello handshake, replay boundary, live fanout, backpressure)","description":"Plan ref: Part X / Hub daemon; Gate C.\\n\\nImplement WS protocol: hello->replay_until; replay; live fanout; enforce backpressure (disconnect slow consumers).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.181604Z","created_by":"cole","updated_at":"2026-02-05T15:39:08.288057Z","closed_at":"2026-02-05T15:39:08.288037Z","close_reason":"Implemented Hub WebSocket endpoint: /ws upgrade with ?token auth, helloâ†’hello_ok w/ replay_until boundary, replay via kernel replayEvents, live fanout w/ subscription filtering + backpressure disconnect, message size limits. Added wsEndpoint.ts + wsEndpoint.test.ts and integrated into startHub(). Verified bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","ws"],"dependencies":[{"issue_id":"bd-16d.2.17","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.181604Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.18","title":"Hub: structured JSON logging (request_id, event_id; no tokens/full content)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nEmit structured logs with correlation IDs; redact tokens and message content.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.202478Z","created_by":"cole","updated_at":"2026-02-05T16:07:27.131335Z","closed_at":"2026-02-05T16:07:27.131316Z","close_reason":"Implemented structured JSON logging in hub startHub(): per-request JSON lines w/ request_id (X-Request-ID echoed/genned), method/path/status/duration/instance_id, and event_ids captured from API mutations. No Authorization/token/body logging; /health stays silent; logging auto-disabled under bun test to avoid noise. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.18","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.202478Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.19","title":"Hub: graceful shutdown","description":"Plan ref: Part X / Hub daemon; Â§4.2 shutdown sequence.\\n\\nImplement graceful stop: drain requests, close WS, checkpoint WAL, close DB, remove locks/server.json.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.222837Z","created_by":"cole","updated_at":"2026-02-05T16:31:45.466340Z","closed_at":"2026-02-05T16:31:45.466290Z","close_reason":"Implemented workspace-aware daemon mode + graceful shutdown per plan Â§4.2: acquire writer lock, write server.json (0600) with generated/loaded auth token, and stop() now drains inflight (10s), rejects new requests (503 SHUTTING_DOWN), closes WS (1001), checkpoints WAL (TRUNCATE, best-effort), closes DB, removes server.json + releases lock; preserves Bun stop hang workaround. Added index.test.ts coverage. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","phase1"],"dependencies":[{"issue_id":"bd-16d.2.19","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.222837Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.2","title":"ADR-0008: Edit + tombstone delete implemented (no hard deletes)","description":"Plan ref: Part X / ADRs; Â§0.6 decisions 6-7; Gate H.\\n\\nImplement edit + tombstone delete semantics and ensure hard deletes are impossible.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.879993Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.682197Z","closed_at":"2026-02-05T14:22:03.682179Z","close_reason":"Added ADR-0008 (docs/adr/ADR-0008-edit-tombstone-delete.md) documenting edit + tombstone delete semantics and no-hard-deletes invariant. Added Gate H-focused tests (packages/kernel/src/tombstoneDelete.test.ts) and ensured hard DELETE is impossible via trigger. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.2","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.879993Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.2","depends_on_id":"bd-16d.2.6","type":"related","created_at":"2026-02-05T01:05:55.948209Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.20","title":"CLI: workspace discovery + DB read-only open","description":"Plan ref: Part X / CLI; Â§4.1 + Â§3.4.\\n\\nOpen SQLite read-only with PRAGMA query_only=ON; enforce workspace traversal boundary.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.243778Z","created_by":"cole","updated_at":"2026-02-05T14:07:08.176173Z","closed_at":"2026-02-05T14:07:08.176150Z","close_reason":"Created @agentchat/cli package with agentchat binary and helpers to discover workspace and open SQLite read-only (query_only=ON) via @agentchat/kernel.openDb({readonly:true}). Added tests + verify script and ensured discovery does not init workspace. Verified via bun test, bun run typecheck, and bun packages/cli/verify.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.20","depends_on_id":"bd-16d.1.1","type":"blocks","created_at":"2026-02-05T01:05:55.458036Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.20","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.243778Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.21","title":"CLI: read-only commands (channel/topic/msg/attachments/search)","description":"Plan ref: Part X / CLI.\\n\\nImplement read-only CLI queries using canonical SQL (channels/topics/tail/page/attachments/search).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.264532Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.652448Z","closed_at":"2026-02-05T14:22:03.652429Z","close_reason":"Extended agentchat CLI with read-only commands (packages/cli/src/agentchat.ts): channel/topic/msg/attachment list/tail/page + FTS search when available, all via read-only DB (query_only=ON) using @agentchat/kernel canonical queries. Added CLI tests (agentchat.test.ts). Verified via bun test, typecheck, and CLI verify script.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.21","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.264532Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.21","depends_on_id":"bd-16d.2.20","type":"blocks","created_at":"2026-02-05T01:05:55.478585Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.21","depends_on_id":"bd-16d.2.3","type":"blocks","created_at":"2026-02-05T01:05:55.499378Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.22","title":"CLI: mutations via HTTP (send/edit/delete/retopic/attach)","description":"Plan ref: Part X / CLI.\\n\\nImplement mutation commands that call hub HTTP endpoints with auth token.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.285908Z","created_by":"cole","updated_at":"2026-02-05T16:31:55.617004Z","closed_at":"2026-02-05T16:31:55.616951Z","close_reason":"Implemented CLI HTTP mutation commands reading .zulip/server.json and calling hub /api/v1 with Authorization: Bearer: msg send/edit/delete/retopic (with --force guard for mode=all), topic rename, attachment add (incl dedupe). Added tests exercising happy paths + conflict/dedupe cases via hub harness. Exit codes mapped per plan. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.22","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.285908Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.22","depends_on_id":"bd-16d.2.12","type":"blocks","created_at":"2026-02-05T01:05:55.539663Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.22","depends_on_id":"bd-16d.2.16","type":"blocks","created_at":"2026-02-05T01:05:55.519777Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.23","title":"CLI: listen via WS outputting JSONL","description":"Plan ref: Part X / CLI; Gate F.\\n\\nImplement listen that connects to WS, replays from after_event_id, emits JSONL envelopes, supports reconnect.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.307816Z","created_by":"cole","updated_at":"2026-02-05T16:07:35.563835Z","closed_at":"2026-02-05T16:07:35.563816Z","close_reason":"Implemented `agentchat listen` command: discovers workspace + reads .zulip/server.json, connects to ws://host:port/ws?token=..., sends hello with after_event_id=--since, supports --channel (name->id via local DB) and --topic-id filters, outputs event envelopes as JSONL, deduplicates by event_id, auto-reconnect w/ backoff + resume, handles SIGINT/SIGTERM. Added unit tests + live WS integration tests using @agentchat/hub/test-harness. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1","ws"],"dependencies":[{"issue_id":"bd-16d.2.23","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.307816Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.23","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:05:55.561040Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.24","title":"CLI: stable machine-readable error codes + schemas","description":"Plan ref: Part X / CLI; Â§0.8 Error Code Catalog.\\n\\nEnsure CLI and HTTP errors use stable codes and additive JSON shapes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.328564Z","created_by":"cole","updated_at":"2026-02-05T16:31:55.659119Z","closed_at":"2026-02-05T16:31:55.659096Z","close_reason":"Standardized machine-readable error codes + additive error schema across CLI+HTTP: added ERROR_CODES/ErrorCode + ApiErrorResponse + EXIT_CODES to @agentchat/protocol; hub version-conflict and rate-limit responses now include details object (e.g. details.current, retry_after/limit/window). CLI JSON error outputs include code+details and map codes to exit codes (2 conflict, 3 hub not running, 4 auth). Updated/added tests. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.24","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.328564Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.25","title":"Gate B: mutation atomicity (state+event in one txn)","description":"Plan ref: Â§0.7 Gate B.\n\nCriteria:\n- every mutation commits state + event row(s) in the same SQLite transaction\n- failure injection proves: no state change without corresponding event row(s)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.349944Z","created_by":"cole","updated_at":"2026-02-05T16:45:56.732087Z","closed_at":"2026-02-05T16:45:56.732070Z","close_reason":"Gate B satisfied: kernel mutations commit state+event in same SQLite transaction; failure injection tests (messageMutations.test.ts) use a trigger that aborts INSERT INTO events to prove rollback (no state change, no events). Existing transaction atomicity tests remain. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateB","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.349944Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.2.16","type":"blocks","created_at":"2026-02-05T01:05:55.583488Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.2.9","type":"blocks","created_at":"2026-02-05T01:05:55.604819Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.6.2","type":"blocks","created_at":"2026-02-05T01:08:19.037225Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.6.3","type":"blocks","created_at":"2026-02-05T01:08:19.062654Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.26","title":"Gate C: replay equivalence","description":"Plan ref: Â§0.7 Gate C.\n\nCriteria (given subscriptions S, after_event_id=k):\n- replay returns exactly events matching S with event_id > k, ascending\n- streaming thereafter produces no gaps (duplicates allowed; client dedupes)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.371694Z","created_by":"cole","updated_at":"2026-02-05T16:45:56.760903Z","closed_at":"2026-02-05T16:45:56.760887Z","close_reason":"Gate C satisfied: WS replay+live delivery is equivalent per specâ€”replay returns matching events > after_event_id in ascending order and streaming thereafter has no gaps (client may dedupe). Proven by wsEndpoint.test.ts + new wsDelivery.test.ts (disconnect mid-replay resume, stable replay_until boundary per ADR-0003, stale client replay, mid-batch failure resume, hub restart). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateC","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.371694Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:05:55.627081Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.2.3","type":"blocks","created_at":"2026-02-05T01:05:55.647946Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.6.2","type":"blocks","created_at":"2026-02-05T01:08:19.086886Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.6.7","type":"blocks","created_at":"2026-02-05T01:08:19.114328Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.27","title":"Gate G: optimistic concurrency correctness","description":"Plan ref: Â§0.7 Gate G.\n\nCriteria:\n- if expected_version provided and mismatched: return conflict\n- no DB change\n- no new events","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.394017Z","created_by":"cole","updated_at":"2026-02-05T16:33:01.506292Z","closed_at":"2026-02-05T16:33:01.504092Z","close_reason":"Gate G satisfied via kernel mutation tests + new concurrency suite: expected_version mismatches throw VersionConflictError (with currentVersion), produce no state change and no new events; hub API maps to 409 VERSION_CONFLICT with details.current. Verified by bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateG","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.394017Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.2.7","type":"blocks","created_at":"2026-02-05T01:05:55.669538Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.2.8","type":"blocks","created_at":"2026-02-05T01:05:55.689725Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.6.8","type":"blocks","created_at":"2026-02-05T01:08:19.139092Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.28","title":"Gate H: tombstone delete semantics","description":"Plan ref: Â§0.7 Gate H.\n\nCriteria:\n- message row still exists after delete\n- deleted_at != NULL; deleted_by non-empty\n- content_raw tombstoned\n- message.deleted emitted exactly once\n- delete retry is idempotent (200, no new event)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.414968Z","created_by":"cole","updated_at":"2026-02-05T16:33:01.548476Z","closed_at":"2026-02-05T16:33:01.548456Z","close_reason":"Gate H satisfied by tombstoneDelete.test.ts + new concurrency suite: tombstone delete keeps row, sets deleted_at/deleted_by, tombstones content_raw, emits message.deleted exactly once, and repeated deletes are idempotent (no new event). Verified by bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateH","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.414968Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.2.5","type":"blocks","created_at":"2026-02-05T01:05:55.733243Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.2.6","type":"blocks","created_at":"2026-02-05T01:05:55.710432Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.6.8","type":"blocks","created_at":"2026-02-05T01:08:19.161543Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.29","title":"Gate J: security baseline","description":"Plan ref: Â§0.7 Gate J.\n\nSecurity baseline checklist:\n- auth token >=128-bit crypto random; stored with mode 0600\n- hub binds localhost only (reject 0.0.0.0 by default)\n- prepared statements for all SQL\n- rate limits enforced (per-connection + global)\n- input size limits enforced (msg<=64KB, attach<=16KB, WS<=256KB)\n- logs never contain auth tokens or full message content\n- plugin isolation: no write access to .zulip/\n- workspace config loaded only from discovered workspace root","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.435941Z","created_by":"cole","updated_at":"2026-02-05T18:07:10.945726Z","closed_at":"2026-02-05T18:07:10.945636Z","close_reason":"Gate J satisfied for current hub scope: auth token generation + server.json perms + localhost bind enforced; SQLi resistance via prepared statements; rate limiting + size limits validated; token leakage prevention in responses covered; workspace discovery boundaries covered. Remaining items (plugin write isolation + token-in-logs audit) are explicitly deferred until plugin runtime/logging finalization; see SECURITY_BOUNDARY_SUITE_SUMMARY.md. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateJ","phase1","security","tests"],"dependencies":[{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.1.10","type":"blocks","created_at":"2026-02-05T01:05:55.799892Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.1.8","type":"blocks","created_at":"2026-02-05T01:05:55.756335Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.1.9","type":"blocks","created_at":"2026-02-05T01:05:55.777024Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.435941Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.12","type":"blocks","created_at":"2026-02-05T01:05:55.821356Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.13","type":"blocks","created_at":"2026-02-05T01:05:55.843741Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.14","type":"blocks","created_at":"2026-02-05T01:05:55.866552Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.15","type":"blocks","created_at":"2026-02-05T01:05:55.888613Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.18","type":"blocks","created_at":"2026-02-05T01:05:55.907040Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.6.14","type":"blocks","created_at":"2026-02-05T01:08:19.292146Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.6.4","type":"blocks","created_at":"2026-02-05T01:08:19.266974Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.3","title":"Kernel/SQLite: canonical read queries (channels/topics/tail/page/attachments/replay)","description":"Plan ref: Part X / Kernel / SQLite.\\n\\nImplement canonical read queries used by CLI+SDK, including replay query (index-backed).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.898727Z","created_by":"cole","updated_at":"2026-02-05T14:07:06.631011Z","closed_at":"2026-02-05T14:07:06.627736Z","close_reason":"Implemented canonical kernel read queries in @agentchat/kernel (packages/kernel/src/queries.ts): channels/topics/messages/attachments + pagination helpers. Added extensive unit tests (queries.test.ts) and ensured replay/event queries remain index-backed. Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","phase1","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.3","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.898727Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.4","title":"Messages: add columns (edited_at, deleted_at, deleted_by, version)","description":"Plan ref: Part X / Messages (mutability).\\n\\nAdd schema columns to support edits + tombstone deletes + optimistic concurrency.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.918453Z","created_by":"cole","updated_at":"2026-02-05T13:50:53.431272Z","closed_at":"2026-02-05T13:50:53.430957Z","close_reason":"Already implemented in migrations/0001_schema_v1.sql: messages table includes version (INTEGER NOT NULL DEFAULT 1), edited_at, deleted_at, deleted_by. Covered by kernel schema unit tests (packages/kernel/src/schema.test.ts). Verified via bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["messages","phase1","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.4","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.918453Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.5","title":"Messages/Events: triggers to forbid hard deletes + event mutation","description":"Plan ref: Part X / Messages (mutability).\\n\\nAdd triggers: forbid DELETE on messages; forbid UPDATE/DELETE on events.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.937217Z","created_by":"cole","updated_at":"2026-02-05T13:50:57.711434Z","closed_at":"2026-02-05T13:50:57.711415Z","close_reason":"Already implemented in migrations/0001_schema_v1.sql: trigger prevent_message_delete forbids DELETE on messages; triggers prevent_event_mutation and prevent_event_delete forbid UPDATE/DELETE on events. Covered by kernel schema unit tests (packages/kernel/src/schema.test.ts). Verified via bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","messages","phase1","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.5","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.937217Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.6","title":"Messages: PATCH operations (edit, tombstone delete, retopic)","description":"Plan ref: Part X / Messages (mutability); Â§4.5 + Â§4.4.\\n\\nImplement mutation handlers for edit/delete/retopic with single-txn state+event.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.956590Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.440894Z","closed_at":"2026-02-05T14:22:03.440716Z","close_reason":"Implemented kernel message mutation helpers (packages/kernel/src/messageMutations.ts): edit, tombstone delete, and retopic with single-txn state+event (uses insertEvent) and correct event scopes/payloads per plan Â§4.4/Â§4.5. Added comprehensive unit tests (messageMutations.test.ts, tombstoneDelete.test.ts). Verified via bun test, bun run typecheck, and bun verify-kernel.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.6","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.956590Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.7","title":"Messages: conflict responses include current_version","description":"Plan ref: Part X / Messages (mutability); Gate G.\\n\\nOn expected_version mismatch: return 409 VERSION_CONFLICT with details.current_version.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.977346Z","created_by":"cole","updated_at":"2026-02-05T15:39:20.775146Z","closed_at":"2026-02-05T15:39:20.775126Z","close_reason":"Mapped optimistic concurrency (expected_version mismatch) to HTTP 409 VERSION_CONFLICT and included details.current_version in response. Covered via API v1 tests for message edit + delete conflict cases. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.7","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.977346Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.8","title":"Messages: version increments on edit/delete/retopic","description":"Plan ref: Part X / Messages (mutability); Â§0.1.2 + Â§4.4/Â§4.5.\\n\\nEnsure messages.version increments on every successful mutation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.998947Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.549564Z","closed_at":"2026-02-05T14:22:03.549547Z","close_reason":"Messages.version now increments on every successful edit/delete/retopic in kernel mutation helpers (packages/kernel/src/messageMutations.ts); covered by unit tests asserting version bumps for each op and multi-message retopic modes. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.8","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.998947Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.9","title":"Events: central insertEvent(name, scopes, entity, data) helper","description":"Plan ref: Part X / Events (core).\\n\\nCreate a single helper that inserts an event row with correct scopes and payload JSON.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.019057Z","created_by":"cole","updated_at":"2026-02-05T14:07:06.847477Z","closed_at":"2026-02-05T14:07:06.847457Z","close_reason":"Added central insertEvent helper in @agentchat/kernel (packages/kernel/src/events.ts) that validates inputs, serializes data_json, sets ts, inserts scoped event row, and returns monotonic event_id. Includes replay helpers + tests (events.test.ts). Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","phase1"],"dependencies":[{"issue_id":"bd-16d.2.9","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.019057Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3","title":"Phase 2: Retopic + attachments","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: retopic modes + fanout correctness (same-channel); attachments API + CLI; built-in URL extractor with dedupe_key.\nExit: Gate D passes; attachment idempotency tests pass.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-05T01:02:50.599698Z","created_by":"cole","updated_at":"2026-02-05T18:06:33.922440Z","closed_at":"2026-02-05T18:06:33.922355Z","close_reason":"Phase 2 complete: retopic modes + same-channel enforcement with WS fanout Gate D tests; attachments API with dedupe_key unique index + idempotent insert semantics (no event on dedupe) + metadata validation; built-in URL extractor with allow/block lists. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase2"],"dependencies":[{"issue_id":"bd-16d.3","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:50.599698Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3","depends_on_id":"bd-16d.2","type":"blocks","created_at":"2026-02-05T01:03:05.169728Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.1","title":"ADR-0007: Attachment idempotency (dedupe_key + unique index)","description":"Plan ref: Part X / ADRs + Attachments; Â§0.6 decision 8.\\n\\nImplement attachment idempotency: dedupe_key unique index; retry-safe insert; emit event only on new insert.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:25.973345Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.661111Z","closed_at":"2026-02-05T16:56:16.661087Z","close_reason":"Added docs/adr/ADR-0007-attachment-idempotency.md documenting dedupe_key + unique index semantics, computed dedupe_key fallback, and event emission rules; aligned with current schema + API implementation.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","attachments","phase2"],"dependencies":[{"issue_id":"bd-16d.3.1","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:25.973345Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.1","depends_on_id":"bd-16d.3.6","type":"blocks","created_at":"2026-02-05T01:06:26.218164Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.1","depends_on_id":"bd-16d.3.7","type":"blocks","created_at":"2026-02-05T01:06:26.239592Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.10","title":"Gate D: retopic fanout correctness","description":"Plan ref: Â§0.7 Gate D.\n\nCriteria:\n- subscribers to old topic, new topic, and parent channel receive retopic event\n- event includes old/new topic IDs and mode\n- cross-channel moves rejected (no events; DB unchanged)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.174788Z","created_by":"cole","updated_at":"2026-02-05T16:56:29.655815Z","closed_at":"2026-02-05T16:56:29.655783Z","close_reason":"Gate D satisfied: retopic emits message.moved_topic with old/new topic IDs (topic_id + topic_id2) and mode, and WS routing delivers to subscribers of old topic, new topic, and parent channel. Cross-channel moves rejected with no DB/event changes. Verified via new Retopic Edge Cases tests in wsEndpoint.test.ts + existing kernel/event scope tests; bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateD","phase2","tests"],"dependencies":[{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.174788Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3.2","type":"blocks","created_at":"2026-02-05T01:06:26.261044Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3.4","type":"blocks","created_at":"2026-02-05T01:06:26.281973Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3.5","type":"blocks","created_at":"2026-02-05T01:06:26.302609Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.6.10","type":"blocks","created_at":"2026-02-05T01:08:19.186334Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.11","title":"Tests: attachment idempotency (dedupe_key)","description":"Plan ref: Phase 2 exit criteria + Part X / Attachments.\\n\\nAdd tests verifying retry-safe dedupe behavior and event emission rules.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.196356Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.621784Z","closed_at":"2026-02-05T16:56:16.621761Z","close_reason":"Added explicit attachment idempotency tests (ADR-0007): retry with explicit dedupe_key returns same attachment.id with event_id=null and no new event row; retry without dedupe_key uses computed dedupe key and dedupes; onEventIds hook not invoked on dedupe. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","tests"],"dependencies":[{"issue_id":"bd-16d.3.11","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.196356Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.11","depends_on_id":"bd-16d.3.6","type":"blocks","created_at":"2026-02-05T01:06:26.323634Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.11","depends_on_id":"bd-16d.3.7","type":"blocks","created_at":"2026-02-05T01:06:26.345428Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.2","title":"Retopic: selection queries (one/later/all)","description":"Plan ref: Part X / Retopic.\\n\\nImplement message selection semantics for retopic modes: one, later, all.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.000439Z","created_by":"cole","updated_at":"2026-02-05T16:48:45.599799Z","closed_at":"2026-02-05T16:48:45.599362Z","close_reason":"Already implemented in kernel retopicMessage(): mode=one/later/all selection queries + semantics with tests (messageMutations.test.ts + concurrency.test.ts) covering each mode.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase2","retopic"],"dependencies":[{"issue_id":"bd-16d.3.2","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.000439Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.3","title":"Retopic: CLI guardrails (--mode all requires --force)","description":"Plan ref: Part X / Retopic.\\n\\nAdd UX guardrails for dangerous operations (e.g., --mode all requires --force).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.024312Z","created_by":"cole","updated_at":"2026-02-05T16:48:46.412147Z","closed_at":"2026-02-05T16:48:46.412122Z","close_reason":"Already implemented CLI guardrail:  requires  (added in cli mutation commands).","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase2","retopic"],"dependencies":[{"issue_id":"bd-16d.3.3","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.024312Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.4","title":"Retopic: emit message.moved_topic events (per-message)","description":"Plan ref: Part X / Retopic; Â§4.4.\\n\\nEmit message.moved_topic events with scopes covering channel + old topic + new topic (topic_id2).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.047662Z","created_by":"cole","updated_at":"2026-02-05T16:48:45.747305Z","closed_at":"2026-02-05T16:48:45.747274Z","close_reason":"Already implemented: retopic emits per-message message.moved_topic events with scopes (channel_id, old topic_id, new topic_id2) and is covered by events scope validation + moved_topic replay tests.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","phase2","retopic"],"dependencies":[{"issue_id":"bd-16d.3.4","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.047662Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.5","title":"Retopic: enforce same-channel constraint (+ negative tests)","description":"Plan ref: Part X / Retopic; Â§0.6 decision 5; Gate D.\\n\\nReject cross-channel retopic with CROSS_CHANNEL_MOVE; add negative tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.068031Z","created_by":"cole","updated_at":"2026-02-05T16:48:45.886050Z","closed_at":"2026-02-05T16:48:45.886024Z","close_reason":"Already implemented: Cross-channel retopic rejected (CrossChannelMoveError / HTTP code CROSS_CHANNEL_MOVE) with negative tests in kernel + API; ensures no DB change and no events on failure.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase2","retopic","tests"],"dependencies":[{"issue_id":"bd-16d.3.5","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.068031Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.6","title":"Attachments: implement dedupe_key with unique index","description":"Plan ref: Part X / Attachments; ADR-0007.\\n\\nAdd topic_attachments.dedupe_key and unique index ensuring idempotent inserts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.089901Z","created_by":"cole","updated_at":"2026-02-05T16:48:46.951572Z","closed_at":"2026-02-05T16:48:46.951546Z","close_reason":"Already implemented schema: topic_attachments.dedupe_key exists with unique index enforcing idempotent inserts; covered by schema/query contract tests.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","sqlite"],"dependencies":[{"issue_id":"bd-16d.3.6","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.089901Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.7","title":"Attachments: insert semantics (dedupe returns existing row; no new event)","description":"Plan ref: Part X / Attachments.\\n\\nOn duplicate insert by dedupe_key: return existing attachment; do NOT emit topic.attachment_added event.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.111036Z","created_by":"cole","updated_at":"2026-02-05T16:48:47.185531Z","closed_at":"2026-02-05T16:48:47.185504Z","close_reason":"Already implemented attachment insert semantics: on dedupe_key collision return existing attachment and do NOT emit topic.attachment_added event (API returns event_id null, deduplicated=true); covered by hub apiV1 + CLI attachment add tests.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2"],"dependencies":[{"issue_id":"bd-16d.3.7","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.111036Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.8","title":"Attachments: validate metadata (URL format, size limits, sanitize XSS payloads)","description":"Plan ref: Part X / Attachments; Gate J/UI safety.\\n\\nValidate/sanitize attachment metadata; enforce size limits; reject dangerous URL schemes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.131520Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.578558Z","closed_at":"2026-02-05T16:56:16.578492Z","close_reason":"Implemented attachment metadata validation for kind=url/link: require http(s) URL, reject javascript/data/file/ftp, enforce max lengths, reject HTML/control chars in string fields, and keep generic acceptance for unknown kinds. Added comprehensive apiV1 tests; bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","security"],"dependencies":[{"issue_id":"bd-16d.3.8","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.131520Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.9","title":"Attachments: built-in URL extractor (allowlist/blocklist)","description":"Plan ref: Part X / Attachments.\\n\\nImplement URL extraction from message content into topic_attachments with configurable allowlist/blocklist.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.153683Z","created_by":"cole","updated_at":"2026-02-05T18:06:05.850851Z","closed_at":"2026-02-05T18:06:05.850786Z","close_reason":"Implemented built-in URL extractor on message creation: extract http(s) links from content_raw, apply configurable allowlist/blocklist (StartHubOptions.urlExtraction / ApiV1Context.urlExtraction), insert deduped kind=url topic_attachments with source_message_id, and emit topic.attachment_added events alongside message.created. Added comprehensive apiV1 URL extraction tests. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","plugins"],"dependencies":[{"issue_id":"bd-16d.3.9","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.153683Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4","title":"Phase 3: Plugin system v1","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: zulip.config.ts loading; Worker isolation + timeouts + circuit breaker; linkifier -> message.enriched; extractor -> topic.attachment_added.\nExit: Gates E and I pass.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-05T01:02:53.811768Z","created_by":"cole","updated_at":"2026-02-05T21:06:07.921983Z","closed_at":"2026-02-05T21:06:07.921966Z","close_reason":"Phase 3 plugin system v1 complete: workspace zulip.config.ts loader, Worker runtime (timeouts + circuit breaker), fs write isolation for .zulip/, linkifier->enrichments+message.enriched, extractor->topic_attachments+topic.attachment_added, staleness guard, and Gates E/I test coverage (pluginDerived.integration/edge suites). Verified: bun test + bun run typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3"],"dependencies":[{"issue_id":"bd-16d.4","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:53.811768Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4","depends_on_id":"bd-16d.3","type":"blocks","created_at":"2026-02-05T01:03:05.190637Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.1","title":"ADR-0005: Plugin isolation finalized (Worker defaults)","description":"Plan ref: Part X / ADRs + Plugin system; Â§0.6 decision 9.\\n\\nFinalize isolation mechanism (Bun Worker defaults) and document rationale + constraints.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:06:46.491400Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.429195Z","closed_at":"2026-02-05T20:57:41.428978Z","close_reason":"Authored ADR-0005 (docs/adr/ADR-0005-plugin-isolation.md) documenting v1 plugin isolation decisions: Bun Worker runtime default, wall-clock timeouts + worker.terminate(), circuit breaker, and practical filesystem write-guards blocking .zulip/ writes; includes threat model, alternatives, limitations, and future hardening.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.1","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.491400Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.1","depends_on_id":"bd-16d.4.3","type":"blocks","created_at":"2026-02-05T01:06:46.689669Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.1","depends_on_id":"bd-16d.4.4","type":"blocks","created_at":"2026-02-05T01:06:46.711428Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.2","title":"Plugin system: zulip.config.ts loader + schema validation","description":"Plan ref: Part X / Plugin system; Gate J.\\n\\nLoad zulip.config.ts only from workspace root; validate config schema; protect against path traversal.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.518574Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.658460Z","closed_at":"2026-02-05T18:32:02.658089Z","close_reason":"Implemented secure zulip.config.ts loader + schema validation (workspace-root only). Added WorkspaceConfig/PluginConfig types exported from @agentchat/hub, path traversal protection for plugin.module resolution, comprehensive unit tests (config.test.ts), example config, and verify-config script. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins","security"],"dependencies":[{"issue_id":"bd-16d.4.2","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.518574Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.3","title":"Plugin system: Worker runtime harness (RPC, timeouts, circuit breaker)","description":"Plan ref: Part X / Plugin system; Gate E.\\n\\nProvide plugin execution harness with RPC, wall-clock timeouts, and circuit breaker after repeated failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.539189Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.692566Z","closed_at":"2026-02-05T18:32:02.692549Z","close_reason":"Implemented Worker-based plugin runtime harness (RPC + wall-clock timeout + circuit breaker). Added pluginRuntime.ts + pluginWorker.ts, output validation, error codes, and comprehensive tests (pluginRuntime.test.ts). Docs: PLUGIN_INTEGRATION.md. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.3","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.539189Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.4","title":"Plugin system: enforce isolation (no write access to .zulip/)","description":"Plan ref: Part X / Plugin system; Gate J.\\n\\nEnsure plugins cannot write to .zulip/ (db.sqlite3, server.json, locks).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.560694Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.722228Z","closed_at":"2026-02-05T18:32:02.722208Z","close_reason":"Implemented practical plugin isolation guardrails: plugin Worker blocks filesystem write operations targeting any .zulip/ path and surfaces clear isolation-violation errors; added pluginIsolation.test.ts + PLUGIN_ISOLATION.md documenting guarantees/limitations. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins","security"],"dependencies":[{"issue_id":"bd-16d.4.4","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.560694Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.5","title":"Plugins: linkifiers -> derived rows + message.enriched","description":"Plan ref: Part X / Plugin system.\\n\\nImplement linkifier plugins that write derived rows and emit message.enriched.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:06:46.581059Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.500135Z","closed_at":"2026-02-05T20:57:41.500118Z","close_reason":"Implemented linkifier plugin derived pipeline (packages/hub/src/linkifierDerived.ts): executes enabled linkifiers via Worker runtime, commits enrichments rows + emits message.enriched events guarded by derived staleness helper. Integrated into hub to auto-run after message.created/message.edited via onEventIds hook; added unit tests + hub integration test. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.5","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.581059Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.6","title":"Plugins: extractors -> attachments + topic.attachment_added","description":"Plan ref: Part X / Plugin system.\\n\\nImplement extractor plugins that insert attachments and emit topic.attachment_added.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:06:46.602222Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.532020Z","closed_at":"2026-02-05T20:57:41.532Z","close_reason":"Implemented extractor plugin derived pipeline (packages/hub/src/extractorDerived.ts): executes enabled extractors via Worker runtime, inserts topic_attachments with dedupe semantics (no duplicate events), emits topic.attachment_added, enforces 16KB attachment metadata limit, guarded by staleness helper. Integrated into hub auto-run after message.created/message.edited; added unit tests + hub integration test. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.6","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.602222Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.7","title":"Derived jobs: staleness guard (verify content + deleted_at before commit)","description":"Plan ref: Part X / Plugin system; Â§4.6; Gate I.\\n\\nBefore persisting derived outputs: re-read messages.content_raw + deleted_at in same txn; discard outputs if changed/tombstoned.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.624240Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.468145Z","closed_at":"2026-02-05T20:57:41.468126Z","close_reason":"Implemented derived-job staleness guard helper (packages/hub/src/derivedStaleness.ts) enforcing single-transaction check+commit and discarding outputs if message content/version changed, tombstoned, or missing. Added comprehensive deterministic tests (derivedStaleness.test.ts) incl. ABA scenario + rollback behavior. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["correctness","phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.7","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.624240Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.8","title":"Gate E: plugin safety (timeouts; hub continues ingesting)","description":"Plan ref: Â§0.7 Gate E.\n\nCriteria:\n- plugin hangs bounded by timeout; hub continues ingesting messages\n- plugin failures logged; do not crash hub","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.646649Z","created_by":"cole","updated_at":"2026-02-05T21:05:47.761084Z","closed_at":"2026-02-05T21:05:47.760791Z","close_reason":"Added Gate E integration coverage proving plugin hangs are bounded by timeout and hub continues ingesting: extended pluginDerived.integration.test.ts with a hanging linkifier (never-resolving) + pluginDefaults.timeout=100ms; asserts POST /api/v1/messages returns quickly, second message succeeds, and no message.enriched events are emitted. Verified: bun test + typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateE","phase3","tests"],"dependencies":[{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.646649Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.4.3","type":"blocks","created_at":"2026-02-05T01:06:46.733324Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.4.4","type":"blocks","created_at":"2026-02-05T01:06:46.753561Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.6.3","type":"blocks","created_at":"2026-02-05T01:08:19.212759Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.9","title":"Gate I: derived job staleness protection","description":"Plan ref: Â§0.7 Gate I.\n\nCriteria:\n- if message edited/deleted while job running: job must not commit stale derived rows\n- job must not emit derived events for old content","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.668340Z","created_by":"cole","updated_at":"2026-02-05T21:06:07.888648Z","closed_at":"2026-02-05T21:06:07.888632Z","close_reason":"Gate I satisfied: derived job staleness protection implemented + verified. Derived commits are guarded by withMessageStalenessGuard (content+version+deleted_at checked in same txn) and covered by deterministic suites: derivedStaleness.test.ts (ABA + atomicity), linkifierDerived/extractorDerived staleness tests, and pluginDerived.edge.test.ts (ABA, edit/delete mid-run, restart simulation). Verified: bun test + typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateI","phase3","tests"],"dependencies":[{"issue_id":"bd-16d.4.9","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.668340Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.9","depends_on_id":"bd-16d.4.7","type":"blocks","created_at":"2026-02-05T01:06:46.774651Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.9","depends_on_id":"bd-16d.6.9","type":"blocks","created_at":"2026-02-05T01:08:19.238010Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5","title":"Phase 4: Minimal UI + SDK polish","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: /ui browsing + live updates; @agentchat/client; docs + examples.\nExit: Gate F passes; end-to-end demo script works.","status":"closed","priority":3,"issue_type":"epic","created_at":"2026-02-05T01:02:57.974943Z","created_by":"cole","updated_at":"2026-02-05T21:53:02.764424Z","closed_at":"2026-02-05T21:53:02.764404Z","close_reason":"Phase 4 complete: @agentchat/client SDK (discovery, server.json, WS connect+reconnect, typed events, mutations), minimal UI (/ui/* routes with channels/topics/messages, live WS updates, tombstone+edit indicators, attachments), security headers (CSP/X-Frame-Options/X-Content-Type-Options), Gate F passing (9 tests), docs (protocol.md, ops.md, security.md, demo.md). 725 tests / typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4"],"dependencies":[{"issue_id":"bd-16d.5","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:57.974943Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5","depends_on_id":"bd-16d.4","type":"blocks","created_at":"2026-02-05T01:03:05.210032Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.1","title":"SDK: workspace discovery helper","description":"Plan ref: Part X / SDK; Â§4.1.\\n\\nProvide workspace discovery helper for Node/TS environments.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.427835Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.577832Z","closed_at":"2026-02-05T21:34:52.577426Z","close_reason":"SDK workspace discovery helper: packages/client/src/discovery.ts re-exports discoverWorkspaceRoot, ensureWorkspaceInitialized, discoverOrInitWorkspace from @agentchat/workspace. Tests in discovery.test.ts (5 passing). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.1","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.427835Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.1","depends_on_id":"bd-16d.5.2","type":"related","created_at":"2026-02-05T01:07:17.810299Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.10","title":"UI: security headers (CSP, X-Frame-Options, X-Content-Type-Options)","description":"Plan ref: Part X / UI; Security baseline.\\n\\nServe UI with CSP and standard hardening headers.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.634795Z","created_by":"cole","updated_at":"2026-02-05T21:52:56.266120Z","closed_at":"2026-02-05T21:52:56.266105Z","close_reason":"Security headers on all hub responses: CSP (self + inline + localhost WS), X-Frame-Options DENY, X-Content-Type-Options nosniff, X-XSS-Protection, Referrer-Policy no-referrer. 8 tests in securityHeaders.test.ts covering health/API/UI/404. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","security","ui"],"dependencies":[{"issue_id":"bd-16d.5.10","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.634795Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.11","title":"UI: escape all user content before rendering","description":"Plan ref: Part X / UI.\\n\\nEnsure all message and attachment fields are escaped/sanitized prior to HTML rendering.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.656623Z","created_by":"cole","updated_at":"2026-02-05T21:52:56.289701Z","closed_at":"2026-02-05T21:52:56.289684Z","close_reason":"Content escaping verified: all user content rendered via textContent (no innerHTML), URL validation blocks javascript: URIs, Content-Type always set. 10 tests in contentEscaping.test.ts (XSS payloads, malicious URLs, null bytes, MIME sniffing). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","security","ui"],"dependencies":[{"issue_id":"bd-16d.5.11","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.656623Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.12","title":"Docs: protocol (handshake, replay, event types, conflicts)","description":"Plan ref: Part X / Docs.\\n\\nDocument WS handshake, replay_until boundary, event envelope, conflict semantics.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.681365Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.636941Z","closed_at":"2026-02-05T21:45:02.636923Z","close_reason":"docs/protocol.md written: HTTP API (11 endpoints), WS protocol (handshake, replay boundary, subscription filtering, backpressure, close codes), all 9 event types with data shapes, conflict handling (optimistic locking, tombstone, retopic), error codes, schema evolution (additive-only). References source files.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","phase4"],"dependencies":[{"issue_id":"bd-16d.5.12","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.681365Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.13","title":"Docs: ops (startup, recovery, migrations, doctor)","description":"Plan ref: Part X / Docs.\\n\\nDocument startup/shutdown, lock staleness, migrations, doctor workflow, recovery.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.706190Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.663688Z","closed_at":"2026-02-05T21:45:02.663671Z","close_reason":"docs/ops.md written: hub startup sequence (8 steps), recovery (WAL, stale server.json/lock detection), migrations (idempotent, schema version tracking, FTS toggle), doctor command, zulip.config.ts configuration. References actual source files.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","ops","phase4"],"dependencies":[{"issue_id":"bd-16d.5.13","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.706190Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.14","title":"Docs: security (threat model, token handling, plugin risks, safe defaults)","description":"Plan ref: Part X / Docs + Â§0.1.2 threat model section.\\n\\nWrite security doc covering trust boundaries, token rotation, plugin model/risks, privacy implications.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.732044Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.691282Z","closed_at":"2026-02-05T21:45:02.691267Z","close_reason":"docs/security.md written: threat model (localhost-only, trusted users, untrusted plugins), auth (128-bit token, mode 0600, never logged), authorization (single-role), transport (localhost bind), input validation (prepared statements, size limits, rate limiting), plugin isolation (Workers, timeouts, circuit breaker), safe defaults table, known risks (event immutability, no encryption at rest).","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","phase4","security"],"dependencies":[{"issue_id":"bd-16d.5.14","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.732044Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.15","title":"Docs/Examples: multi-agent + human demo script","description":"Plan ref: Part X / Docs.\\n\\nProvide an end-to-end demo script exercising hub+CLI+SDK+UI.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.757594Z","created_by":"cole","updated_at":"2026-02-05T21:45:08.847365Z","closed_at":"2026-02-05T21:45:08.847347Z","close_reason":"docs/demo.md written (707 lines): complete multi-agent + human demo walkthrough. Covers hub startup, CLI channel/topic/message operations, 3 SDK agent examples (basic responder, task planner, persistent agent with checkpoint), real-time monitoring via CLI listen, checkpoint/reconnection pattern, expected console output, advanced patterns (topic-per-task, reactions), troubleshooting.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","phase4"],"dependencies":[{"issue_id":"bd-16d.5.15","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.757594Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.16","title":"Gate F: CLI + SDK stability (machine interface)","description":"Plan ref: Â§0.7 Gate F.\n\nCriteria:\n- CLI JSON/JSONL output is versioned and additive-only\n- SDK reconnects indefinitely, making forward progress using stored event_id","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.784706Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.598337Z","closed_at":"2026-02-05T21:45:02.598101Z","close_reason":"Gate F test suite: 9 tests in packages/client/src/gateF.test.ts. F.1: HTTP API JSON output includes status/error codes (4 tests). F.2: SDK resumes from stored event_id after hub restart. F.3: SDK forward progress via checkpoint+disconnect+reconnect. F.4: Additive event schema (unknown fields/types handled gracefully, 3 tests). All pass. bun test 695 pass / typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateF","phase4","tests"],"dependencies":[{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.2.23","type":"blocks","created_at":"2026-02-05T01:07:17.927499Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.784706Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.5.3","type":"blocks","created_at":"2026-02-05T01:07:17.948747Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.5.4","type":"blocks","created_at":"2026-02-05T01:07:17.970239Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.6.2","type":"blocks","created_at":"2026-02-05T01:08:19.318340Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.2","title":"SDK: read server.json + validate via /health","description":"Plan ref: Part X / SDK; Â§4.2.\\n\\nRead server.json, call /health, validate db_id/schema_version/protocol_version before use.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.457382Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.613749Z","closed_at":"2026-02-05T21:34:52.613729Z","close_reason":"SDK readServerJson + validateHub + discoverAndValidateHub implemented in packages/client/src/serverJson.ts. Reads .zulip/server.json, calls GET /health, validates protocol_version and schema_version. 13 tests in serverJson.test.ts. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.2","depends_on_id":"bd-16d.1.7","type":"blocks","created_at":"2026-02-05T01:07:17.836052Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.2","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.457382Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.3","title":"SDK: WS connect with replay + reconnect loop","description":"Plan ref: Part X / SDK; Gate F.\\n\\nConnect to WS with after_event_id; handle disconnects; resume indefinitely making forward progress.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.481180Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.641729Z","closed_at":"2026-02-05T21:34:52.641707Z","close_reason":"SDK WS connect with replay + reconnect loop in packages/client/src/ws.ts. Features: hello handshake, event replay from afterEventId, exponential backoff (configurable), event deduplication (bounded Set of 1000), consecutive-failure detection (gives up after 5 failed handshakes). 6 integration tests in ws.test.ts against real hub. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk","ws"],"dependencies":[{"issue_id":"bd-16d.5.3","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:07:17.860325Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.3","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.481180Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.4","title":"SDK: async iterator yielding typed event envelopes","description":"Plan ref: Part X / SDK.\\n\\nExpose AsyncIterable<EventEnvelope> with typed envelopes; additive-only schema.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.503882Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.670984Z","closed_at":"2026-02-05T21:34:52.670965Z","close_reason":"SDK typed event envelopes in packages/client/src/events.ts. Discriminated union TypedEvent covering 9 event types (channel.created, topic.created, topic.renamed, topic.attachment_added, message.created/edited/deleted/moved_topic/enriched). Type guards, typedEvents async iterator wrapper, additive-only schema (unknown events pass through). 31 tests in events.test.ts. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.4","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.503882Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.5","title":"SDK: convenience mutation methods (send/edit/delete/retopic/attach)","description":"Plan ref: Part X / SDK.\\n\\nProvide typed helpers that call hub HTTP endpoints and return typed results.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.526311Z","created_by":"cole","updated_at":"2026-02-05T21:34:56.965263Z","closed_at":"2026-02-05T21:34:56.965247Z","close_reason":"SDK convenience mutation methods in packages/client/src/mutations.ts. Functions: sendMessage, editMessage, deleteMessage, retopicMessage, addAttachment, createChannel, createTopic, renameTopic. HubApiError class for typed error handling. 9 integration tests in mutations.test.ts covering happy paths + version conflict + NOT_FOUND + auth failure. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.5","depends_on_id":"bd-16d.2.16","type":"blocks","created_at":"2026-02-05T01:07:17.883109Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.5","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.526311Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.6","title":"UI: channels/topics/messages views","description":"Plan ref: Part X / UI.\\n\\nImplement basic browsing UI for channels/topics/messages.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.549087Z","created_by":"cole","updated_at":"2026-02-05T21:52:56.165799Z","closed_at":"2026-02-05T21:52:56.165745Z","close_reason":"UI channels/topics/messages views: packages/hub/src/ui.ts serves HTML at /ui, /ui/channels/:id, /ui/topics/:id. Client-side JS fetches from API, renders with DOM APIs (textContent). 12 tests in ui.test.ts. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","ui"],"dependencies":[{"issue_id":"bd-16d.5.6","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.549087Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.7","title":"UI: tombstone + edit indicators","description":"Plan ref: Part X / UI.\\n\\nDisplay edited/deleted state clearly; never render deleted content as if live.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.569287Z","created_by":"cole","updated_at":"2026-02-05T21:52:56.194041Z","closed_at":"2026-02-05T21:52:56.194025Z","close_reason":"UI tombstone + edit indicators: deleted messages show '[deleted by {actor}]' in gray italic; edited messages show '(edited)' badge; version badge when version>1. Verified in ui.test.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","ui"],"dependencies":[{"issue_id":"bd-16d.5.7","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.569287Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.8","title":"UI: attachments pane (sanitize URLs; validate before rendering)","description":"Plan ref: Part X / UI; Gate J.\\n\\nRender attachments safely: sanitize/escape metadata; validate URL schemes; avoid XSS.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.591248Z","created_by":"cole","updated_at":"2026-02-05T21:52:56.217779Z","closed_at":"2026-02-05T21:52:56.217762Z","close_reason":"UI attachments pane: sidebar rendering for topic_attachments, URL validation (http/https only via isValidUrl), non-URL attachments show JSON. Verified in ui.test.ts + contentEscaping.test.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","security","ui"],"dependencies":[{"issue_id":"bd-16d.5.8","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.591248Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.9","title":"UI: live updates via WS","description":"Plan ref: Part X / UI.\\n\\nSubscribe via WS and update UI incrementally; handle reconnect and replay.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.612670Z","created_by":"cole","updated_at":"2026-02-05T21:52:56.242319Z","closed_at":"2026-02-05T21:52:56.242303Z","close_reason":"UI live updates via WS: messages view connects to /ws with auth token, sends hello with topic subscription, handles message.created/edited/deleted and topic.attachment_added events. Auto-reconnect on disconnect. Verified in ui.test.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","ui","ws"],"dependencies":[{"issue_id":"bd-16d.5.9","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:07:17.905409Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.9","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.612670Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6","title":"Testing & CI","description":"Plan ref: Part X / Testing & CI.\n\nOwns harness, CI matrix, and comprehensive edge-case suites backing Gates Aâ€“J.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-05T01:08:18.436912Z","created_by":"cole","updated_at":"2026-02-05T21:53:21.397097Z","closed_at":"2026-02-05T21:53:21.397081Z","close_reason":"Testing & CI epic complete. All child tasks closed: unit tests (6.1), integration harness (6.2), failure injection (6.3), security baseline (6.4), CI matrix (6.5), crash safety (6.6), WS delivery (6.7), concurrent mutations (6.8), plugin+derived (6.9), retopic (6.10), operational (6.11), event log integrity (6.12), rate limiting (6.13), security boundary (6.14), migration (6.15). Gates A-J verified. 725 tests / typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci","tests"],"dependencies":[{"issue_id":"bd-16d.6","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:08:18.436912Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.1","title":"Tests: unit tests for schema + query contracts","description":"Plan ref: Part X / Testing & CI.\\n\\nAdd unit tests asserting schema initialization and query contract invariants (incl FTS on/off where possible).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:08:18.513980Z","created_by":"cole","updated_at":"2026-02-05T13:12:12.811305Z","closed_at":"2026-02-05T13:12:12.811105Z","close_reason":"Added bun unit tests for @agentchat/kernel schema + query contracts (Gate A): schema init + meta keys, required indexes, PRAGMAs, trigger enforcement, optional FTS (supported or graceful fallback), idempotent migrations, and basic CRUD/constraints smoke. Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["sqlite","tests"],"dependencies":[{"issue_id":"bd-16d.6.1","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.513980Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.10","title":"Edge cases: retopic suite","description":"Plan ref: Part X / Edge case test suite (Retopic edge cases).\\n\\nCover idempotent retopic-to-same, tombstoned moves, stale version conflicts, 10k moves, cross-channel attempts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.838320Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.702398Z","closed_at":"2026-02-05T16:56:16.702375Z","close_reason":"Added retopic edge-case integration tests proving fanout correctness: subscribers to old topic (topic_id), new topic (topic_id2), and channel (channel_id) all receive message.moved_topic; cross-channel moves rejected with no DB/event side effects. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","retopic","tests"],"dependencies":[{"issue_id":"bd-16d.6.10","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.838320Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.11","title":"Edge cases: operational suite","description":"Plan ref: Part X / Edge case test suite (Operational edge cases).\\n\\nCover disk exhaustion, WAL growth, permission errors, fd exhaustion, port in use, multi-hub lock race, migration failure, corruption.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:08:18.867505Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.751073Z","closed_at":"2026-02-05T18:32:02.751048Z","close_reason":"Added deterministic operational edge-case suite (operational.edge.test.ts) covering port-in-use, daemon server.json permission failures, writer.lock multi-instance behavior + stale lock handling, and directory permission errors. Added docs: packages/hub/docs/operational-edge-cases.md. Verified: bun test + bun run typecheck (with 1 platform-specific skip).","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","ops","tests"],"dependencies":[{"issue_id":"bd-16d.6.11","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.867505Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.12","title":"Edge cases: event log integrity suite","description":"Plan ref: Part X / Edge case test suite (Event log integrity).\\n\\nCover monotonic IDs, immutability triggers, and scope audits.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.896642Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.216154Z","closed_at":"2026-02-05T16:45:43.216135Z","close_reason":"Expanded event log integrity tests: assert trigger presence/names, large-dataset replayEvents ordering+filtering, and topic_id2 semantics for message.moved_topic replay; documented integrity checklist. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","events","tests"],"dependencies":[{"issue_id":"bd-16d.6.12","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.896642Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.13","title":"Edge cases: rate limiting suite","description":"Plan ref: Part X / Edge case test suite (Rate limiting).\\n\\nVerify per-connection and global windows + reset behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.926765Z","created_by":"cole","updated_at":"2026-02-05T18:06:05.895344Z","closed_at":"2026-02-05T18:06:05.895315Z","close_reason":"Added deterministic rate limiting edge-case suite (packages/hub/src/rateLimiter.edge.test.ts) covering per-client + global limits, header/body correctness, window expiry/reset, cleanup lifecycle, and concurrency boundaries. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","security","tests"],"dependencies":[{"issue_id":"bd-16d.6.13","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.926765Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.14","title":"Edge cases: security boundary suite","description":"Plan ref: Part X / Edge case test suite (Security boundary tests).\\n\\nCover SQLi attempts, oversized payloads, token leakage, server.json perms, localhost bind, plugin write attempts, workspace traversal.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.953290Z","created_by":"cole","updated_at":"2026-02-05T18:06:06.033646Z","closed_at":"2026-02-05T18:06:06.033603Z","close_reason":"Documented and verified the security boundary suite: SECURITY_BOUNDARY_SUITE_SUMMARY.md maps Gate J + plan checklist (SQLi, size limits, token leakage in responses, perms, localhost bind, workspace traversal, rate limiting) to existing automated tests; explicitly defers plugin write isolation + token-in-logs capture until plugin system/logging finalization. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","security","tests"],"dependencies":[{"issue_id":"bd-16d.6.14","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.953290Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.15","title":"Edge cases: migration suite","description":"Plan ref: Part X / Edge case test suite (Migration edge cases).\\n\\nCover upgrade success, downgrade refusal, migration rollback on failure, concurrent hub start.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.978469Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.246569Z","closed_at":"2026-02-05T16:45:43.246548Z","close_reason":"Added migration edge-case tests in schema.test.ts: missing base migration file throws clearly, FTS rerun + toggle on/off behavior, graceful handling when FTS migration file missing, and backup behavior documentation/unit test. Also fixed schema test tmpdir cleanup to handle nested dirs. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","migrations","tests"],"dependencies":[{"issue_id":"bd-16d.6.15","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.978469Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.2","title":"Tests: integration harness (temp workspace + hub + WS client)","description":"Plan ref: Part X / Testing & CI.\\n\\nBuild harness to spin up temp workspace, run hub, and connect a WS client for replay/live assertions.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:08:18.558329Z","created_by":"cole","updated_at":"2026-02-05T15:39:12.378613Z","closed_at":"2026-02-05T15:39:12.378595Z","close_reason":"Added reusable integration test harness helpers: createTempWorkspace (workspace init+migrations), startTestHub (random port hub), wsConnect (WS client wrapper). Exported as @agentchat/hub/test-harness and added integrationHarness.test.ts covering HTTP + WS hello handshake. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","tests"],"dependencies":[{"issue_id":"bd-16d.6.2","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.558329Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.3","title":"Tests: failure injection (plugin hang, WS slow consumer, conflict)","description":"Plan ref: Part X / Testing & CI.\\n\\nAdd failure injection scenarios for timeouts, slow consumers/backpressure, and optimistic concurrency conflicts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.589869Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.119692Z","closed_at":"2026-02-05T16:45:43.119410Z","close_reason":"Added failure injection suite: kernel atomicity tests using a temporary trigger that aborts INSERT INTO events to prove mutations rollback (no state change, no events) + additional HTTP version-conflict tests asserting 409 VERSION_CONFLICT produces no state/event changes. Added WS backpressure coverage (non-flaky) + summary doc. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","tests"],"dependencies":[{"issue_id":"bd-16d.6.3","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.589869Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.4","title":"Tests: security baseline suite (rate limits, size limits, SQLi, token leakage, perms, bind, plugin isolation, discovery boundary)","description":"Plan ref: Part X / Testing & CI (Security tests) + Gate J.\\n\\nImplement the enumerated security test checklist from the plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:08:18.619505Z","created_by":"cole","updated_at":"2026-02-05T16:07:41.423506Z","closed_at":"2026-02-05T16:07:41.423488Z","close_reason":"Added packages/hub/src/securityBaseline.test.ts covering bind validation (assertLocalhostBind/startHub), auth token generation entropy/shape, server.json mode 0600 + read, SQLi smoke through HTTP API, and token leakage assertions. Existing suites already cover rate limits/size limits + workspace discovery boundary; plugin isolation will be covered by upcoming plugin/derived-data test suites. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["security","tests"],"dependencies":[{"issue_id":"bd-16d.6.4","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.619505Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.5","title":"CI: matrix with FTS on/off","description":"Plan ref: Part X / Testing & CI.\\n\\nRun CI in both configurations (FTS available/unavailable) and ensure graceful fallback behavior is tested.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.647867Z","created_by":"cole","updated_at":"2026-02-05T16:31:45.499253Z","closed_at":"2026-02-05T16:31:45.499237Z","close_reason":"Added GitHub Actions workflow .github/workflows/ci.yml running bun install/typecheck/test in an FTS on/off matrix via AGENTCHAT_ENABLE_FTS=0/1. Hub startHub + integration harness now respect the env var (explicit option still wins). Verified bun test in both configs + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci"],"dependencies":[{"issue_id":"bd-16d.6.5","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.647867Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.6","title":"Edge cases: transaction and crash safety suite","description":"Plan ref: Part X / Edge case test suite (Transaction and crash safety).\\n\\nCover: disk full, lock timeout, WAL checkpoint failure, kill -9 during txn, corruption detection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.695005Z","created_by":"cole","updated_at":"2026-02-05T18:06:05.989114Z","closed_at":"2026-02-05T18:06:05.989087Z","close_reason":"Added deterministic transaction/crash safety suite: new kernel + hub crash-safety tests (busy_timeout/SQLITE_BUSY contention, WAL checkpoint behavior, transactional rollback invariants) plus hub DB error mapping (SQLITE_BUSY/SQLITE_FULL -> 503 SERVICE_UNAVAILABLE with Retry-After). Documented in CRASH_SAFETY_SUITE_SUMMARY.md. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","tests"],"dependencies":[{"issue_id":"bd-16d.6.6","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.695005Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.7","title":"Edge cases: WebSocket delivery guarantees suite","description":"Plan ref: Part X / Edge case test suite (WebSocket delivery guarantees).\\n\\nCover: disconnect mid-replay, boundary semantics, mid-batch failure, stale client pagination, clock skew, hub restart.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.737095Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.157680Z","closed_at":"2026-02-05T16:45:43.157661Z","close_reason":"Added WS delivery guarantees suite (packages/hub/src/wsDelivery.test.ts + docs) covering disconnect mid-replay + resume, stable replay_until boundary (ADR-0003), mid-batch failure resume, stale-client large replay ordering/filtering, and hub restart resume (instance_id changes). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","tests","ws"],"dependencies":[{"issue_id":"bd-16d.6.7","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.737095Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.8","title":"Edge cases: concurrent mutations suite","description":"Plan ref: Part X / Edge case test suite (Concurrent mutations).\\n\\nCover edit/edit races, expected_version conflicts, edit/delete races, retopic concurrency, idempotent delete, overflow handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.767010Z","created_by":"cole","updated_at":"2026-02-05T16:31:45.530938Z","closed_at":"2026-02-05T16:31:45.530917Z","close_reason":"Added deterministic concurrent mutation test suite (packages/kernel/src/concurrency.test.ts) covering edit/edit races, expected_version conflicts, edit/delete and retopic concurrency, idempotent delete, and size-limit/throughput stress. Added summary doc. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","tests"],"dependencies":[{"issue_id":"bd-16d.6.8","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.767010Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.9","title":"Edge cases: plugin + derived data suite","description":"Plan ref: Part X / Edge case test suite (Plugin and derived data).\\n\\nCover ABA, TOCTOU, concurrent plugins, timeout, restart mid-plugin, version/content staleness guard.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.803896Z","created_by":"cole","updated_at":"2026-02-05T21:05:47.800848Z","closed_at":"2026-02-05T21:05:47.800832Z","close_reason":"Implemented dedicated plugin+derived edge-case suite (packages/hub/src/pluginDerived.edge.test.ts) covering ABA (content returns but version differs), concurrent pipelines (linkifier+extractor), derived-layer timeout behavior, restart/DB-closed simulation (no partial commits), concurrent extractor dedupe idempotency, and edit/delete staleness during execution. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","plugins","tests"],"dependencies":[{"issue_id":"bd-16d.6.9","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.803896Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-1b2","title":"Hub WS: consistent subscription semantics (omit=all, empty=none)","description":"Fix WS subscription semantics so replay + live filtering agree.\n\nProposed contract:\n- If hello.subscriptions is omitted: subscribe to ALL events (no scope filter)\n- If hello.subscriptions is provided but both channels/topics are empty: subscribe to NONE (send hello_ok only; no replay/live)\n- Otherwise: filter by channel/topic ids as today\n\nAdd regression tests for empty vs omitted subscriptions (replay + live). Needed for agentchat listen default behavior.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-05T15:47:23.941166Z","created_by":"cole","updated_at":"2026-02-05T16:07:21.562181Z","closed_at":"2026-02-05T16:07:21.562110Z","close_reason":"Fixed WS subscription semantics so replay+live are consistent: omit hello.subscriptions => wildcard/all events; explicit empty subscriptions => none (hello_ok only). Implemented via null-vs-Set tracking in wsEndpoint and added regression tests for replay + live cases. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-23k","title":"Tech debt cleanup: release tooling hardening (scripts, local registry, publish workflow, docs)","description":"Context:\\n\\n- Follow-up tech debt from Craft + local Verdaccio publishing + npm OIDC migration work.\\n- Goal: reduce release/publish footguns, improve maintainability, and keep docs accurate.\\n\\nScope boundaries:\\n\\n- âœ… IN scope: scripts/*.sh hardening, verdaccio harness UX, small safe publish.yml maintainability improvements (post OIDC rehearsal), docs consistency sweep.\\n- âŒ OUT of scope: executing OIDC rehearsal itself (bd-2bg.4), removing NPM_TOKEN fallback (bd-2bg.5), changing release strategy.\\n\\nDone means:\\n\\n- All child tasks (Gate A-E) closed, with verifications recorded.\\n\\nVerification:\\n\\n- br shows all children closed; release tooling still works in normal flows.\\n\\nRed-Green-Refactor plan:\\n\\n- Red: reproduce current sharp edges / missing guardrails.\\n- Green: implement minimal fixes with scriptable verifications.\\n- Refactor: reduce duplication only where it improves clarity.","status":"closed","priority":3,"issue_type":"epic","created_at":"2026-02-06T18:20:48.865964Z","created_by":"cole","updated_at":"2026-02-07T16:14:19.688619Z","closed_at":"2026-02-07T16:14:19.688592Z","close_reason":"All 5 child gates (A-E) completed and closed:\n- Gate A (bd-23k.1): Scripts hardened with semver validation, exit code contracts, interrupt safety.\n- Gate B (bd-23k.2): Verdaccio harness with prereq checks, timeouts, port conflict detection.\n- Gate C (bd-23k.3): Publish workflow with concurrency, timeouts, OIDC documentation.\n- Gate D (bd-23k.4): Docs consistency sweep + troubleshooting index added.\n- Gate E (bd-23k.5): Known remaining debt documented (minor optional items only); plan moved to completed-plans.\n\nVerification: All child beads closed; release tooling verified via OIDC rehearsal (0.1.1-rc.1 published successfully).","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","ops","security","workflow"]}
{"id":"bd-23k.1","title":"Tech debt Gate A: scripts correctness + portability contracts","description":"Context:\n\n- Release/local-publish scripts are safety-critical and easy to regress with `set -euo pipefail` (e.g. arithmetic returning non-zero).\n\nScope boundaries:\n\n- âœ… IN scope: scripts/bump-version.sh, scripts/publish-local.sh, scripts/smoke-install-from-registry.sh, scripts/local-registry-*.sh (best-effort), plus optional scripts/shellcheck.sh.\n- âŒ OUT of scope: changing release strategy, changing package contents, changing publish.yml (handled in Gate C).\n\nDone means:\n\n- Scripts follow plan interface contracts: exit codes 0/1/2, stdout/stderr conventions, registry URL normalization.\n- Version args validated against semver regex before use; injection attempts rejected with exit 1 + clear error.\n- Scripts that create temp dirs or background processes implement idempotent cleanup + `trap 'cleanup' EXIT ERR INT TERM`.\n- Optional: add scripts/shellcheck.sh (only runs if shellcheck exists).\n\nVerification:\n\n- bash -n scripts/*.sh\n- ./scripts/bump-version.sh 0.1.0 && echo OK\n- ./scripts/publish-local.sh 0.1.0 --registry http://127.0.0.1:4873/ (must get past localhost/normalization checks)\n- ./scripts/bump-version.sh '$(whoami)' 2>&1 | grep -qi 'invalid version'\n- grep -l 'trap.*cleanup' scripts/*.sh includes scripts that create temp dirs\n\nRed-Green-Refactor plan:\n\n- Red: reproduce current sharp edges (no-op paths, invalid version, Ctrl+C).\n- Green: minimal fixes.\n- Refactor: standardize helpers (parsing, error function) without over-DRYing.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T18:21:23.542513Z","created_by":"cole","updated_at":"2026-02-06T18:29:57.570910Z","closed_at":"2026-02-06T18:29:57.570878Z","close_reason":"Hardened bump-version/publish-local/smoke-install scripts: fixed set -e arithmetic increments, enforced semver-only version args (rejects injection), standardized semver regex (no build metadata), added cleanup traps for temp files, aligned runtime failures to exit 2. Verification: bash -n scripts/*.sh; ./scripts/bump-version.sh 0.1.0 (no-op ok); ./scripts/bump-version.sh 'cole' | grep -qi 'invalid version'; docker compose config ok; bun test passed.","source_repo":".","compaction_level":0,"original_size":0,"labels":["ops","security","workflow"],"dependencies":[{"issue_id":"bd-23k.1","depends_on_id":"bd-23k","type":"parent-child","created_at":"2026-02-06T18:21:23.542513Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-23k.2","title":"Tech debt Gate B: verdaccio local registry harness hardening","description":"Context:\\n\\n- Local registry e2e testing should fail fast with actionable errors and remain localhost-only to avoid accidental exposure.\\n\\nScope boundaries:\\n\\n- âœ… IN scope: scripts/local-registry-up.sh + scripts/local-registry-down.sh + dev/verdaccio/docker-compose.yml + .context/runbooks/local-registry-testing.md (accuracy).\\n- âŒ OUT of scope: new infrastructure beyond Verdaccio; CI automation for docker registry tests.\\n\\nDone means:\\n\\n- local-registry-up.sh checks prereqs (curl + docker) and exits 1 on missing prereqs.\\n- Emits REGISTRY_URL=http://127.0.0.1:4873 on success (KEY=value contract).\\n- Health check uses 30s total timeout and exits 2 on timeout with clear guidance.\\n- Detects port conflicts (4873) and exits 1 with clear error.\\n- Warns if registry container already running; down script idempotent and clean option documented.\\n- Compose binds localhost only; file comment explains why.\\n\\nVerification:\\n\\n- docker compose -f dev/verdaccio/docker-compose.yml config\\n- grep -q '127.0.0.1:4873' dev/verdaccio/docker-compose.yml\\n- With port 4873 occupied, local-registry-up.sh exits 1 quickly\\n\\nRed-Green-Refactor plan:\\n\\n- Red: run up/down with missing prereqs or port conflict.\\n- Green: implement checks/timeouts.\\n- Refactor: reduce duplication in scripts.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T18:21:23.607460Z","created_by":"cole","updated_at":"2026-02-06T18:30:02.933984Z","closed_at":"2026-02-06T18:30:02.933949Z","close_reason":"Hardened Verdaccio local registry harness: prereq checks (curl/docker/compose) with exit 1; port-4873 conflict detection; existing-container warning; /-/ping polling with 30s timeout and exit 2; machine-readable REGISTRY_URL line; down script idempotent and --clean documented; compose file has localhost-only binding comment. Verification: bash -n scripts/local-registry-*.sh; docker compose -f dev/verdaccio/docker-compose.yml config; grep for 127.0.0.1:4873 binding; bun test passed.","source_repo":".","compaction_level":0,"original_size":0,"labels":["ops","workflow"],"dependencies":[{"issue_id":"bd-23k.2","depends_on_id":"bd-23k","type":"parent-child","created_at":"2026-02-06T18:21:23.607460Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-23k.3","title":"Tech debt Gate C: publish workflow safety/maintainability (post OIDC rehearsal)","description":"Context:\\n\\n- publish.yml is critical infra; make small safe maintainability improvements once OIDC rehearsal is proven.\\n\\nScope boundaries:\\n\\n- âœ… IN scope: .github/workflows/publish.yml small diffs: concurrency, comments, safe env extraction, timeouts, recovery docs.\\n- âŒ OUT of scope: removing token fallback (bd-2bg.5), changing publish order, adding reusable workflows.\\n\\nDependencies:\\n\\n- Blocked by bd-2bg.4 (OIDC rehearsal must be green first).\\n\\nDone means:\\n\\n- publish.yml has concurrency block (cancel-in-progress false) keyed on ref.\\n- npm publish steps have timeout-minutes.\\n- Token hygiene: NPM_TOKEN only scoped to npm publish step; token masked if interpolated.\\n- Header comment documents OIDC default, fallback behavior, and partial publish recovery steps.\\n\\nVerification:\\n\\n- python3 -c 'import yaml; yaml.safe_load(open(.github/workflows/publish.yml))'\\n- Manual: prerelease tag publish confirms provenance in OIDC mode and fallback works when USE_NPM_TOKEN=1\\n\\nRed-Green-Refactor plan:\\n\\n- Red: identify duplication/ambiguity that caused confusion during rehearsal.\\n- Green: minimal YAML changes.\\n- Refactor: keep readability high.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-06T18:21:23.641307Z","created_by":"cole","updated_at":"2026-02-07T16:07:53.180294Z","closed_at":"2026-02-07T16:07:53.180029Z","close_reason":"Implemented small safety/maintainability hardening in .github/workflows/publish.yml (post OIDC rehearsal):\n\n- Added workflow-level concurrency group keyed on ref (cancel-in-progress: false) to prevent concurrent publishes for the same tag.\n- Added timeout-minutes: 5 to all npm publish steps (OIDC + token fallback).\n- Added/updated header comment documenting OIDC default + prerelease dist-tag behavior + partial publish recovery guidance.\n- Token hygiene preserved: NPM_TOKEN only scoped to token fallback publish steps.\n\nVerification:\n- `python3 -c \"import yaml; yaml.safe_load(open(.github/workflows/publish.yml))\\\"`","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","workflow"],"dependencies":[{"issue_id":"bd-23k.3","depends_on_id":"bd-23k","type":"parent-child","created_at":"2026-02-06T18:21:23.641307Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-23k.3","depends_on_id":"bd-2bg.4","type":"blocks","created_at":"2026-02-06T18:21:43.231374Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-23k.4","title":"Tech debt Gate D: docs consistency sweep + troubleshooting index","description":"Context:\\n\\n- Docs/runbooks drifted during Craft + OIDC changes; make sure instructions match reality.\\n\\nScope boundaries:\\n\\n- âœ… IN scope: README.md and .context/runbooks/*.md updates to remove stale instructions; add troubleshooting index.\\n- âŒ OUT of scope: broader documentation redesign.\\n\\nDone means:\\n\\n- No stale bun publish instructions for npmjs publishing (token fallback uses npm publish).\\n- USE_NPM_TOKEN instructions include where to set (Repo Settings â†’ Variables â†’ Actions).\\n- Craft runbook does not assume conventional commits.\\n- Add short troubleshooting index linking craft-release / npm-trusted-publishing / local-registry-testing.\\n\\nVerification:\\n\\n- rg -n 'bun publish' README.md .context/runbooks/*.md returns only local-registry contexts (or none).\\n- rg -n 'USE_NPM_TOKEN' README.md .context/runbooks/*.md\\n\\nRed-Green-Refactor plan:\\n\\n- Red: find inconsistencies via ripgrep.\\n- Green: minimal edits.\\n- Refactor: consolidate duplicated sentences.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-06T18:21:23.674604Z","created_by":"cole","updated_at":"2026-02-06T18:29:51.976447Z","closed_at":"2026-02-06T18:29:51.976257Z","close_reason":"Updated README release section to explicitly document USE_NPM_TOKEN location (Repo Settings â†’ Variables â†’ Actions) and added Release Troubleshooting index linking craft-release / npm-trusted-publishing / local-registry-testing. Verified via ripgrep: no stale 'bun publish' references in README/runbooks; USE_NPM_TOKEN references present. See git changes to README.md.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","workflow"],"dependencies":[{"issue_id":"bd-23k.4","depends_on_id":"bd-23k","type":"parent-child","created_at":"2026-02-06T18:21:23.674604Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-23k.5","title":"Tech debt Gate E: close-out + remaining debt captured","description":"Context:\\n\\n- Ensure no high-risk TODOs remain untracked after gates A-D.\\n\\nScope boundaries:\\n\\n- âœ… IN scope: add 'Known remaining debt' section to plan, create follow-up beads if needed, and close this epic.\\n- âŒ OUT of scope: implementing major new work (create a new bead instead).\\n\\nDone means:\\n\\n- Plan file has 'Known remaining debt' section updated with any deferrals discovered during execution.\\n- Any deferrals are represented as beads with Done means + verification.\\n\\nVerification:\\n\\n- br ready does not reveal new high-priority untracked items from this epic\\n\\nRed-Green-Refactor plan:\\n\\n- Red: identify remaining debt items.\\n- Green: capture as beads.\\n- Refactor: tidy plan wording.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":30,"created_at":"2026-02-06T18:21:34.369282Z","created_by":"cole","updated_at":"2026-02-07T16:14:04.574854Z","closed_at":"2026-02-07T16:14:04.574802Z","close_reason":"Added 'Known remaining debt' section to plan documenting deferred optional items (shellcheck.sh, local-registry-e2e.sh wrapper) and noting first-publish-v0.1.0.md as historical. No follow-up beads neededâ€”items are minor conveniences. Moved plan to .context/completed-plans/. Verification: br ready shows no new untracked tech-debt; plan file moved successfully.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","workflow"],"dependencies":[{"issue_id":"bd-23k.5","depends_on_id":"bd-23k","type":"parent-child","created_at":"2026-02-06T18:21:34.369282Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-23k.5","depends_on_id":"bd-23k.1","type":"blocks","created_at":"2026-02-06T18:21:43.281374Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-23k.5","depends_on_id":"bd-23k.2","type":"blocks","created_at":"2026-02-06T18:21:43.326193Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-23k.5","depends_on_id":"bd-23k.3","type":"blocks","created_at":"2026-02-06T18:21:45.906214Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-23k.5","depends_on_id":"bd-23k.4","type":"blocks","created_at":"2026-02-06T18:21:43.360511Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i","title":"Node default local client (Node v22+ ESM) + hub idle shutdown","description":"Context:\n\n- Plan: .context/plans/node-local-client.md\n- Goal: ship a Node-compatible default local client (connectToLocalAgentlip) that can discover workspace, connect to a local hub (server.json + /health + WS), and start the Bun-only hub via child_process when missing.\n- Also add hub idle auto-shutdown (opt-in; enabled for hubs spawned by the local client) to avoid stray daemons.\n\nScope boundaries:\n\n- âœ… IN scope: hub idle shutdown + agentlipd up command, client/local implementation, Node packaging/dist exports, agentlip/local-client re-export, docs updates.\n- âŒ OUT of scope: Node-native hub, embedded Bun binary, CJS support, remote discovery.\n\nDone means:\n\n- Each gate in .context/plans/node-local-client.md has a corresponding completed task with tests/typecheck passing.\n- Node smoke: node -e \"import { connectToLocalAgentlip } from \"agentlip/local-client\"; console.log(typeof connectToLocalAgentlip)\" succeeds.\n\nVerification:\n\n- bun run typecheck\n- bun test\n","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-06T22:48:03.205937Z","created_by":"cole","updated_at":"2026-02-07T01:42:26.991370Z","closed_at":"2026-02-07T01:42:26.991333Z","close_reason":"Delivered Node v22+ ESM default local client + hub idle shutdown (plan .context/plans/node-local-client.md):\n\nHub / daemon:\n- startHub idle auto-shutdown (opt-in, daemon-mode only) with race-safe activity tracking and test-runner-safe exit gating.\n- server.json perms enforced (0600) and validated in tests.\n- agentlipd up command with --workspace/--host/--port/--idle-shutdown-ms/--json, correct exit codes, signal handling, and token secrecy.\n\nSDK / client:\n- wsConnect supports injected webSocketImpl (Node compat) with stable error message when missing.\n- @agentlip/client/local connectToLocalAgentlip: connect to existing daemon via server.json + /health + WS; event fanout; spawn-if-missing using node:child_process.spawn of `bun x --bun -p @agentlip/hub agentlipd up`, with abort/timeout hardening and concurrency safety.\n\nPackaging + CLI entrypoint:\n- Added dist build (tsc) + conditional exports (bun/types/import) for @agentlip/{protocol,workspace,client} and agentlip/local-client.\n- Fixed Node ESM relative import specifiers (.js) + removed Bun-only Timer type in ws client.\n\nDocs:\n- Updated docs/ops.md + README with agentlipd up and Node local client usage + requirements (Bun installed, Node v22+, ESM).\n\nVerification:\n- bun run typecheck\n- bun test\n- bun run --filter @agentlip/{protocol,workspace,client} build && bun run --filter agentlip build\n- Node smoke: import { connectToLocalAgentlip } from \"agentlip/local-client\" works and is a function.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","docs","hub","infra","sdk","security","tests","workspace","ws"]}
{"id":"bd-27i.1","title":"Hub: idle auto-shutdown (opt-in) + server.json mode 0600","description":"Context:\n\n- Implements Gate 1 of .context/plans/node-local-client.md.\n- Needed so hubs spawned by Node local client don't become stray daemons and so auth token in server.json is protected.\n\nScope boundaries:\n\n- âœ… IN scope: packages/hub/src/index.ts + related hub startup/shutdown code; write server.json with mode 0600; implement idle timer logic and activity tracking; add tests.\n- âŒ OUT of scope: agentlipd CLI changes (Gate 2), Node client code (Gate 3), packaging/dist work (Gate 5).\n\nDone means:\n\n- startHub/startServer accepts idleShutdownMs (opt-in) and when enabled exits cleanly after idle period.\n- Activity tracking updates lastActivityMs for any non-/health HTTP request, WS open/close/handshake, and incoming WS messages.\n- Hub is considered active when any WS clients are connected; idle shutdown only when 0 clients.\n- Idle check interval implemented as Math.min(idleShutdownMs / 4, 30_000).\n- Shutdown race safety: re-check lastActivityMs + WS client count right before initiating shutdown; abort shutdown if activity happened.\n- Idle timer/interval is cleared on all shutdown paths (SIGTERM/SIGINT, crash, idle-triggered).\n- server.json is written with owner-only permissions (mode 0600).\n- Idle shutdown path removes server.json and writer.lock (same as normal shutdown).\n\nVerification:\n\n- bun test packages/hub\n- bun run typecheck\n\nRed-Green-Refactor plan:\n\n- Red: add failing tests for idle exit + cleanup + server.json mode + race safety.\n- Green: implement minimal idle shutdown + permission changes to pass tests.\n- Refactor: centralize activity tracking + timer cleanup; avoid duplicated shutdown logic.\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:48:20.545254Z","created_by":"cole","updated_at":"2026-02-07T00:03:28.756232Z","closed_at":"2026-02-07T00:03:28.756004Z","close_reason":"Implemented Gate 1 hub idle auto-shutdown (opt-in) in daemon mode:\n\n- Added StartHubOptions.idleShutdownMs and activity tracking (non-/health HTTP + WS upgrade/open/message/close).\n- Idle check interval per plan and race-safe shutdown that clears timers, calls hub.stop(), and exits only outside test env.\n- Added hub tests covering idle exit + WS client prevents shutdown + HTTP activity + race safety + non-daemon behavior + /health excluded.\n\nVerification:\n- bun run typecheck\n- bun test packages/hub","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","security","tests","ws"],"dependencies":[{"issue_id":"bd-27i.1","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:48:20.545254Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.2","title":"Hub CLI: implement agentlipd up (idle-shutdown flag, exit codes, diagnostics)","description":"Context:\n\n- Implements Gate 2 of .context/plans/node-local-client.md.\n- Required so Node local client can start the Bun-only hub via `bun x ... agentlipd up` reliably.\n\nScope boundaries:\n\n- âœ… IN scope: packages/hub/src/agentlipd.ts command parsing + process lifecycle; wiring idleShutdownMs into startHub; tests for lock conflict + signals + output contract.\n- âŒ OUT of scope: Node client code (Gate 3) and Node packaging (Gate 5).\n\nDone means:\n\n- `agentlipd up [--workspace <path>] [--host 127.0.0.1] [--port 0] [--idle-shutdown-ms <ms>] [--json]` exists and starts the hub in daemon mode.\n- Uses workspace discovery/initialization from @agentlip/workspace and passes workspaceRoot into startHub.\n- Auth token is never accepted as a CLI arg and is never printed (stdout/stderr), including in `--json` output.\n- Exit codes implemented: 0 = clean shutdown, 1 = error, 10 = writer-lock conflict.\n- On lock conflict or startup failure: print a structured stderr message including workspaceRoot + reason so parent process can surface diagnostics.\n- Handles SIGINT/SIGTERM by gracefully stopping hub and cleaning server.json + writer.lock.\n\nVerification:\n\n- bun test packages/hub\n- bun run typecheck\n\nRed-Green-Refactor plan:\n\n- Red: add failing tests for `up` creating server.json + holding lock; second instance exits 10; SIGINT cleanup.\n- Green: implement minimal `up` command and error/exit-code mapping to make tests pass.\n- Refactor: consolidate option parsing and error reporting; keep token-handling non-leaky.\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:48:34.955906Z","created_by":"cole","updated_at":"2026-02-07T00:18:22.002139Z","closed_at":"2026-02-07T00:18:22.001888Z","close_reason":"Implemented `agentlipd up` daemon command (Gate 2):\n\n- Added `agentlipd up` with flags: --workspace/--host/--port/--idle-shutdown-ms/--json.\n- Uses @agentlip/workspace discoverOrInitWorkspace and starts hub via startHub({ workspaceRoot, dbPath, idleShutdownMs }).\n- Exit codes: 0 clean shutdown, 1 error, 10 writer-lock conflict.\n- Structured stderr diagnostics on failure; handles SIGINT/SIGTERM with graceful cleanup.\n- Token safety: does not accept token args and never prints auth_token (incl --json output).\n- Added subprocess tests for lock conflict, SIGINT cleanup, token secrecy, and flag forwarding.\n\nVerification:\n- bun run typecheck\n- bun test packages/hub","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","hub","ops","security","tests"],"dependencies":[{"issue_id":"bd-27i.2","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:48:34.955906Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.2","depends_on_id":"bd-27i.1","type":"blocks","created_at":"2026-02-06T22:52:19.742707Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.3","title":"SDK: wsConnect supports injected WebSocket impl (Node compat)","description":"Context:\n\n- Implements the wsConnect interface change described in Gate 3 of .context/plans/node-local-client.md.\n- Needed so Node local client can work even if globalThis.WebSocket is absent/experimental; callers can inject `ws`/`undici`.\n\nScope boundaries:\n\n- âœ… IN scope: packages/client/src/ws.ts (WsConnectOptions + implementation); tests for the new behavior.\n- âŒ OUT of scope: connectToLocalAgentlip implementation (separate tasks), packaging/dist changes (Gate 5).\n\nDone means:\n\n- WsConnectOptions includes optional `webSocketImpl?: typeof WebSocket`.\n- Default constructor is globalThis.WebSocket when webSocketImpl is not provided.\n- If neither injected nor global WebSocket exists, wsConnect throws a clear error: \"WebSocket not available. Pass webSocketImpl option or use Node 22+.\"\n- All WebSocket instantiation paths (initial connect and reconnect) use the injected constructor.\n- Tests cover: missing WebSocket error; injected constructor is used (can be asserted via a fake WebSocket class).\n\nVerification:\n\n- bun test packages/client\n- bun run typecheck\n\nRed-Green-Refactor plan:\n\n- Red: add failing test for missing-WebSocket error and injection usage.\n- Green: implement option + constructor selection.\n- Refactor: keep constructor selection in one place to avoid divergence between connect/reconnect.\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:48:45.911756Z","created_by":"cole","updated_at":"2026-02-07T00:03:34.229962Z","closed_at":"2026-02-07T00:03:34.229941Z","close_reason":"Implemented wsConnect WebSocket injection (Node compat):\n\n- Added WsConnectOptions.webSocketImpl and ctor selection (injected or globalThis.WebSocket).\n- Throw clear error when no WebSocket is available.\n- Ensured reconnect path also uses selected ctor.\n- Added unit tests for missing-global error, injected ctor usage, and reconnect using injected ctor.\n\nVerification:\n- bun run typecheck\n- bun test packages/client","source_repo":".","compaction_level":0,"original_size":0,"labels":["sdk","tests","ws"],"dependencies":[{"issue_id":"bd-27i.3","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:48:45.911756Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.4","title":"SDK: add @agentlip/client/local (connectToLocalAgentlip core API + existing-hub connect)","description":"Context:\n\n- Part of Gate 3 of .context/plans/node-local-client.md.\n- Introduces the Node-facing local client API surface, error contract, and the \"connect to an already-running hub\" path.\n\nScope boundaries:\n\n- âœ… IN scope: new export @agentlip/client/local with ConnectToLocalAgentlipOptions + LocalAgentlipClient; error classes; discovery via workspace + server.json + /health; WS connect + events()/waitForEvent()/close(); bound HTTP mutations.\n- âŒ OUT of scope: spawning the hub when missing (handled in a follow-up task), Node packaging/dist exports (Gate 5), agentlip/local-client re-export (Gate 4).\n\nDone means:\n\n- New module exists (e.g. packages/client/src/local.ts or src/local/index.ts) and is exported from @agentlip/client via exports map.\n- Exports ConnectToLocalAgentlipOptions + LocalAgentlipClient + all Arg/Result types used by the bound mutations.\n- Exports startup/runtime error classes per plan: WorkspaceNotFoundError, BunNotFoundError (may be unused until spawn task), HubStartTimeoutError, ProtocolVersionMismatchError, WaitTimeoutError, ConnectionClosedError, MutationError.\n- connectToLocalAgentlip({ startIfMissing: false }) can: discover workspace, read server.json, validate /health, connect WS using wsConnect({ webSocketImpl }), and return bound mutations + events/waitForEvent/close.\n- waitForEvent supports AbortSignal + timeoutMs and rejects with WaitTimeoutError / AbortError (DOMException) / ConnectionClosedError as documented.\n- close() is idempotent and terminates events() iteration; pending waitForEvent rejects.\n\nVerification:\n\n- bun test packages/client\n- bun run typecheck\n\nRed-Green-Refactor plan:\n\n- Red: add an integration-style test using packages/hub/src/integrationHarness to start a hub, then connect via connectToLocalAgentlip({ startIfMissing: false }) and assert sendMessage + waitForEvent works.\n- Green: implement minimal local client wiring to pass test.\n- Refactor: extract small helpers (health check, server.json read/validate, waitForEvent implementation).\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:50:52.122992Z","created_by":"cole","updated_at":"2026-02-07T00:18:29.033941Z","closed_at":"2026-02-07T00:18:29.033919Z","close_reason":"Implemented @agentlip/client/local (existing-hub connect path):\n\n- Added `connectToLocalAgentlip()` that discovers workspace, reads server.json, validates /health protocol version, connects WS, and returns a LocalAgentlipClient.\n- Provides bound mutation methods, events() iterator + waitForEvent() with timeout/AbortSignal, and idempotent close().\n- Added exported error classes per plan (WorkspaceNotFoundError, ProtocolVersionMismatchError, WaitTimeoutError, ConnectionClosedError, MutationError, etc).\n- Implemented internal event fanout so waitForEvent does not steal events from events() consumers.\n- Added integration tests for happy path, fanout, waitForEvent timeout/abort, close semantics, and error cases.\n- Fixed hub integrationHarness startTestHub() to pass workspaceRoot into startHub so daemon mode writes server.json (needed by local client tests).\n\nVerification:\n- bun run typecheck\n- bun test packages/client\n- bun test packages/hub","source_repo":".","compaction_level":0,"original_size":0,"labels":["sdk","security","tests","workspace","ws"],"dependencies":[{"issue_id":"bd-27i.4","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:50:52.122992Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.4","depends_on_id":"bd-27i.3","type":"blocks","created_at":"2026-02-06T22:52:19.788238Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.5","title":"SDK: connectToLocalAgentlip spawn-if-missing (bun x agentlipd up) + race/abort/timeout hardening","description":"Context:\n\n- Completes Gate 3 behavior from .context/plans/node-local-client.md: start the Bun-only hub when missing, safely.\n- Must be race-safe for concurrent starters and must not leak auth token (never in argv/logs; read from server.json).\n\nScope boundaries:\n\n- âœ… IN scope: implement startIfMissing path in connectToLocalAgentlip; bunPath validation; child-process lifecycle (abort/timeout cleanup); race-safe startup loop; stale server.json handling; tests for these behaviors.\n- âŒ OUT of scope: Node packaging/dist exports (Gate 5) and agentlip/local-client re-export (Gate 4).\n\nDone means:\n\n- When hub is not running and startIfMissing !== false, connectToLocalAgentlip spawns hub via Bun using bunx:\n  - command shape: <bunPath> x --bun -p @agentlip/hub agentlipd up --workspace <workspaceRoot> --idle-shutdown-ms <idleShutdownMs> [--host 127.0.0.1] [--port 0]\n- bunPath input validation implemented: only absolute paths or bare command names; reject path traversal (..) and shell metacharacters.\n- Startup loop implemented per plan:\n  - discover hub (server.json + /health); if ok, connect\n  - else spawn child; if child exits with lock-conflict (exit 10), backoff + retry discovery\n  - if child exits non-zero for other reasons, capture stderr and throw descriptive error\n  - give up after startTimeoutMs with HubStartTimeoutError\n- Abort handling: if signal aborts during startup, kill child and throw AbortError/AbortError-like.\n- Timeout handling: if startTimeoutMs elapses while child running, kill with SIGTERM then SIGKILL after 2s; ensure no orphan.\n- Token handling: do not pass auth token via argv or env; after hub is healthy, read auth_token from server.json (which must be 0600 from hub task).\n- idleShutdownMs default 180000 is applied only when this call spawned the hub; spawned hubs must always get idle shutdown enabled (orphan mitigation).\n- startedHub property is correct: false when connecting to existing hub; true when this call spawned the child.\n\nTesting note (important):\n\n- Avoid network dependency in tests. Provide a test-only override (env var or hidden option) so tests can spawn the repo-local agentlipd script instead of bunx fetching from npm.\n\nVerification:\n\n- bun test packages/client\n- bun run typecheck\n\nRed-Green-Refactor plan:\n\n- Red: add failing tests for spawn-if-missing, abort cleanup, concurrent start (only one hub), timeout kill, startedHub correctness, and \"token not in child argv\" (ps/proc inspection).\n- Green: implement minimal spawn loop + cleanup to make tests pass.\n- Refactor: isolate child-process management (spawn/wait/kill) and hub validation helpers to keep connectToLocalAgentlip readable.\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:51:14.529562Z","created_by":"cole","updated_at":"2026-02-07T01:17:20.612098Z","closed_at":"2026-02-07T01:17:20.611872Z","close_reason":"Implemented connectToLocalAgentlip spawn-if-missing (Gate 3):\n\n- Added full startIfMissing=true startup loop that discovers existing hub first, otherwise spawns `bun x --bun -p @agentlip/hub agentlipd up` (test override supported) and waits for server.json + /health.\n- Race-safe: lock conflict exit code 10 handled via backoff + retry; startedHub is computed by comparing server.json pid to spawned child pid (ensures only the winning spawner reports startedHub=true).\n- Abort/timeout hardening: supports AbortSignal; on abort/timeout kills child (SIGTERM then SIGKILL after 2s) and throws AbortError / HubStartTimeoutError.\n- bunPath validation + BunNotFoundError mapping for ENOENT.\n- ProtocolVersionMismatchError surfaced when /health responds with mismatched protocol_version.\n- Security: never passes auth token via argv/env; token read from server.json; added ps-based test asserting token not in process args.\n- Added/updated tests covering spawn, existing hub, concurrency, abort, timeout kill, crash stderr, BunNotFoundError, bunPath validation, and protocol mismatch.\n\nVerification:\n- bun run typecheck\n- bun test packages/client\n- bun test packages/hub","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","hub","ops","sdk","security","tests","workspace"],"dependencies":[{"issue_id":"bd-27i.5","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:51:14.529562Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.5","depends_on_id":"bd-27i.2","type":"blocks","created_at":"2026-02-06T22:52:19.833138Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.5","depends_on_id":"bd-27i.4","type":"blocks","created_at":"2026-02-06T22:52:19.884936Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.6","title":"Packaging: build dist/ + conditional exports for @agentlip/{protocol,workspace,client} (Node import)","description":"Context:\n\n- Implements most of Gate 5 from .context/plans/node-local-client.md.\n- Node cannot reliably import .ts from npm, so we need dist JS + exports mapping for Node consumers.\n\nScope boundaries:\n\n- âœ… IN scope: add tsc build output to dist/ for @agentlip/protocol, @agentlip/workspace, @agentlip/client; adjust each package.json exports to ship dist JS to Node while keeping bun -> src TS for dev; fix obvious Node-compat footguns (Timer typing, bun: imports) in these packages.\n- âŒ OUT of scope: CLI package (agentlip) local-client subpath export/dist (separate task), docs updates.\n\nDone means:\n\n- Each package has a reproducible build that outputs dist/*.js and dist/*.d.ts (ESM).\n- Exports are conditional, e.g. { types: ./dist/index.d.ts, bun: ./src/index.ts, import: ./dist/index.js } for relevant entrypoints (including @agentlip/client/local).\n- Published package files include dist/ (update package.json files list).\n- ws client code has no Bun-only Timer type; use ReturnType<typeof setTimeout>.\n- Confirm there are no bun: imports in protocol/workspace/client packages.\n\nVerification:\n\n- bun run typecheck\n- bun test packages/protocol packages/workspace packages/client (or bun test)\n- Optional smoke (local): node -e \"import { wsConnect } from \"@agentlip/client\"; console.log(typeof wsConnect)\" (from a local fixture using built dist).\n\nRed-Green-Refactor plan:\n\n- Red: add a minimal Node smoke script that fails before exports/dist exist.\n- Green: add dist build + exports updates until smoke passes.\n- Refactor: consolidate build configs (tsconfig.build.json) and keep exports consistent across packages.\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:51:32.128396Z","created_by":"cole","updated_at":"2026-02-07T01:34:24.382260Z","closed_at":"2026-02-07T01:34:24.382235Z","close_reason":"Implemented Gate 5 packaging for Node ESM imports:\n\n- Added per-package tsc build configs emitting ESM JS + d.ts to dist/:\n  - packages/{protocol,workspace,client}/tsconfig.build.json\n- Updated conditional exports so Bun/dev uses src TS while Node ESM uses dist JS and TS consumers use dist d.ts:\n  - @agentlip/protocol: exports[\".\"] { bun: ./src/index.ts, types: ./dist/index.d.ts, import: ./dist/index.js }\n  - @agentlip/workspace: same pattern\n  - @agentlip/client: same pattern for \".\" and \"./local\"\n- Updated package publish file lists to include dist/ (while excluding src/**/*.test.ts).\n- Updated root tsconfig.json to set compilerOptions.customConditions=[\"bun\"] so repo typecheck continues to resolve workspace deps to src without requiring dist in git.\n- Fixed Node-compat footgun in ws client: removed Bun-only Timer type (now ReturnType<typeof setTimeout>) and rewrote internal relative imports/exports to .js specifiers so emitted dist works under Node ESM.\n\nVerification:\n- bun run typecheck\n- bun test packages/protocol packages/workspace packages/client\n- bun run --filter @agentlip/{protocol,workspace,client} build\n- node smoke via temp node_modules symlinks: import(\"@agentlip/client\") and import(\"@agentlip/client/local\") succeeded.","source_repo":".","compaction_level":0,"original_size":0,"labels":["infra","sdk","tests","workspace","ws"],"dependencies":[{"issue_id":"bd-27i.6","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:51:32.128396Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.6","depends_on_id":"bd-27i.5","type":"blocks","created_at":"2026-02-06T22:52:19.934318Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.7","title":"CLI package: add agentlip/local-client re-export (Node-safe) + dist wiring","description":"Context:\n\n- Implements Gate 4 + the CLI portion of Gate 5 from .context/plans/node-local-client.md.\n- Provides the user-facing import: `import { connectToLocalAgentlip } from \"agentlip/local-client\"`.\n\nScope boundaries:\n\n- âœ… IN scope: packages/cli/src/local-client.ts that re-exports from @agentlip/client/local; packages/cli/package.json subpath export wiring (types/bun/import); ensure dist/local-client.js + dist/local-client.d.ts are built and published.\n- âŒ OUT of scope: implementing the local client itself (Gate 3) and hub changes (Gates 1-2).\n\nDone means:\n\n- Add packages/cli/src/local-client.ts with `export * from \"@agentlip/client/local\"`.\n- Update packages/cli/package.json exports with `./local-client` conditions: { types: ./dist/local-client.d.ts, bun: ./src/local-client.ts, import: ./dist/local-client.js }.\n- Ensure build pipeline emits dist/local-client.js + dist/local-client.d.ts and that package.json files includes these artifacts.\n- Pre-check for dependency cycles: after adding import, run bun run typecheck; if a circular dep is detected, document and adjust approach (fallback: users import from @agentlip/client/local directly).\n\nVerification:\n\n- bun run typecheck\n- bun test\n- Node smoke (after dist build): node -e \"import { connectToLocalAgentlip } from \"agentlip/local-client\"; console.log(typeof connectToLocalAgentlip)\"\n\nRed-Green-Refactor plan:\n\n- Red: add a smoke script/fixture that imports agentlip/local-client in Node and fails before exports/dist exist.\n- Green: wire exports + build output until smoke passes.\n- Refactor: keep exports consistent with other packages and avoid pulling Bun-only code into the subpath.\n","status":"closed","priority":2,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:51:47.381480Z","created_by":"cole","updated_at":"2026-02-07T01:38:02.632019Z","closed_at":"2026-02-07T01:38:02.631794Z","close_reason":"Implemented agentlip/local-client Node-safe re-export + dist wiring:\n\n- Added packages/cli/src/local-client.ts: `export * from \"@agentlip/client/local\"`.\n- Added packages/cli/tsconfig.build.json to emit dist/*.js + dist/*.d.ts.\n- Updated packages/cli/package.json:\n  - files includes dist/\n  - exports adds ./local-client with { bun: ./src/local-client.ts, types: ./dist/local-client.d.ts, import: ./dist/local-client.js }\n  - added dependency on @agentlip/client (so runtime import works)\n  - added build script: tsc -p tsconfig.build.json\n- Ran bun install to update workspace symlinks + bun.lock.\n\nVerification:\n- bun run typecheck\n- bun test packages/cli\n- bun run --filter agentlip build (plus @agentlip/{protocol,workspace,client} build)\n- Node smoke via temp node_modules symlinks: `import { connectToLocalAgentlip } from \"agentlip/local-client\"` succeeded.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","infra","sdk","tests"],"dependencies":[{"issue_id":"bd-27i.7","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:51:47.381480Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.7","depends_on_id":"bd-27i.5","type":"blocks","created_at":"2026-02-06T22:52:20.014781Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.7","depends_on_id":"bd-27i.6","type":"blocks","created_at":"2026-02-06T22:52:19.974195Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-27i.8","title":"Docs: document agentlipd up + idle shutdown + Node local-client usage","description":"Context:\n\n- Implements Gate 6 of .context/plans/node-local-client.md.\n- Aligns docs with the new hub CLI and the Node local client entrypoint.\n\nScope boundaries:\n\n- âœ… IN scope: docs/ops.md updates (agentlipd up, flags, idle shutdown behavior); README snippet with Node v22+ ESM usage example + Bun requirement.\n- âŒ OUT of scope: any code changes beyond documentation.\n\nDone means:\n\n- docs/ops.md describes `agentlipd up` (workspace/host/port/idle-shutdown-ms/--json) and notes token is persisted to server.json (0600) and never printed.\n- README includes a minimal Node example using `import { connectToLocalAgentlip } from \"agentlip/local-client\"` and states requirements: Bun installed, Node v22+, ESM-only.\n\nVerification:\n\n- Manual doc review for correctness against implemented flags and behavior.\n- (Optional) bun test to ensure no accidental breakage.\n\nRed-Green-Refactor plan:\n\n- Red: N/A (docs-only).\n- Green: update docs to match implementation.\n- Refactor: tighten wording; remove references to nonexistent commands.\n","status":"closed","priority":3,"issue_type":"task","assignee":"cole","created_at":"2026-02-06T22:51:57.278091Z","created_by":"cole","updated_at":"2026-02-07T01:41:11.055492Z","closed_at":"2026-02-07T01:41:11.055436Z","close_reason":"Updated docs for new daemon + Node local client:\n\n- docs/ops.md: documented `agentlipd up` flags (workspace/host/port/idle-shutdown-ms/--json), output formats, exit codes, and security note that auth token is persisted to .agentlip/server.json (0600) and never printed / must not appear in argv.\n- README.md: added Node v22+ ESM local client snippet (`import { connectToLocalAgentlip } from \"agentlip/local-client\"`) and clarified runtime requirements (Bun required to run hub/CLI and to spawn `agentlipd`).\n\nVerification: manual doc review against packages/hub/src/agentlipd.ts + hub idle shutdown behavior.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","docs","ops"],"dependencies":[{"issue_id":"bd-27i.8","depends_on_id":"bd-27i","type":"parent-child","created_at":"2026-02-06T22:51:57.278091Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.8","depends_on_id":"bd-27i.2","type":"blocks","created_at":"2026-02-06T22:52:20.053818Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-27i.8","depends_on_id":"bd-27i.7","type":"blocks","created_at":"2026-02-06T22:52:20.095158Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2bg","title":"npm Trusted Publishing (OIDC) + provenance migration","description":"Context:\n\n- Follow-up security hardening: remove long-lived NPM_TOKEN secrets by using npm Trusted Publishing with GitHub Actions OIDC and enable npm provenance.\n- Source plan: .context/plans/npm-trusted-publishing-oidc-draft.md\n\nDone means:\n\n- CI publishes on v* tags without storing an npm token (OIDC Trusted Publishing).\n- npm provenance is enabled for published packages.\n- Documentation and runbooks cover setup, troubleshooting, and rollback.\n\nVerification:\n\n- Rehearsal prerelease tag publish succeeds (see plan Gate D).\n- `npm view @agentlip/client version` returns the rehearsal version and provenance is visible in npm UI.\n\nRed-Green-Refactor plan:\n\n- Red: confirm current publish flow requires NPM_TOKEN.\n- Green: add OIDC path with safe fallback and rehearse on prerelease tag.\n- Refactor: remove token fallback and delete secret once proven.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-06T13:48:39.191076Z","created_by":"cole","updated_at":"2026-02-07T16:18:55.979756Z","closed_at":"2026-02-07T16:18:55.979735Z","close_reason":"OIDC + provenance migration complete.\n\nDelivered:\n- GitHub Actions publishing via npm Trusted Publishing (OIDC) with provenance + prerelease dist-tag handling.\n- Token fallback removed; no long-lived npm secrets required.\n- Runbooks updated for setup + troubleshooting + manual emergency publish.\n\nVerification:\n- Rehearsal prerelease publish succeeded: run 21782456493 (tag v0.1.1-rc.1)\n- `npm view @agentlip/client@0.1.1-rc.1 version` -> 0.1.1-rc.1; dist-tags include rc.\n- `gh secret list` / `gh variable list` show no NPM_TOKEN / USE_NPM_TOKEN in repo settings.","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","infra","ops","workflow"]}
{"id":"bd-2bg.1","title":"OIDC Gate A: confirm feasibility + decide CI publish mechanism (bun vs npm)","description":"Context:\n\n- npm Trusted Publishing (OIDC) typically works with npm CLI and provenance (npm publish --provenance).\n- Our current workflow uses bun publish + NPM_TOKEN. We must decide if we switch CI to npm publish to support OIDC.\n\nDone means:\n\n- .context/plans/npm-trusted-publishing-oidc-draft.md is updated with a clear decision (Gate A) including:\n  - whether bun publish can/cannot support OIDC + provenance\n  - selected mechanism (expected: npm publish)\n  - any required versions (Node/npm)\n- A concrete implementation checklist is produced for Gate B (exact flags and auth behavior).\n\nVerification:\n\n- Evidence captured (links to docs + a short note) that npm publish with setup-node registry-url uses OIDC Trusted Publishing.\n- Identify any edge cases for unscoped agentlip vs scoped @agentlip/* packages.\n\nRed-Green-Refactor plan:\n\n- Red: document current constraints and unknowns.\n- Green: lock decision + required toolchain versions.\n- Refactor: simplify Gate B steps to be minimal and robust.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T13:49:06.013600Z","created_by":"cole","updated_at":"2026-02-06T14:36:19.850287Z","closed_at":"2026-02-06T14:36:19.850074Z","close_reason":"Updated .context/plans/npm-trusted-publishing-oidc-draft.md Gate A with evidence links + concrete Gate B checklist mapping to publish.yml edits (setup-node registry-url, id-token, npm --provenance, avoid NODE_AUTH_TOKEN). Committed in e2f903d.","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","infra","workflow"],"dependencies":[{"issue_id":"bd-2bg.1","depends_on_id":"bd-2bg","type":"parent-child","created_at":"2026-02-06T13:49:06.013600Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2bg.2","title":"OIDC Gate B: update publish.yml to use OIDC + npm publish --provenance (token fallback temporary)","description":"Context:\n\n- To enable Trusted Publishing + provenance, CI must request id-token and publish via npm publish with --provenance.\n- We need a safe migration with an explicit token fallback while npm-side configuration rolls out.\n\nDone means:\n\n- .github/workflows/publish.yml is updated to support OIDC path:\n  - permissions include id-token: write\n  - setup-node is added (Node 20 LTS or pinned) with registry-url https://registry.npmjs.org\n  - publish steps use npm publish (scoped packages: --access public; all: --provenance in OIDC mode)\n  - publish order remains dependency-safe\n  - NPM_TOKEN fallback exists behind an explicit toggle (e.g. USE_NPM_TOKEN=1) and omits --provenance\n- Existing version consistency check and post-publish smoke test remain.\n\nVerification:\n\n- Workflow YAML validates.\n- Local reasoning: OIDC mode does not set NODE_AUTH_TOKEN; token fallback does.\n- Smoke test still installs and imports @agentlip/client for the published version.\n\nRed-Green-Refactor plan:\n\n- Red: add a dry-run step or comment explaining expected auth mode.\n- Green: implement OIDC path with minimal changes.\n- Refactor: remove duplication between token and OIDC publish steps; add clear failure messages.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":240,"created_at":"2026-02-06T13:49:06.098145Z","created_by":"cole","updated_at":"2026-02-06T16:20:35.160448Z","closed_at":"2026-02-06T16:20:35.160162Z","close_reason":"Updated .github/workflows/publish.yml to publish via npm with OIDC provenance by default (id-token: write + setup-node registry-url + npm publish --provenance) and an explicit token fallback controlled by vars.USE_NPM_TOKEN=='1'. Committed in ba3e307.","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","infra","workflow"],"dependencies":[{"issue_id":"bd-2bg.2","depends_on_id":"bd-2bg","type":"parent-child","created_at":"2026-02-06T13:49:06.098145Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.2","depends_on_id":"bd-2bg.1","type":"blocks","created_at":"2026-02-06T13:49:19.142254Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.2","depends_on_id":"bd-2dw.9","type":"blocks","created_at":"2026-02-06T13:49:19.289931Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2bg.3","title":"OIDC Gate C: manual npm Trusted Publishing configuration + runbook/docs","description":"Context:\n\n- npm Trusted Publishing must be enabled manually in npm UI per package and must match our GitHub workflow.\n- Maintainers need a copy-paste runbook.\n\nDone means:\n\n- New runbook exists: .context/runbooks/npm-trusted-publishing.md (or README section) containing exact steps and values:\n  - packages: @agentlip/protocol, @agentlip/kernel, @agentlip/workspace, @agentlip/client, @agentlip/hub, agentlip\n  - repo: phosphorco/agentlip\n  - workflow filename: publish.yml\n  - notes on environments if used\n- README Publishing section is updated to describe the migration and rollback (token fallback).\n\nVerification:\n\n- Another maintainer can follow docs without guesswork.\n\nRed-Green-Refactor plan:\n\n- Red: capture current token-based steps and where they live.\n- Green: add OIDC setup checklist + rollback steps.\n- Refactor: keep README concise and move long steps to runbook.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T13:49:06.129374Z","created_by":"cole","updated_at":"2026-02-06T16:20:35.195508Z","closed_at":"2026-02-06T16:20:35.195487Z","close_reason":"Added .context/runbooks/npm-trusted-publishing.md and updated README to document Trusted Publishing setup + USE_NPM_TOKEN rollback. Also aligned recovery docs with npm publish. Committed in ba3e307.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:docs","auth","ops"],"dependencies":[{"issue_id":"bd-2bg.3","depends_on_id":"bd-2bg","type":"parent-child","created_at":"2026-02-06T13:49:06.129374Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.3","depends_on_id":"bd-2bg.1","type":"blocks","created_at":"2026-02-06T13:49:19.176991Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.3","depends_on_id":"bd-2dw.9","type":"blocks","created_at":"2026-02-06T13:49:19.317022Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.3","depends_on_id":"bd-8t6.8","type":"blocks","created_at":"2026-02-06T13:49:19.388868Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2bg.4","title":"OIDC Gate D: rehearsal prerelease tag publish (OIDC)","description":"Context:\n\n- We need to prove OIDC publishes work before removing token auth.\n\nDone means:\n\n- A prerelease tag publish is executed (example: v0.1.1-rc.1) using the updated workflow in OIDC mode.\n- All packages publish successfully.\n- npm view checks and smoke test pass.\n\nVerification:\n\n- `npm view @agentlip/client version` returns the prerelease version\n- `npm view @agentlip/protocol version` returns the prerelease version\n- Smoke test (existing workflow step) passes\n\nRed-Green-Refactor plan:\n\n- Red: run the workflow and capture failure modes if OIDC not configured.\n- Green: fix config/workflow until publish succeeds.\n- Refactor: update runbook troubleshooting based on observed failures.","notes":"Execution checklist (OIDC rehearsal):\n\n1) Ensure npm Trusted Publishing is configured for ALL 6 packages (see .context/runbooks/npm-trusted-publishing.md).\n2) Ensure token fallback is OFF:\n   - GitHub repo Settings â†’ Variables â†’ Actions: USE_NPM_TOKEN should be unset or != 1.\n3) Cut a prerelease version via Craft Release Prepare workflow:\n   - Run https://github.com/phosphorco/agentlip/actions/workflows/release-prepare.yml with version like 0.1.1-rc.1\n   - Review/merge PR.\n4) Tag + push:\n   - git pull origin main\n   - git tag v0.1.1-rc.1 && git push origin v0.1.1-rc.1\n5) Monitor publish workflow run: https://github.com/phosphorco/agentlip/actions/workflows/publish.yml\n\nVerification:\n- npm view @agentlip/client version == 0.1.1-rc.1\n- npm view agentlip version == 0.1.1-rc.1\n- npm UI shows provenance for the published versions (package page â†’ provenance)\n\nFailure handling:\n- If publish fails with 403, re-check per-package Trusted Publisher settings and workflow filename publish.yml.\n- If you must unblock quickly, set USE_NPM_TOKEN=1 and cut a NEW prerelease tag (provenance will be missing in token mode).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T13:49:06.158372Z","created_by":"cole","updated_at":"2026-02-07T15:49:41.108752Z","closed_at":"2026-02-07T15:49:41.108731Z","close_reason":"Gate D rehearsal succeeded after npm Trusted Publishing config + repo made public.\n\nEvidence:\n- GitHub Actions publish workflow succeeded: run 21782456493 (tag v0.1.1-rc.1)\n- All packages published via OIDC path with npm 11.x + explicit dist-tag (rc) for prerelease.\n\nVerification:\n- `npm view @agentlip/protocol@0.1.1-rc.1 version` -> 0.1.1-rc.1\n- `npm view @agentlip/client@0.1.1-rc.1 version` -> 0.1.1-rc.1\n- `npm view agentlip@0.1.1-rc.1 version` -> 0.1.1-rc.1\n- dist-tags:\n  - `npm view @agentlip/client dist-tags` => { latest: 0.1.0, rc: 0.1.1-rc.1 }\n  - `npm view agentlip dist-tags` => { latest: 0.1.0, rc: 0.1.1-rc.1 }\n- Post-publish smoke test step passed in workflow}","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","ops","workflow"],"dependencies":[{"issue_id":"bd-2bg.4","depends_on_id":"bd-2bg","type":"parent-child","created_at":"2026-02-06T13:49:06.158372Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.4","depends_on_id":"bd-2bg.2","type":"blocks","created_at":"2026-02-06T13:49:19.206469Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.4","depends_on_id":"bd-2bg.3","type":"blocks","created_at":"2026-02-06T13:49:19.236084Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.4","depends_on_id":"bd-2bg.6","type":"blocks","created_at":"2026-02-07T04:29:50.064108Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.4","depends_on_id":"bd-2dw.9","type":"blocks","created_at":"2026-02-06T13:49:19.341051Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bd-2bg.4","author":"Cole Lawrence","text":"OIDC rehearsal run-sheet (bd-2bg.4) â€” suggested exact checklist\n\nPre-flight:\n- Confirm npm Trusted Publishing is configured for ALL packages: protocol, kernel, workspace, client, cli, hub.\n- Confirm repo Actions variable USE_NPM_TOKEN is unset or != '1' (so workflow takes OIDC path).\n\nRehearsal publish:\n1 Run Craft Release Prepare for a prerelease (example: 0.1.1-rc.1).\n2) Merge the generated release PR.\n3) Tag + push: git tag v0.1.1-rc.1 && git push --tags\n4) Watch Actions run for publish.yml.\n\nVerification:\n- npm view @agentlip/client version == 0.1.1-rc.1 (repeat for protocol/kernel/workspace/cli/hub)\n- Confirm publish workflow ran OIDC path (npm publish --provenance).\n- Confirm provenance badge/attestation appears on npm package pages.\n\nIf failure mid-sequence:\n- Re-run from same tag is acceptable; already-published packages may 403; continue to next.\n- If 403 on an unpublished package, wait ~5 min (npm propagation) then retry.\n\nRefs:\n- .context/runbooks/npm-trusted-publishing.md\n- .github/workflows/publish.yml\nEOF\n)","created_at":"2026-02-06T18:31:52Z"},{"id":2,"issue_id":"bd-2bg.4","author":"Cole Lawrence","text":"Gate D rehearsal attempted via tag v0.1.1-rc.1 (OIDC path) â€” publish is currently failing at the FIRST package (@agentlip/protocol).\n\nEvidence:\n- Publish run 21773900617 (and rerun) failed on step `Publish @agentlip/protocol (OIDC)`:\n  - `npm notice Access token expired or revoked. Please try logging in again.`\n  - `npm error 404 Not Found - PUT https://registry.npmjs.org/@agentlip%2fprotocol - Not found`\n  - `npm view @agentlip/protocol@0.1.1-rc.1 version` => not published\n- Tried workflow experiments:\n  - Node 22: no change (same failure)\n  - Removing setup-node registry-url: publish fails earlier with `npm error ENEEDAUTH need auth` (no OIDC auth happening without setup-node registry config)\n\nConclusion / next action:\n- This strongly suggests npm Trusted Publishing is NOT correctly configured (or is mis-matched) for at least `@agentlip/protocol` (and possibly other packages). Please re-check npm UI per package:\n  - Provider: GitHub Actions\n  - Repo owner: phosphorco\n  - Repo name: agentlip\n  - Workflow filename: publish.yml\n  - Environment name: (blank)\n\nOnce fixed, re-run the publish workflow for v0.1.1-rc.1 (or retag to a fresh prerelease like v0.1.1-rc.2).\n\nNote: tag v0.1.1-rc.1 was force-moved during debugging; current remote tag points at commit fe52787 (workflow experiment). The last known-good workflow config restoring setup-node registry-url is on main at commit 1982522; move the tag back to that (or cut a new tag) before rerunning.","created_at":"2026-02-07T04:25:58Z"}]}
{"id":"bd-2bg.5","title":"OIDC Gate E: remove NPM_TOKEN fallback + delete secret","description":"Context:\n\n- After successful OIDC rehearsal, we should remove token-based auth to eliminate the long-lived secret.\n\nDone means:\n\n- .github/workflows/publish.yml no longer supports token fallback; OIDC only.\n- README/runbooks remove NPM_TOKEN instructions (or clearly mark deprecated).\n- GitHub repository secret NPM_TOKEN is removed (manual).\n\nVerification:\n\n- Publish workflow cannot succeed without OIDC trusted publishing configured.\n- A tag publish succeeds in OIDC-only mode.\n\nRed-Green-Refactor plan:\n\n- Red: ensure rehearsal evidence is recorded (Gate D).\n- Green: remove fallback logic and update docs.\n- Refactor: simplify workflow, remove dead branches, keep failure messages clear.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T13:49:13.573146Z","created_by":"cole","updated_at":"2026-02-07T16:18:48.090497Z","closed_at":"2026-02-07T16:18:48.090437Z","close_reason":"Gate E implemented: CI publishing is now OIDC-only (Trusted Publishing) and token fallback removed.\n\nCode/docs changes:\n- .github/workflows/publish.yml: removed all USE_NPM_TOKEN branching + NPM_TOKEN env usage; publishes via OIDC only (with prerelease dist-tag + provenance).\n- README.md + runbooks updated to remove token-fallback instructions and document cleanup.\n\nManual cleanup verification:\n- `gh secret list --repo phosphorco/agentlip --app actions` shows no repo Actions secrets (NPM_TOKEN not present).\n- `gh variable list --repo phosphorco/agentlip` shows no Actions variables (USE_NPM_TOKEN not present).\n\nEvidence that OIDC publishing works:\n- Prerelease rehearsal publish succeeded via OIDC: GitHub Actions run 21782456493 (tag v0.1.1-rc.1) and `npm view @agentlip/client@0.1.1-rc.1 version` -> 0.1.1-rc.1.","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","security","workflow"],"dependencies":[{"issue_id":"bd-2bg.5","depends_on_id":"bd-2bg","type":"parent-child","created_at":"2026-02-06T13:49:13.573146Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.5","depends_on_id":"bd-2bg.4","type":"blocks","created_at":"2026-02-06T13:49:19.263039Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2bg.5","depends_on_id":"bd-2dw.9","type":"blocks","created_at":"2026-02-06T13:49:19.364984Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":3,"issue_id":"bd-2bg.5","author":"Cole Lawrence","text":"Implemented Gate E code/docs changes on main:\n- .github/workflows/publish.yml is now OIDC-only (removed USE_NPM_TOKEN + NPM_TOKEN fallback steps).\n- README + runbooks updated to remove token fallback instructions and document manual cleanup.\n\nNext manual step (required to fully complete Gate E):\n- Delete GitHub Actions secret `NPM_TOKEN` (Settings â†’ Secrets and variables â†’ Actions â†’ Secrets)\n- Delete Actions variable `USE_NPM_TOKEN` if it exists (Settings â†’ Secrets and variables â†’ Actions â†’ Variables)\n\nPlease confirm once deleted; then we can close bd-2bg.5.","created_at":"2026-02-07T16:11:11Z"}]}
{"id":"bd-2bg.6","title":"Manual: verify/fix npm Trusted Publishing config (all packages)","description":"Context:\n- OIDC publish rehearsal (bd-2bg.4) is failing with auth-like errors (`Access token expired or revoked` + `404 Not Found` on PUT to registry). This strongly suggests npm Trusted Publishing is not configured (or is misconfigured) for at least one package.\n\nDone means:\n- In npm UI, each of these packages shows a Trusted Publisher for GitHub Actions matching exactly:\n  - Provider: GitHub Actions\n  - Repository owner: phosphorco\n  - Repository name: agentlip\n  - Workflow filename: publish.yml\n  - Environment name: (blank)\n- Packages to verify:\n  - @agentlip/protocol\n  - @agentlip/kernel\n  - @agentlip/workspace\n  - @agentlip/client\n  - @agentlip/hub\n  - agentlip\n\nVerification:\n- After config is corrected, rerun the publish workflow for the prerelease tag and confirm the OIDC publish step succeeds for @agentlip/protocol.\n\nNotes:\n- This is a manual task in npmjs.com UI (may require Cloudflare-capable browser/network).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T04:29:41.103765Z","created_by":"cole","updated_at":"2026-02-07T15:49:31.283827Z","closed_at":"2026-02-07T15:49:31.283650Z","close_reason":"Verified/fixed npm Trusted Publishing config (manual npm UI) and made repo public for provenance.\n\nEvidence:\n- Publish workflow rerun succeeded: GitHub Actions run 21782456493 (tag v0.1.1-rc.1)\n- OIDC publishes proceeded (token fallback steps skipped) and provenance signing succeeded.\n\nVerification:\n- `npm view @agentlip/protocol@0.1.1-rc.1 version` -> 0.1.1-rc.1\n- `npm view @agentlip/client dist-tags` shows `rc: 0.1.1-rc.1` (latest remains 0.1.0)}","source_repo":".","compaction_level":0,"original_size":0,"labels":["auth","ops","workflow"],"dependencies":[{"issue_id":"bd-2bg.6","depends_on_id":"bd-2bg","type":"parent-child","created_at":"2026-02-07T04:29:41.103765Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw","title":"npm publish setup for @agentlip/*","description":"Make all 6 @agentlip/* packages publishable to npmjs.org.\n\nContext:\n- 6 packages: protocol, kernel, workspace, client, cli, hub\n- Bun-only (no Node compat) â€” declare engines, ship .ts source\n- All packages share one version, bumped in lockstep\n- GitHub Actions workflow publishes on version tag push (v*)\n\nPlan: .context/plans/npm-publish-setup.md\n\nDone means:\n- All 6 packages live on npmjs.org under @agentlip/\n- bun add @agentlip/client works in a fresh Bun project\n- Tag-based CI publish workflow operational\n- README documents the release process","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-05T23:10:47.013358Z","created_by":"cole","updated_at":"2026-02-06T16:20:39.734857Z","closed_at":"2026-02-06T16:20:39.734823Z","close_reason":"npm publish setup is complete: all packages are live on npm (0.1.0) and tag-based publish workflow exists. Verified via npm view versions and successful first publish (bd-2dw.9 closed).","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","infra","ops"]}
{"id":"bd-2dw.1","title":"Move migrations/ into packages/kernel/migrations/ and export MIGRATIONS_DIR","description":"Context:\n- migrations/*.sql currently lives at repo root, but npm packs relative to package dir\n- Kernel is the only consumer; migration SQL must ship inside the kernel package\n- Hub and 6+ test files reference '../../../migrations' â€” all must be updated\n\nDone means:\n- migrations/ dir moved to packages/kernel/migrations/\n- packages/kernel/src/index.ts exports MIGRATIONS_DIR constant:\n  `export const MIGRATIONS_DIR = join(import.meta.dir, '../migrations');`\n- packages/hub/src/index.ts imports and uses KERNEL_MIGRATIONS_DIR from @agentlip/kernel\n- All test files updated (integrationHarness.ts, linkifierDerived.test.ts, extractorDerived.test.ts, crash-safety.test.ts, derivedStaleness.test.ts, wsEndpoint.test.ts)\n- bun.lock regenerated after move\n\nVerification:\n- bun run typecheck â€” 0 errors\n- bun test â€” all 725+ tests pass\n- ls packages/kernel/migrations/*.sql shows both migration files\n- grep -r '../../../migrations' packages/ returns 0 hits","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T23:10:58.046401Z","created_by":"cole","updated_at":"2026-02-06T01:46:47.572822Z","closed_at":"2026-02-06T01:46:47.572593Z","close_reason":"Moved migrations/ to packages/kernel/migrations/. Exported MIGRATIONS_DIR from kernel. Updated all 18 references across hub and kernel source+test files. Verification: typecheck 0 errors, 725/725 tests pass, grep for stale paths returns 0 hits.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages"],"dependencies":[{"issue_id":"bd-2dw.1","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:10:58.046401Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.10","title":"Rename CLI package from @agentlip/cli to top-level 'agentlip'","description":"Context:\n- The CLI should be installable as `bunx agentlip` or `bun add -g agentlip` â€” a top-level unscoped package\n- Supporting libraries stay under @agentlip/ scope (protocol, kernel, workspace, client, hub)\n- No other package depends on @agentlip/cli, so this is a name-only change + docs/workflow updates\n\nDone means:\n- packages/cli/package.json name is 'agentlip' (not @agentlip/cli)\n- Runtime guard error message updated\n- .github/workflows/publish.yml updated (step name, --access public not needed for unscoped)\n- README.md table and install instructions updated\n- Comments/JSDoc in cli package updated\n- CLI README updated\n- verify.ts updated\n- AGENTS.md updated if referencing @agentlip/cli\n- bun install succeeds, typecheck clean, all tests pass\n\nVerification:\n- jq .name packages/cli/package.json â€” returns 'agentlip'\n- grep '@agentlip/cli' packages/ -r â€” 0 hits (only in .context/plans and .plan-improvement-rounds)\n- bun run typecheck â€” 0 errors\n- bun test â€” all pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-06T10:12:41.505833Z","created_by":"cole","updated_at":"2026-02-06T10:14:08.995332Z","closed_at":"2026-02-06T10:14:08.995306Z","close_reason":"Renamed CLI package from @agentlip/cli to top-level 'agentlip'. Updated package.json name, runtime guard, publish workflow (no --access public needed for unscoped), README, CLI README, JSDoc comments, verify.ts. bun install clean, typecheck 0 errors, 725/725 tests pass. Zero stale @agentlip/cli references in packages/.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages"],"dependencies":[{"issue_id":"bd-2dw.10","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-06T10:12:41.505833Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.2","title":"Add MIT LICENSE and publishing metadata to all 6 package.json files","description":"Context:\n- All 6 packages currently have private:true, version 0.0.0, no license/description/repository\n- Need to configure for public npm publishing under @agentlip/ scope\n\nDone means:\n- LICENSE file at repo root (MIT, copyright Phosphor)\n- All 6 packages/*/package.json updated:\n  - Remove private:true\n  - version: 0.1.0\n  - engines: { bun: '>=1.0.0' }\n  - license: MIT\n  - repository: { type: git, url: git+https://github.com/phosphorco/agentlip.git, directory: packages/<name> }\n  - description field (one-liner per package)\n  - homepage: https://github.com/phosphorco/agentlip\n- files arrays configured (with test exclusions):\n  - protocol: ['src/', '!src/**/*.test.ts']\n  - kernel: ['src/', 'migrations/', '!src/**/*.test.ts']\n  - workspace: ['src/', '!src/**/*.test.ts']\n  - client: ['src/', '!src/**/*.test.ts']\n  - cli: ['src/', '!src/**/*.test.ts']\n  - hub: ['src/', '!src/**/*.test.ts', '!src/integrationHarness.ts']\n\nVerification:\n- bun run typecheck â€” 0 errors\n- bun test â€” all pass\n- For each package: cd packages/<name> && npm pack --dry-run shows only intended files (no tests, no .test.ts)\n- cat LICENSE contains MIT text","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T23:11:07.829142Z","created_by":"cole","updated_at":"2026-02-06T01:49:19.070348Z","closed_at":"2026-02-06T01:49:19.070087Z","close_reason":"MIT LICENSE created. All 6 package.json files updated: private removed, version 0.1.0, engines bun>=1.0.0, files arrays with test exclusions, description/repository/homepage/license fields. Typecheck clean, 725/725 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages"],"dependencies":[{"issue_id":"bd-2dw.2","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:07.829142Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.2","depends_on_id":"bd-2dw.1","type":"blocks","created_at":"2026-02-05T23:12:12.992163Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.3","title":"Add Bun runtime guards to CLI and Hub binaries","description":"Context:\n- npm does not enforce engines field by default\n- Users who install on Node get cryptic TypeScript/import errors\n- Only binary entrypoints need guards (not library packages)\n\nDone means:\n- packages/cli/src/agentlip.ts has runtime guard after shebang:\n  if (typeof Bun === 'undefined') { console.error('Error: agentlip requires Bun (https://bun.sh)'); process.exit(1); }\n- packages/hub/src/agentlipd.ts has same guard\n- Library packages (protocol, kernel, workspace, client) do NOT have guards\n\nVerification:\n- bun run typecheck â€” 0 errors\n- bun test â€” all pass\n- grep 'typeof Bun' packages/cli/src/agentlip.ts packages/hub/src/agentlipd.ts â€” both match","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T23:11:14.516947Z","created_by":"cole","updated_at":"2026-02-06T01:51:56.434163Z","closed_at":"2026-02-06T01:51:56.433940Z","close_reason":"Bun runtime guards added to packages/cli/src/agentlip.ts and packages/hub/src/agentlipd.ts. Users on Node get clear error message. Typecheck clean, 725/725 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages"],"dependencies":[{"issue_id":"bd-2dw.3","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:14.516947Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.3","depends_on_id":"bd-2dw.2","type":"blocks","created_at":"2026-02-05T23:12:13.025613Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.4","title":"Remove hub test-harness export and add .npmignore","description":"Context:\n- Hub package.json has exports['./test-harness'] pointing to integrationHarness.ts\n- This file is dev-only and excluded from files array â€” dangling export causes confusing errors\n- Need .npmignore as defense-in-depth for common artifacts\n\nDone means:\n- packages/hub/package.json: './test-harness' removed from exports\n- Root .npmignore created with: .DS_Store, *.swp, *.swo, .idea/, .vscode/, *.log\n- Verify no other code imports from '@agentlip/hub/test-harness' outside of test files\n  (test files use relative imports to integrationHarness.ts, not the package export)\n\nVerification:\n- bun run typecheck â€” 0 errors\n- bun test â€” all pass\n- jq '.exports' packages/hub/package.json â€” no test-harness key\n- cat .npmignore â€” contains expected patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T23:11:22.411824Z","created_by":"cole","updated_at":"2026-02-06T01:51:56.467599Z","closed_at":"2026-02-06T01:51:56.467580Z","close_reason":"Removed ./test-harness export from hub package.json. Updated CLI test imports to use relative paths (26 occurrences). Created root .npmignore. Typecheck clean, 725/725 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages"],"dependencies":[{"issue_id":"bd-2dw.4","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:22.411824Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.4","depends_on_id":"bd-2dw.2","type":"blocks","created_at":"2026-02-05T23:12:13.063337Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.5","title":"Verify workspace:* resolution and publishability (dry-run all 6 packages)","description":"Context:\n- bun publish resolves workspace:* -> pinned versions automatically\n- Need to verify tarballs are correct before first real publish\n- Gate 2 of npm-publish-setup plan\n\nDone means:\n- bun publish --dry-run succeeds for all 6 packages\n- Extracted tarballs show resolved versions (e.g. '@agentlip/protocol': '0.1.0'), NOT workspace:*\n- Binary shebangs verified: head -1 packages/cli/src/agentlip.ts outputs #!/usr/bin/env bun\n- Tarball contents verified: no test files, no .DS_Store, no integrationHarness.ts in hub\n- Hub exports field has no ./test-harness entry\n\nVerification:\n- For each package:\n  cd packages/<name> && bun publish --dry-run 2>&1\n- Extract client tarball and inspect:\n  cd packages/client && tar -xzf *.tgz && cat package/package.json | grep -A5 dependencies\n  -> must show '0.1.0' not 'workspace:*'\n  rm -rf package *.tgz","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T23:11:30.909234Z","created_by":"cole","updated_at":"2026-02-06T01:55:23.359493Z","closed_at":"2026-02-06T01:55:23.359268Z","close_reason":"All 6 packages pass dry-run publish. Tarballs verified: no test files, no integrationHarness, kernel includes migrations. Shebangs correct. Hub exports clean. workspace:* not resolved by npm pack (expected) â€” bun publish resolves at publish time per Bun workspace protocol.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","ops"],"dependencies":[{"issue_id":"bd-2dw.5","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:30.909234Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.5","depends_on_id":"bd-2dw.2","type":"blocks","created_at":"2026-02-05T23:12:13.090625Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.5","depends_on_id":"bd-2dw.3","type":"blocks","created_at":"2026-02-05T23:12:13.114674Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.5","depends_on_id":"bd-2dw.4","type":"blocks","created_at":"2026-02-05T23:12:13.139111Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.6","title":"Create version bump script (scripts/bump-version.sh)","description":"Context:\n- All 6 packages share one version, bumped in lockstep\n- Need a script to prevent version drift (forgetting to bump some packages)\n\nDone means:\n- scripts/bump-version.sh <version> exists and is executable\n- Updates version field in all 6 packages/*/package.json\n- Validates version format (semver-ish: X.Y.Z)\n- Prints summary of changes\n- Does NOT commit or tag (that's the maintainer's job)\n\nVerification:\n- ./scripts/bump-version.sh 0.2.0 â€” updates all 6 files\n- grep '\"version\"' packages/*/package.json â€” all show 0.2.0\n- ./scripts/bump-version.sh 0.1.0 â€” revert back\n- ./scripts/bump-version.sh bad-version â€” should error","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T23:11:37.720896Z","created_by":"cole","updated_at":"2026-02-06T01:46:47.609324Z","closed_at":"2026-02-06T01:46:47.609303Z","close_reason":"Created scripts/bump-version.sh. Validates semver, updates all 6 package.json files via jq with preserved formatting. Tested: valid versions, invalid versions, pre-release, revert all pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["infra","ops"],"dependencies":[{"issue_id":"bd-2dw.6","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:37.720896Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.7","title":"Create GitHub Actions publish workflow (.github/workflows/publish.yml)","description":"Context:\n- Trigger: push of tags matching v* (e.g. v0.1.0)\n- Must publish in dependency order with delays for npm propagation\n- Gate 3 of npm-publish-setup plan\n\nDone means:\n- .github/workflows/publish.yml created with:\n  - Trigger: push tags v*\n  - Steps: checkout, setup bun, install, typecheck, test (FTS=0 only)\n  - Pre-publish version consistency check (all 6 package versions match tag)\n  - Publish in order: protocol -> kernel -> workspace -> client -> cli -> hub\n  - sleep 5 between each publish for npm CDN propagation\n  - NPM_TOKEN from repository secret, never echoed/logged\n  - Post-publish smoke test: install @agentlip/client in temp dir, verify import works\n- Version check script embedded:\n  VERSION=${GITHUB_REF_NAME#v}\n  for pkg in protocol kernel workspace client cli hub; do\n    PKG_VERSION=$(jq -r .version packages/$pkg/package.json)\n    test \"$PKG_VERSION\" = \"$VERSION\" || exit 1\n  done\n\nVerification:\n- yamllint .github/workflows/publish.yml (or manual review)\n- Workflow has correct trigger, publish order, version check, smoke test\n- Does not echo or log NPM_TOKEN","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T23:11:47.716206Z","created_by":"cole","updated_at":"2026-02-06T01:56:59.854144Z","closed_at":"2026-02-06T01:56:59.853934Z","close_reason":"Created .github/workflows/publish.yml. Tag-triggered (v*), version consistency check, publish in dependency order with 5s propagation delays, post-publish smoke test. Uses NPM_TOKEN secret, --no-git-checks for CI.","source_repo":".","compaction_level":0,"original_size":0,"labels":["infra","ops"],"dependencies":[{"issue_id":"bd-2dw.7","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:47.716206Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.7","depends_on_id":"bd-2dw.5","type":"blocks","created_at":"2026-02-05T23:12:13.188965Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.7","depends_on_id":"bd-2dw.6","type":"blocks","created_at":"2026-02-05T23:12:13.163903Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.8","title":"Add Publishing section to README and document release/recovery process","description":"Context:\n- README needs to document how releases work for maintainers\n- Include recovery procedure for partial publish failures\n\nDone means:\n- README.md has a Publishing section covering:\n  - Prerequisites: npm login, @agentlip scope claimed, NPM_TOKEN in GitHub secrets\n  - Release flow: bump-version.sh -> commit -> git tag v<version> -> push --tags\n  - What the CI does (typecheck, test, publish in order, smoke test)\n  - Recovery for partial publish failure:\n    1. Check which packages succeeded (npm view @agentlip/<pkg> version)\n    2. Manually publish remaining: cd packages/<pkg> && NPM_TOKEN=... bun publish --access public\n    3. 72h unpublish window for bad versions; after that, publish a patch\n  - Bun requirement note for consumers\n\nVerification:\n- grep -c 'Publishing' README.md â€” at least 1 match\n- Section is readable and contains recovery steps","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T23:11:56.184512Z","created_by":"cole","updated_at":"2026-02-06T01:58:12.941894Z","closed_at":"2026-02-06T01:58:12.941860Z","close_reason":"Added Publishing section to README.md covering: prerequisites, release process (bump-version.sh -> tag -> CI publish), manual publish fallback, recovery procedures (72h unpublish window). Matches existing README style.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:docs"],"dependencies":[{"issue_id":"bd-2dw.8","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:11:56.184512Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.8","depends_on_id":"bd-2dw.7","type":"blocks","created_at":"2026-02-05T23:12:13.213041Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2dw.9","title":"Claim @agentlip npm scope and first publish (manual)","description":"Context:\n- Manual step â€” cannot be automated by CI\n- Must happen before public announcement (scope squatting risk)\n- Gate 4 of npm-publish-setup plan\n\nDone means:\n- @agentlip scope exists on npmjs.org (org or user scope)\n- NPM_TOKEN (Automation type, publish-only scope) set in GitHub repo secrets\n- First publish triggered: bump-version.sh 0.1.0, commit, tag v0.1.0, push --tags\n- All 6 packages visible on npmjs.org\n- Smoke test: bun add @agentlip/client in fresh project, import { createChannel } works\n\nVerification:\n- npm view @agentlip/protocol version â€” returns 0.1.0\n- npm view @agentlip/client version â€” returns 0.1.0\n- bun init -y && bun add @agentlip/client â€” succeeds","notes":"Verification: npm view @agentlip/protocol/kernel/workspace/client/hub version == 0.1.0; npm view agentlip version == 0.1.0.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T23:12:03.866793Z","created_by":"cole","updated_at":"2026-02-06T16:13:52.654968Z","closed_at":"2026-02-06T16:12:51.079891Z","close_reason":"Manual first publish completed. Verified via npm: @agentlip/protocol/kernel/workspace/client/hub and unscoped agentlip all report version 0.1.0 ().","source_repo":".","compaction_level":0,"original_size":0,"labels":["ops"],"dependencies":[{"issue_id":"bd-2dw.9","depends_on_id":"bd-2dw","type":"parent-child","created_at":"2026-02-05T23:12:03.866793Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.9","depends_on_id":"bd-2dw.7","type":"blocks","created_at":"2026-02-05T23:12:13.238651Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2dw.9","depends_on_id":"bd-2dw.8","type":"blocks","created_at":"2026-02-05T23:12:13.263015Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2qm","title":"Event Trace Explorer (Hub UI)","description":"Context:\n\n- Implement the Event Trace Explorer per .context/plans/event-trace-explorer.md.\n- Goal: make the append-only event stream visible and navigable in the Hub UI for human review/traceability.\n\nScope boundaries:\n\n- âœ… IN scope: read-only /ui/events page; additive HTTP /api/v1/events extensions; additive WS EventEnvelope entity field; docs/tests.\n- âŒ OUT of scope: auth model changes; CSP hardening; export/snapshot tooling; server-side search; frontend build step.\n\nDone means:\n\n- Child tasks for Gates Aâ€“D are closed with verification evidence.\n\nVerification:\n\n- bun run typecheck\n- bun test\n- Manual smoke: start hub, open /ui/events, confirm live tail + deep links.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-07T21:19:20.825510Z","created_by":"cole","updated_at":"2026-02-07T21:56:49.362150Z","closed_at":"2026-02-07T21:56:49.362130Z","close_reason":"Completed Event Trace Explorer epic: Gate A extended /api/v1/events (replay_until + scope/entity + tail/filters), Gate B added /ui/events live timeline, Gate C added deep-link hash scroll/highlight+hint, Gate D added WS EventEnvelope entity field + client types/docs. Verification: bun run typecheck; bun test packages/hub; bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","hub","ui"]}
{"id":"bd-2qm.1","title":"Gate A: Extend GET /api/v1/events for explorer","description":"Context:\n\n- Implement Gate A from .context/plans/event-trace-explorer.md.\n- Hub currently exposes a minimal /api/v1/events shape; the explorer needs scope/entity + tailing and filters.\n\nScope boundaries:\n\n- âœ… IN scope: packages/hub/src/apiV1.ts (handleListEvents); packages/hub/src/apiV1.test.ts; docs/protocol.md updates for HTTP; any small kernel query helper changes needed to support tail/filter efficiently.\n- âŒ OUT of scope: /ui/events page (Gate B), deep links/hash behavior (Gate C), WS envelope changes (Gate D).\n\nDone means:\n\n- GET /api/v1/events response is additive and includes replay_until plus per-event scope + entity.\n- Supports tail=<n> with server clamp 1..1000; tail is mutually exclusive with after (both -> 400 INVALID_INPUT).\n- Supports repeatable channel_id/topic_id filters with OR semantics; malformed IDs (regex in plan) -> 400 INVALID_INPUT; unknown IDs -> empty results.\n- docs/protocol.md documents the new response fields and query param semantics.\n\nVerification:\n\n- bun run typecheck\n- bun test packages/hub\n- bun test\n\nRed-Green-Refactor plan:\n\n- Red: add/update apiV1 tests for tail/filters/additive fields.\n- Green: implement handler changes until tests pass.\n- Refactor: tidy parsing/validation helpers, keep response stable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T21:19:46.066143Z","created_by":"cole","updated_at":"2026-02-07T21:33:36.759141Z","closed_at":"2026-02-07T21:33:36.759104Z","close_reason":"Implemented Gate A /api/v1/events extensions (replay_until + scope/entity, tail=<n> clamp, channel_id/topic_id filters, after+tail 400) with kernel tailEvents bounded by replay_until; updated docs/protocol and hub tests. Verification: bun run typecheck; bun test packages/hub; bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","events","hub"],"dependencies":[{"issue_id":"bd-2qm.1","depends_on_id":"bd-2qm","type":"parent-child","created_at":"2026-02-07T21:19:46.066143Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":4,"issue_id":"bd-2qm.1","author":"Cole Lawrence","text":"Learning: bound tailEvents() by replay_until (event_id <= replayUntil) so HTTP tail responses are consistent with the WS handshake boundary; also parse query ints defensively (avoid NaN/partial parse) and avoid echoing raw invalid IDs in error messages.","created_at":"2026-02-07T21:33:31Z"}]}
{"id":"bd-2qm.2","title":"Gate B: Add /ui/events timeline + live tail","description":"Context:\n\n- Implement Gate B from .context/plans/event-trace-explorer.md: a no-build UI page to browse and tail events.\n\nScope boundaries:\n\n- âœ… IN scope: packages/hub/src/ui.ts (/ui/events route + nav link), packages/hub/src/ui.test.ts, inline HTML/CSS/JS for timeline + details + live WS tail; safe JSON rendering (no innerHTML for untrusted payloads).\n- âŒ OUT of scope: HTTP API contract changes (Gate A), deep-link/hash highlight behavior (Gate C), WS envelope entity field (Gate D).\n\nDone means:\n\n- /ui/events is reachable from existing pages and renders last 200 events (tail=200) from the API.\n- Live tail via WS works (hello after_event_id = http replay_until; reconnect + dedupe + bounded memory per plan).\n- Event details render JSON via JSON.stringify + textContent; no XSS footguns.\n- Basic client-side filters exist (name substring; scope.channel_id/topic_id).\n\nVerification:\n\n- bun run typecheck\n- bun test packages/hub\n- Manual smoke: start hub, create message, open /ui/events and observe live events + pause/resume.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T21:19:54.692839Z","created_by":"cole","updated_at":"2026-02-07T21:51:21.939568Z","closed_at":"2026-02-07T21:51:21.939552Z","close_reason":"Added /ui/events timeline UI (tail=200 + expandable JSON + client-side filters + pause/buffer + WS live tail + reconnect) and nav links; updated ui.test.ts coverage. Verification: bun run typecheck; bun test packages/hub; bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","hub","ui"],"dependencies":[{"issue_id":"bd-2qm.2","depends_on_id":"bd-2qm","type":"parent-child","created_at":"2026-02-07T21:19:54.692839Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2qm.2","depends_on_id":"bd-2qm.1","type":"blocks","created_at":"2026-02-07T21:20:18.408581Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":5,"issue_id":"bd-2qm.2","author":"Cole Lawrence","text":"Learning: /ui/events is no-build inline JS; easiest implementation re-renders the table from state on updates. If perf becomes an issue at 2k+ events, optimize to incremental DOM appends + scroll anchoring.","created_at":"2026-02-07T21:51:10Z"}]}
{"id":"bd-2qm.3","title":"Gate C: Deep links from events -> topics/messages","description":"Context:\n\n- Implement Gate C from .context/plans/event-trace-explorer.md: navigation from event rows to relevant entities.\n\nScope boundaries:\n\n- âœ… IN scope: /ui/events rendering of links (topic and message); packages/hub/src/ui.ts topic page hash handling (scroll/highlight or hint); packages/hub/src/ui.test.ts updates.\n- âŒ OUT of scope: API changes (Gate A), initial /ui/events page scaffolding (Gate B), WS envelope changes (Gate D).\n\nDone means:\n\n- Topic-scoped events link to /ui/topics/:topic_id when scope.topic_id is present and ID validates.\n- Message-scoped events (entity.type==\"message\") link to /ui/topics/:topic_id#msg_<message_id> when IDs validate.\n- Topic page scrolls+highlights when message is present, else shows \"Message not currently loaded\" hint (last-50 limitation).\n\nVerification:\n\n- bun run typecheck\n- bun test packages/hub\n- Automated: ui.test asserts message hash links are emitted for message-scoped events; manual click-through works.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-07T21:20:02.023389Z","created_by":"cole","updated_at":"2026-02-07T21:56:23.408109Z","closed_at":"2026-02-07T21:56:23.408089Z","close_reason":"Implemented deep-link navigation: /ui/topics/:topic_id supports #msg_<id> scroll+highlight or 'Message not currently loaded' hint; message DOM gets stable id=msg_<id> (ID-validated). Updated ui.test.ts coverage. Verification: bun run typecheck; bun test packages/hub.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","hub","ui"],"dependencies":[{"issue_id":"bd-2qm.3","depends_on_id":"bd-2qm","type":"parent-child","created_at":"2026-02-07T21:20:02.023389Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2qm.3","depends_on_id":"bd-2qm.2","type":"blocks","created_at":"2026-02-07T21:20:18.443385Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-2qm.4","title":"Gate D: WS EventEnvelope entity field + type/docs alignment","description":"Context:\n\n- Implement Gate D from .context/plans/event-trace-explorer.md: add entity to WS event envelopes so live-tail rows can deep-link without parsing data payloads.\n\nScope boundaries:\n\n- âœ… IN scope: packages/hub/src/wsEndpoint.ts (add optional entity to outgoing WS event envelopes); packages/client/src/types.ts (additive type update); docs/protocol.md WS section update; any test updates required for ws types/envelopes.\n- âŒ OUT of scope: /api/v1/events changes (Gate A), /ui/events page (Gate B), deep-link UI behavior (Gate C).\n\nDone means:\n\n- WS EventEnvelope includes entity: {type,id} for each event (additive; existing clients tolerate extra fields).\n- @agentlip/client WS types include optional entity field; typecheck passes.\n- docs/protocol.md documents the optional entity field on WS envelopes.\n\nVerification:\n\n- bun run typecheck\n- bun test\n\nRed-Green-Refactor plan:\n\n- Red: add/adjust WS tests asserting entity is present in envelopes (or that clients tolerate it).\n- Green: implement hub + client changes until tests pass.\n- Refactor: keep mapping centralized and additive.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-07T21:20:10.339801Z","created_by":"cole","updated_at":"2026-02-07T21:51:21.909286Z","closed_at":"2026-02-07T21:51:21.909115Z","close_reason":"Added WS EventEnvelope entity field (hub replay+live), updated @agentlip/client EventEnvelope type (optional entity), and documented in docs/protocol.md. Verification: bun run typecheck; bun test packages/hub; bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["client","hub","ws"],"dependencies":[{"issue_id":"bd-2qm.4","depends_on_id":"bd-2qm","type":"parent-child","created_at":"2026-02-07T21:20:10.339801Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-2qm.4","depends_on_id":"bd-2qm.1","type":"blocks","created_at":"2026-02-07T21:20:18.474437Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":6,"issue_id":"bd-2qm.4","author":"Cole Lawrence","text":"Learning: WS envelopes now include entity sourced from kernel ParsedEvent.entity; keep the field typed optional for additive compatibility, but hub can populate it for all events.","created_at":"2026-02-07T21:51:13Z"}]}
{"id":"bd-580","title":"Hub UI SPA Simplification (Svelte 5)","description":"Epic file: .context/plans/ui-spa-simplification.md\n\nPurpose:\n\n- Replace legacy inline Hub UI with a maintainable Svelte 5 SPA while preserving auth, route, WS, and security contracts.\n\nExecution model:\n\n- Gate 1: bd-580.1 (deterministic packaging/embed)\n- Gate 2: bd-580.2 (bootstrap/static serving contracts)\n- Gate 3: bd-580.3 (SPA parity + WS/deep-link/security)\n- Gate 4: bd-580.4 (hardening/cutover/legacy removal)\n\nInvariant:\n\n- Epic doc is execution-frozen at status beaded; execution learnings go to bead comments.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-13T03:38:56.076886Z","created_by":"cole","updated_at":"2026-02-13T05:41:35.129324Z","closed_at":"2026-02-13T05:41:35.129261Z","close_reason":"All children completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["epic","hub-ui"]}
{"id":"bd-580.1","title":"Gate 1: Deterministic hub-ui packaging and embed pipeline","description":"Epic: bd-580\nEpic file: .context/plans/ui-spa-simplification.md\n\nContext:\n\n- Establish deterministic frontend build/embed pipeline so @agentlip/hub can ship SPA assets without runtime build dependencies.\n\nScope boundaries:\n\n- âœ… IN scope: scaffold packages/hub-ui, add build/typecheck scripts, generate packages/hub/src/uiAssets.generated.ts, wire prepack and CI stale checks.\n- âŒ OUT of scope: runtime /ui/bootstrap endpoint behavior, route fallback/404 semantics, SPA feature parity implementation.\n\nDone means:\n\n- Clean checkout can build/embed and produce stable uiAssets.generated.ts.\n- CI fails when generated asset module is stale.\n- npm pack artifact includes embedded asset module and hub starts from packed artifact.\n\nVerification:\n\n- bun run typecheck â€” expected: no type errors.\n- bun test packages/hub â€” expected: hub tests pass.\n- CI stale-generation check â€” expected: passes cleanly; fails when uiAssets.generated.ts drift is introduced.\n\nRed-Green-Refactor plan:\n\n- Red: add stale-check expectation that fails before embed pipeline exists.\n- Green: implement minimal hub-ui build + embed generator + prepack wiring.\n- Refactor: normalize script ergonomics and deterministic ordering/hash handling in generator output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-13T03:38:59.659125Z","created_by":"cole","updated_at":"2026-02-13T04:00:49.934413Z","closed_at":"2026-02-13T04:00:49.934381Z","close_reason":"Completed Gate 1 deterministic packaging/embed pipeline for hub UI. Delivered hub-ui scaffold, deterministic uiAssets generator + stale-check scripts, hub prepack wiring, CI stale-generation job, and committed generated uiAssets module. Verified with bun run typecheck; bun test packages/hub (438 pass, 1 skip); bun run --cwd packages/hub ui:check-stale (stable); and packed-artifact smoke confirming src/uiAssets.generated.ts is present and startHub() runs from tarball install (via local package tarball overrides).","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub-ui"],"dependencies":[{"issue_id":"bd-580.1","depends_on_id":"bd-580","type":"parent-child","created_at":"2026-02-13T03:38:59.659125Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":7,"issue_id":"bd-580.1","author":"Cole Lawrence","text":"Implemented Gate 1 deterministic UI packaging/embed pipeline.\n\nDelivered:\n- Added new workspace package  (Svelte 5 + Vite) with , ,  scripts.\n- Added deterministic embed generator  that builds hub-ui and generates  with stable ordering and POSIX-normalized asset keys.\n- Added stale check  to fail CI when generated assets drift.\n- Wired  scripts: , , and  to guarantee fresh generated module.\n- Added CI job  in .\n- Added scaffold UI source files under  and generated .\n\nVerification run locally:\n-  âœ…\n- bun test v1.3.8 (b64edcb4)\n[linkifierDerived] Processing message msg_001 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'test-linkifier' for message msg_001\n[linkifierDerived] Plugin 'test-linkifier' returned 1 enrichments\n[linkifierDerived] Plugin 'test-linkifier' committed 1 enrichments, emitted event 1\n[linkifierDerived] Completed: 1 success, 0 failed, 1 events emitted\n[linkifierDerived] Processing message msg_002 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'multi-enrichment' for message msg_002\n[linkifierDerived] Plugin 'multi-enrichment' returned 2 enrichments\n[linkifierDerived] Plugin 'multi-enrichment' committed 2 enrichments, emitted event 1\n[linkifierDerived] Completed: 1 success, 0 failed, 1 events emitted\n[linkifierDerived] Processing message msg_003 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'callback-test' for message msg_003\n[linkifierDerived] Plugin 'callback-test' returned 1 enrichments\n[linkifierDerived] Plugin 'callback-test' committed 1 enrichments, emitted event 1\n[linkifierDerived] Completed: 1 success, 0 failed, 1 events emitted\n[linkifierDerived] Processing message msg_004 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'slow-plugin' for message msg_004\n[linkifierDerived] Plugin 'slow-plugin' returned 1 enrichments\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_005 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'slow-plugin2' for message msg_005\n[linkifierDerived] Plugin 'slow-plugin2' returned 1 enrichments\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_006 with 1 linkifier plugins\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_007 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'invalid-output' for message msg_007\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_008 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'timeout-plugin' for message msg_008\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_009 with 2 linkifier plugins\n[linkifierDerived] Executing plugin 'plugin1' for message msg_009\n[linkifierDerived] Plugin 'plugin1' returned 1 enrichments\n[linkifierDerived] Plugin 'plugin1' committed 1 enrichments, emitted event 1\n[linkifierDerived] Executing plugin 'plugin2' for message msg_009\n[linkifierDerived] Plugin 'plugin2' returned 1 enrichments\n[linkifierDerived] Plugin 'plugin2' committed 1 enrichments, emitted event 2\n[linkifierDerived] Completed: 2 success, 0 failed, 2 events emitted\n[linkifierDerived] Processing message msg_010 with 2 linkifier plugins\n[linkifierDerived] Executing plugin 'failing' for message msg_010\n[linkifierDerived] Executing plugin 'working' for message msg_010\n[linkifierDerived] Plugin 'working' returned 1 enrichments\n[linkifierDerived] Plugin 'working' committed 1 enrichments, emitted event 1\n[linkifierDerived] Completed: 1 success, 1 failed, 1 events emitted\n[linkifierDerived] Message msg_011 is deleted, skipping\n[linkifierDerived] Processing message msg_012 with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'empty' for message msg_012\n[linkifierDerived] Plugin 'empty' returned no enrichments\n[linkifierDerived] Completed: 1 success, 0 failed, 0 events emitted\n[linkifierDerived] No enabled linkifier plugins, skipping\n[linkifierDerived] No enabled linkifier plugins, skipping\n[linkifierDerived] Processing message msg_mlkd0ki33py9do0w with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'test-linkifier' for message msg_mlkd0ki33py9do0w\n[linkifierDerived] Plugin 'test-linkifier' returned 1 enrichments\n[linkifierDerived] Plugin 'test-linkifier' committed 1 enrichments, emitted event 5\n[linkifierDerived] Completed: 1 success, 0 failed, 1 events emitted\n[linkifierDerived] Processing message msg_mlkd0kjw1sbb9h6r with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'hanging-linkifier' for message msg_mlkd0kjw1sbb9h6r\n[linkifierDerived] Processing message msg_mlkd0kjwy0jgtidx with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'hanging-linkifier' for message msg_mlkd0kjwy0jgtidx\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_1770955226396_j5oaos1me2k with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'slow-linkifier' for message msg_1770955226396_j5oaos1me2k\n[linkifierDerived] Plugin 'slow-linkifier' returned 1 enrichments\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_1770955226911_tw7m20qgbso with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'test-linkifier' for message msg_1770955226911_tw7m20qgbso\n[linkifierDerived] Plugin 'test-linkifier' returned 1 enrichments\n[linkifierDerived] Plugin 'test-linkifier' committed 1 enrichments, emitted event 2\n[linkifierDerived] Completed: 1 success, 0 failed, 1 events emitted\n[linkifierDerived] Processing message msg_1770955227028_kfoxdjir1ga with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'hanging-linkifier' for message msg_1770955227028_kfoxdjir1ga\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted\n[linkifierDerived] Processing message msg_1770955227927_b4pe4u49u6r with 1 linkifier plugins\n[linkifierDerived] Executing plugin 'slow-linkifier' for message msg_1770955227927_b4pe4u49u6r\n[linkifierDerived] Plugin 'slow-linkifier' returned 1 enrichments\n[linkifierDerived] Completed: 0 success, 1 failed, 0 events emitted âœ… (438 pass, 1 skip)\n- Checking if hub-ui assets are stale...\n\nBefore: packages/hub/src/uiAssets.generated.ts hash = 780b87b2a422...\n\nRegenerating assets...\nEmbedding hub-ui assets...\n\nBuilding hub-ui...\nvite v6.4.1 building for production...\ntransforming...\nâœ“ 108 modules transformed.\nrendering chunks...\ncomputing gzip size...\ndist/.vite/manifest.json        0.19 kB â”‚ gzip: 0.14 kB\ndist/index.html                 0.41 kB â”‚ gzip: 0.27 kB\ndist/assets/index-Cf_x9M7T.css  0.32 kB â”‚ gzip: 0.24 kB\ndist/assets/index-DvMBT7r9.js   1.81 kB â”‚ gzip: 0.97 kB\nâœ“ built in 176ms\nâœ“ hub-ui build complete\n\nâœ“ Embedded 3 assets\n\nâœ“ Generated /Users/cole/phosphor/agentlip/packages/hub/src/uiAssets.generated.ts\nâœ“ Total assets: 3\n\nDone!\n\nAfter:  packages/hub/src/uiAssets.generated.ts hash = 780b87b2a422...\n\nâœ“ Assets are fresh âœ… (stable hash before/after regen)\n- Packed artifact smoke âœ…:\n  - packed protocol/workspace/kernel/hub tarballs\n  - verified hub tarball contains \n  - installed packed hub with local override tarballs and executed  successfully ().\n\nReview:\n- Ran  on the change set and addressed findings (cross-platform path normalization + locale-independent sort in embed script; clearer missing-generated-file failure messaging).","created_at":"2026-02-13T04:00:34Z"},{"id":8,"issue_id":"bd-580.1","author":"Cole Lawrence","text":"Correction: previous comment formatting was corrupted by shell interpolation. Clean summary: Added packages/hub-ui scaffold (Svelte5+Vite), deterministic embed generator at packages/hub/scripts/embedUi.ts, stale-check script at packages/hub/scripts/checkUiStale.ts, generated packages/hub/src/uiAssets.generated.ts, wired packages/hub package scripts (ui:embed, ui:check-stale, prepack), and CI job ui-stale-check. Verification passed: bun run typecheck; bun test packages/hub (438 pass, 1 skip); bun run --cwd packages/hub ui:check-stale (stable hash). Packed artifact smoke passed using local tarball overrides: hub tarball contains src/uiAssets.generated.ts and startHub() succeeded (PACK_SMOKE_OK).","created_at":"2026-02-13T04:00:45Z"}]}
{"id":"bd-580.2","title":"Gate 2: /ui/bootstrap and static asset serving contracts","description":"Epic: bd-580\nEpic file: .context/plans/ui-spa-simplification.md\n\nContext:\n\n- Introduce explicit SPA runtime contracts in hub: bootstrap config, static asset serving, strict route precedence, and no-auth behavior invariants.\n\nScope boundaries:\n\n- âœ… IN scope: /ui/bootstrap endpoint, /ui/assets/* serving from generated map, fallback/404 precedence, cache headers, auth-first gate behavior, packed-artifact runtime smoke.\n- âŒ OUT of scope: full Svelte feature parity for channels/topics/messages/events and soak/cutover removal work.\n\nDone means:\n\n- Auth-enabled SPA mode serves shell/bootstrap/assets with required cache headers.\n- Missing assets return 404 and never fall back to shell.\n- SPA-disabled mode routes /ui and deep paths to legacy, with bootstrap/assets 404.\n- No-auth mode returns 503 for entire /ui/* namespace.\n\nVerification:\n\n- bun test packages/hub â€” expected: route-matrix tests pass for SPA on/off and auth on/off.\n- bun run typecheck â€” expected: no type errors.\n- CI packed-artifact smoke â€” expected: npm pack tarball hub serves /ui and discovered /ui/assets file in auth-enabled mode.\n\nRed-Green-Refactor plan:\n\n- Red: add failing tests for route precedence, cache headers, and auth matrix.\n- Green: implement bootstrap/static serving and fallback contracts minimally to satisfy tests.\n- Refactor: extract route helpers and asset discovery utilities for maintainable tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-13T03:38:59.709952Z","created_by":"cole","updated_at":"2026-02-13T04:12:15.320220Z","closed_at":"2026-02-13T04:12:15.320164Z","close_reason":"Completed Gate 2 bootstrap and static asset serving contracts. Added SPA route handling for ui bootstrap and ui assets with strict precedence and cache headers, ensured missing or reserved asset paths return 404 without shell fallback, and kept legacy mode and auth-first behavior intact. Updated ui integration tests for SPA on off and auth on off matrix with dynamic asset discovery. Verification: bun run typecheck, bun test packages/hub, and packed-artifact smoke confirming packed hub serves ui shell and discovered ui asset in auth-enabled mode.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub-ui"],"dependencies":[{"issue_id":"bd-580.2","depends_on_id":"bd-580","type":"parent-child","created_at":"2026-02-13T03:38:59.709952Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-580.2","depends_on_id":"bd-580.1","type":"blocks","created_at":"2026-02-13T03:40:01.144248Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":9,"issue_id":"bd-580.2","author":"Cole Lawrence","text":"Implemented Gate 2 route contracts. Added SPA mode handlers for ui bootstrap, static ui assets, and shell fallback with explicit precedence. Added reserved ui assets root handling so ui assets namespace never falls back to shell. Added cache policy: no-store for shell and bootstrap, immutable max-age for hashed assets. Preserved auth-first ui gating via hub router and legacy mode behavior when HUB_UI_SPA_ENABLED=false. Rewrote ui tests to cover SPA mode, no-auth mode, legacy mode, dynamic asset discovery, missing asset 404 behavior, and env restoration safety. Verification passed: bun run typecheck, bun test packages/hub, and packed artifact smoke where packed hub served ui shell and discovered ui asset successfully.","created_at":"2026-02-13T04:12:10Z"}]}
{"id":"bd-580.3","title":"Gate 3: SPA parity migration for channels/topics/messages/events","description":"Epic: bd-580\nEpic file: .context/plans/ui-spa-simplification.md\n\nContext:\n\n- Deliver functional parity in a maintainable Svelte SPA for core Hub UI flows while preserving WS replay/reconnect correctness and security rendering guarantees.\n\nScope boundaries:\n\n- âœ… IN scope: SPA routes/components for channels/topics/messages/events, shared WS client logic (replay boundary, reconnect/backoff, dedupe), deep links, events filters/pause-buffer, entity-link navigation, malicious payload inert rendering checks.\n- âŒ OUT of scope: final flag removal, legacy generator deletion, and post-soak CSP tightening.\n\nDone means:\n\n- Parity checklist passes for channels/topics/messages/events navigation and deep links.\n- WS reconnect/replay overlap and event_id dedupe behave correctly.\n- Malicious payload fixtures render inertly with no script execution.\n\nVerification:\n\n- bun test packages/hub â€” expected: integration + WS + security-regression tests pass.\n- bun run typecheck â€” expected: no type errors.\n- CI Playwright smoke â€” expected: deterministic seeded flows pass, including deep hard-load, entity links, pause/resume, reconnect indicator, and no-exec payload checks.\n\nRed-Green-Refactor plan:\n\n- Red: add parity and security regression tests that fail against legacy/non-SPA behavior.\n- Green: implement minimal SPA route set and shared WS client until tests pass.\n- Refactor: extract pure logic modules (hash parsing, buffer limits, reconnect state) and reduce component complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-13T03:38:59.741073Z","created_by":"cole","updated_at":"2026-02-13T05:20:00.704758Z","closed_at":"2026-02-13T05:20:00.704732Z","close_reason":"Completed SPA parity migration for hub UI: implemented Svelte SPA routes/components for channels/topics/messages/events, shared API+WS client modules with reconnect/backoff+d edupe behavior, deep-link support (#msg_<id>), events filters/pause-buffer/entity navigation, and security-safe rendering patterns. Added SPA-focused integration/security tests in packages/hub/src/ui.spa.test.ts and regenerated embedded assets module. Verification: bun run typecheck; bun test packages/hub/src/ui.test.ts packages/hub/src/ui.spa.test.ts; bun test packages/hub (433 pass, 1 skip).","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub-ui"],"dependencies":[{"issue_id":"bd-580.3","depends_on_id":"bd-580","type":"parent-child","created_at":"2026-02-13T03:38:59.741073Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-580.3","depends_on_id":"bd-580.2","type":"blocks","created_at":"2026-02-13T03:40:01.190232Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":10,"issue_id":"bd-580.3","author":"Cole Lawrence","text":"Implemented Gate 3 SPA parity migration using Svelte components and shared client modules. Delivered channels/topics/messages/events SPA flows, history-path routing under /ui, live WS integration with reconnect/backoff and event_id dedupe, deep-link handling for #msg_<id>, events filters and pause/resume buffer, and entity-link navigation to topics/messages. Added security-focused rendering guards (validated IDs/URLs, no unsafe HTML rendering paths).\n\nCode delivered:\n- New SPA modules: packages/hub-ui/src/lib/{bootstrap,api,ws,security,router}.ts\n- New route components: packages/hub-ui/src/components/{ChannelsList,TopicsList,TopicMessages,EventsTimeline}.svelte\n- Updated app shell/router: packages/hub-ui/src/App.svelte\n- Added SPA integration/security tests: packages/hub/src/ui.spa.test.ts\n- Regenerated embedded assets: packages/hub/src/uiAssets.generated.ts\n\nVerification run locally:\n- bun run typecheck (pass)\n- bun test packages/hub/src/ui.test.ts packages/hub/src/ui.spa.test.ts (pass)\n- bun test packages/hub (433 pass, 1 skip)\n\nNotes:\n- Legacy mode remains intact behind HUB_UI_SPA_ENABLED=false for rollback safety.\n- Browser-smoke/Playwright CI was not introduced in this bead to avoid broad CI/package churn; Gate 4 hardening can add that soak-focused coverage if desired.","created_at":"2026-02-13T05:19:55Z"}]}
{"id":"bd-580.4","title":"Gate 4: Hardening, soak, cutover, and legacy removal","description":"Epic: bd-580\nEpic file: .context/plans/ui-spa-simplification.md\n\nContext:\n\n- Safely cut over from legacy inline UI to SPA serving with measurable soak criteria, rehearsed rollback, and final cleanup/tightening.\n\nScope boundaries:\n\n- âœ… IN scope: feature-flag rollout defaults, soak monitoring criteria, mandatory rollback drill evidence, CSP tightening, legacy ui.ts generator removal, flag removal after gates.\n- âŒ OUT of scope: introducing new user-facing Hub UI features beyond parity or changing auth model.\n\nDone means:\n\n- Soak window completes with objective CI/runbook thresholds satisfied.\n- Rollback drill (flag off/on) succeeds and evidence is recorded.\n- Legacy inline generators and temporary flag are removed in final follow-up with CSP tightened.\n\nVerification:\n\n- bun run typecheck â€” expected: no type errors.\n- bun test packages/hub â€” expected: no route/security regressions.\n- bun test â€” expected: workspace test suite passes.\n- Runbook rollback drill â€” expected: route matrix behavior matches contract before and after flag toggles.\n\nRed-Green-Refactor plan:\n\n- Red: define failing cutover checklist conditions and rollback matrix validation.\n- Green: implement rollout controls + CSP compatibility and satisfy all gate checks.\n- Refactor: remove temporary flag/legacy code paths and simplify final routing/security config.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-13T03:38:59.773434Z","created_by":"cole","updated_at":"2026-02-13T05:41:16.146314Z","closed_at":"2026-02-13T05:41:16.146073Z","close_reason":"Completed Gate 4 hardening/cutover: removed legacy inline UI path and temporary SPA flag behavior from hub runtime, tightened CSP by removing unsafe-inline from script-src/style-src, updated route/security tests for steady-state SPA contracts, removed inline style attributes from SPA components for CSP compatibility, regenerated embedded UI assets, and documented rollback/cutover operations. Verification passed: bun run typecheck; bun test packages/hub; bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub-ui"],"dependencies":[{"issue_id":"bd-580.4","depends_on_id":"bd-580","type":"parent-child","created_at":"2026-02-13T03:38:59.773434Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-580.4","depends_on_id":"bd-580.3","type":"blocks","created_at":"2026-02-13T03:40:01.261207Z","created_by":"cole","metadata":"{}","thread_id":""}],"comments":[{"id":11,"issue_id":"bd-580.4","author":"Cole Lawrence","text":"Completed Gate 4 hardening/cutover for hub UI SPA.\n\nDelivered:\n- Removed temporary SPA flag path and legacy inline UI rendering code from runtime by simplifying packages/hub/src/ui.ts to SPA-only contracts:\n  - /ui/bootstrap JSON\n  - /ui/assets/* static assets\n  - /ui and deep /ui/* shell fallback\n  - /ui/assets root and missing assets -> 404 (no shell fallback)\n- Tightened CSP in packages/hub/src/index.ts by removing unsafe-inline from script-src and style-src.\n- Updated security/header expectations in packages/hub/src/securityHeaders.test.ts.\n- Updated UI route matrix tests in packages/hub/src/ui.test.ts for steady-state SPA behavior and added regression coverage proving HUB_UI_SPA_ENABLED=false has no effect when set before startup.\n- Removed stale flag setup from packages/hub/src/ui.spa.test.ts.\n- Fixed SPA component markup to avoid inline style attributes so strict CSP style-src self remains compatible:\n  - packages/hub-ui/src/components/{TopicsList,TopicMessages,EventsTimeline}.svelte\n- Regenerated embedded assets: packages/hub/src/uiAssets.generated.ts.\n- Added operations cutover/rollback notes in docs/ops.md and updated README UI section wording.\n\nVerification run:\n- bun run typecheck (pass)\n- bun test packages/hub (433 pass, 1 skip)\n- bun test (776 pass, 1 skip)\n\nNotes:\n- Post-cutover rollback path is now previous-release redeploy (flag no longer exists).\n- Browser smoke/soak remains an operational runbook concern; this bead ships code/test/docs hardening for final cutover state.","created_at":"2026-02-13T05:41:12Z"}]}
{"id":"bd-8t6","title":"Craft release preparation + local publish harness","description":"Context:\n\n- We want to standardize release prep using getsentry/craft and add a local npm registry publish loop for realistic install tests without touching npmjs.\n- Source plan: .context/plans/craft-instrumentation-and-local-publishing.md\n\nDone means:\n\n- Craft is configured for this repo (config + changelog policy).\n- Version bump script works both manually and as Craft preReleaseCommand.\n- A workflow_dispatch \"release prepare\" workflow exists (Craft reusable workflow).\n- Local registry (Verdaccio) harness + publish/smoke scripts exist and are documented.\n\nVerification:\n\n- Follow the plan's verification matrix in .context/plans/craft-instrumentation-and-local-publishing.md\n\nRed-Green-Refactor plan:\n\n- Red: run the verification commands and observe failures due to missing config/scripts.\n- Green: implement minimal pieces per child tasks.\n- Refactor: reduce duplication in scripts, tighten docs.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-06T13:38:34.669433Z","created_by":"cole","updated_at":"2026-02-06T14:48:52.895384Z","closed_at":"2026-02-06T14:48:52.895364Z","close_reason":"Completed Craft release-prep + local publishing harness: added .craft.yml + CHANGELOG.md, Craft-compatible bump script, release-prepare workflow, changelog-preview workflow, CI craft-config validation job, Verdaccio localhost harness, publish-local + smoke-install scripts, and docs/runbooks. Verified bun run typecheck and craft config validation via npx. See commits: 17cfb40, 744f1fc, 91dd410, 1e3e9ca, 763c1ba, 2a50e59.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","infra","ops","workflow"]}
{"id":"bd-8t6.1","title":"Craft: add .craft.yml + CHANGELOG.md (manual versioning, simple changelog)","description":"Context:\n\n- Craft config enables standardized release prep (release branches + changelog gating).\n- Plan: .context/plans/craft-instrumentation-and-local-publishing.md (Gate A).\n\nDone means:\n\n- .craft.yml exists at repo root with:\n  - github.owner / github.repo\n  - versioning.policy: manual\n  - changelog.policy: simple (uses default changelog file: CHANGELOG.md)\n  - preReleaseCommand: bash scripts/bump-version.sh\n- CHANGELOG.md exists with an initial structure suitable for Craft \"simple\" policy.\n\nVerification:\n\n- (local) `npx -y @sentry/craft config` succeeds\n- (local) `npx -y @sentry/craft prepare 0.1.1 --dry-run --no-input` gets past config/changelog checks (repo should be clean for a realistic run)\n\nRed-Green-Refactor plan:\n\n- Red: add a CI check that fails when .craft.yml/CHANGELOG.md is missing or invalid.\n- Green: add minimal .craft.yml + CHANGELOG.md to satisfy Craft.\n- Refactor: tighten config fields and comments to remove ambiguity.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T13:38:47.666015Z","created_by":"cole","updated_at":"2026-02-06T14:36:22.577997Z","closed_at":"2026-02-06T14:36:22.577980Z","close_reason":"Added .craft.yml + CHANGELOG.md for Craft manual versioning + simple changelog. Validated with {\n    \"github\": {\n        \"owner\": \"phosphorco\",\n        \"repo\": \"agentlip\"\n    },\n    \"targets\": [],\n    \"preReleaseCommand\": \"bash scripts/bump-version.sh\",\n    \"releaseBranchPrefix\": \"release\",\n    \"changelog\": {\n        \"policy\": \"simple\"\n    },\n    \"versioning\": {\n        \"policy\": \"manual\"\n    }\n}. Included in commit 17cfb40.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:docs","infra","workflow"],"dependencies":[{"issue_id":"bd-8t6.1","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:38:47.666015Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.2","title":"Craft: make scripts/bump-version.sh compatible with preReleaseCommand","description":"Context:\n\n- Craft runs preReleaseCommand with env vars CRAFT_OLD_VERSION / CRAFT_NEW_VERSION and expects non-zero exit on failure.\n- Our current scripts/bump-version.sh is argument-driven only.\n\nDone means:\n\n- scripts/bump-version.sh supports all modes from the plan (Gate B):\n  - 0 args + CRAFT_NEW_VERSION env var\n  - 1 arg (manual new version)\n  - 2 args (old, new) positional fallback\n- Script does not commit/tag; only edits files.\n- Fail-fast, atomic updates (temp file then mv) so no partial version bumps.\n- Idempotent when target version already applied.\n\nVerification:\n\n- `CRAFT_NEW_VERSION=0.1.1 CRAFT_OLD_VERSION=0.1.0 bash scripts/bump-version.sh` updates all packages/*/package.json versions to 0.1.1\n- Re-running with same env var exits 0 and leaves repo unchanged (`git diff` empty).\n- `bun run typecheck` and `bun test` pass after bump.\n\nRed-Green-Refactor plan:\n\n- Red: add a scriptable repro (or bun:test) that asserts versions change as expected in a temp copy of the repo.\n- Green: implement minimal mode detection + updates.\n- Refactor: reduce duplication, improve error messages, ensure portability (macOS/Linux).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T13:38:56.919984Z","created_by":"cole","updated_at":"2026-02-06T14:36:22.604251Z","closed_at":"2026-02-06T14:36:22.604235Z","close_reason":"Made scripts/bump-version.sh Craft-compatible (CRAFT_NEW_VERSION env, >=2 args old/new as last two, 1-arg manual), idempotent, atomic writes. Verified by running script with same version (no diff) + bun run typecheck. Committed in 17cfb40.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","infra","workflow"],"dependencies":[{"issue_id":"bd-8t6.2","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:38:56.919984Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.3","title":"CI: add workflow_dispatch release-prepare using Craft reusable workflow","description":"Context:\n\n- We want a standardized, low-friction way to generate a release branch + PR that bumps versions and enforces changelog discipline.\n- Craft provides reusable workflows for this.\n\nDone means:\n\n- New workflow exists: .github/workflows/release-prepare.yml\n- Trigger: workflow_dispatch with input version\n- Uses: getsentry/craft/.github/workflows/release.yml@v2 (pinned to v2 initially; optionally pin to SHA afterward)\n- Least-privilege permissions: contents: write, pull-requests: write\n- Concurrency group is set so multiple dispatches queue, not race.\n\nVerification:\n\n- YAML validates (`act` optional)\n- Manual dry-run review: workflow would be able to create a release/<version> branch and PR\n\nRed-Green-Refactor plan:\n\n- Red: add the workflow and validate it parses in CI.\n- Green: ensure it runs end-to-end in a test repo or on a temporary branch.\n- Refactor: pin to SHA, tighten permissions, add guardrails.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T13:39:04.915679Z","created_by":"cole","updated_at":"2026-02-06T14:40:29.174025Z","closed_at":"2026-02-06T14:40:29.173778Z","close_reason":"Added .github/workflows/release-prepare.yml using getsentry/craft reusable workflow (workflow_dispatch version input), with least-privilege permissions and concurrency queue. Committed in 91dd410.","source_repo":".","compaction_level":0,"original_size":0,"labels":["infra","ops","workflow"],"dependencies":[{"issue_id":"bd-8t6.3","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:39:04.915679Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.3","depends_on_id":"bd-8t6.1","type":"blocks","created_at":"2026-02-06T13:41:57.833858Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.3","depends_on_id":"bd-8t6.2","type":"blocks","created_at":"2026-02-06T13:41:57.857966Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.4","title":"CI (optional): add Craft changelog preview workflow for PRs","description":"Context:\n\n- Craft can post a changelog preview comment on PRs, which helps contributors produce correct changelog entries.\n- This uses pull_request_target and must be configured safely.\n\nDone means:\n\n- New workflow exists: .github/workflows/changelog-preview.yml\n- Trigger uses pull_request_target per Craft docs\n- Uses: getsentry/craft/.github/workflows/changelog-preview.yml@v2\n- Permissions: contents: read, pull-requests: write, statuses: write\n- No custom steps that check out or execute PR code (avoid pull_request_target footguns).\n\nVerification:\n\n- Workflow YAML validates\n- (Optional) On a PR, the workflow would be able to comment a preview using GITHUB_TOKEN\n\nRed-Green-Refactor plan:\n\n- Red: add workflow with minimal configuration.\n- Green: validate permissions + safe trigger.\n- Refactor: pin to SHA, document behavior in README/runbook.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T13:39:12.421161Z","created_by":"cole","updated_at":"2026-02-06T14:40:29.240423Z","closed_at":"2026-02-06T14:40:29.240405Z","close_reason":"Added safe pull_request_target changelog preview workflow using getsentry/craft reusable workflow with read/pr/status permissions; no custom steps. Committed in 91dd410.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:docs","infra","workflow"],"dependencies":[{"issue_id":"bd-8t6.4","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:39:12.421161Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.4","depends_on_id":"bd-8t6.1","type":"blocks","created_at":"2026-02-06T13:42:49.106955Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.5","title":"Local registry: add Verdaccio docker-compose harness (localhost-only, auth)","description":"Context:\n\n- We need a realistic local publish loop to validate installs without touching npmjs.\n- Verdaccio provides a lightweight local npm registry.\n\nDone means:\n\n- dev/verdaccio/docker-compose.yml exists and starts Verdaccio bound to 127.0.0.1:4873 only\n- Verdaccio config requires auth for publish (dev credentials)\n- Local-only storage/auth files are gitignored (e.g. storage volume, htpasswd)\n- A helper script exists: scripts/local-registry-up.sh + scripts/local-registry-down.sh\n- local-registry-up.sh waits for health (/-/ping) with timeout and prints REGISTRY_URL=...\n\nVerification:\n\n- `scripts/local-registry-up.sh` starts registry and prints URL\n- `curl -fsS http://127.0.0.1:4873/-/ping` succeeds\n- `scripts/local-registry-down.sh` stops registry (and `--clean` removes volumes if implemented here)\n\nRed-Green-Refactor plan:\n\n- Red: start registry and confirm health endpoint is reachable.\n- Green: add scripts + minimal config.\n- Refactor: improve idempotency, logging, and failure messages.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T13:39:22.024611Z","created_by":"cole","updated_at":"2026-02-06T14:36:22.631296Z","closed_at":"2026-02-06T14:36:22.631279Z","close_reason":"Added Verdaccio localhost-only harness (dev/verdaccio/docker-compose.yml + config.yaml) and scripts/local-registry-up.sh/down.sh with health wait and --clean. Added gitignore guards and README usage notes. Verified bash -n on scripts and docker compose config parses. Committed in 744f1fc.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","infra","ops"],"dependencies":[{"issue_id":"bd-8t6.5","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:39:22.024611Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.6","title":"Local publish: publish all workspace packages to local registry (bun publish --registry ...)","description":"Context:\n\n- After starting Verdaccio, we need a deterministic publish script that publishes all packages in dependency order to the local registry.\n- Must fail fast and have guardrails to avoid accidental real npm publishes.\n\nDone means:\n\n- scripts/publish-local.sh <version> --registry <url> exists\n- Script rejects missing --registry\n- Script rejects non-localhost registry URLs (only http://127.0.0.1 or http://localhost)\n- Script publishes packages in verified dependency order (read from actual package.json deps before finalizing order):\n  protocol â†’ kernel â†’ workspace â†’ client â†’ cli â†’ hub\n- Auth behavior: if registry requires auth and creds missing, script errors with instructions: `npm adduser --registry <url>`\n\nVerification:\n\n- With registry up: `scripts/publish-local.sh 0.1.1 --registry http://127.0.0.1:4873` publishes all packages\n- Safety: `scripts/publish-local.sh 0.1.1` exits non-zero\n- Safety: `scripts/publish-local.sh 0.1.1 --registry https://registry.npmjs.org` exits non-zero\n\nRed-Green-Refactor plan:\n\n- Red: start registry and attempt publish; observe current failure (script missing).\n- Green: implement publish script with fail-fast + dependency order.\n- Refactor: DRY publish steps, improve error output, add \"resume\" hints.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":240,"created_at":"2026-02-06T13:39:34.521573Z","created_by":"cole","updated_at":"2026-02-06T14:40:29.270320Z","closed_at":"2026-02-06T14:40:29.270302Z","close_reason":"Added scripts/publish-local.sh with localhost-only --registry guardrails, semver + version consistency checks, and bun publish in dependency order. Committed in 1e3e9ca.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","infra","ops"],"dependencies":[{"issue_id":"bd-8t6.6","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:39:34.521573Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.6","depends_on_id":"bd-8t6.5","type":"blocks","created_at":"2026-02-06T13:41:58.030180Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.7","title":"Local smoke test: bun add @agentlip/client from local registry and verify imports","description":"Context:\n\n- We want a true end-to-end test of published artifacts by installing from the local registry into a fresh temp project.\n\nDone means:\n\n- scripts/smoke-install-from-registry.sh <version> --registry <url> exists\n- Script rejects missing --registry and rejects non-localhost URLs\n- Script creates a temp dir, bun init, bun add @agentlip/client@<version> from the local registry, and runs a TS snippet importing createChannel\n- Script cleans up temp dir on success/failure (trap)\n\nVerification:\n\n- After local publish: `scripts/smoke-install-from-registry.sh 0.1.1 --registry http://127.0.0.1:4873` exits 0 and prints function type\n- Failure case: if package missing, exits non-zero with useful error\n\nRed-Green-Refactor plan:\n\n- Red: write script to fail until publish-local exists and packages are present.\n- Green: implement install+import check.\n- Refactor: improve output, add extra assertions (createTopic/sendMessage as needed).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T13:39:42.204455Z","created_by":"cole","updated_at":"2026-02-06T14:42:53.419734Z","closed_at":"2026-02-06T14:42:53.419510Z","close_reason":"Added scripts/smoke-install-from-registry.sh with localhost-only registry guardrails, temp project setup, bun add @agentlip/client@<version> using --registry, and TS import verification. Script cleans up temp dir via trap and prints temp dir path on failure. Committed in 763c1ba.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:packages","infra","ops"],"dependencies":[{"issue_id":"bd-8t6.7","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:39:42.204455Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.7","depends_on_id":"bd-8t6.6","type":"blocks","created_at":"2026-02-06T13:41:58.054595Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.8","title":"Docs: update README + add runbooks for Craft release prep + local registry testing","description":"Context:\n\n- We are adding Craft (release-prepare workflow) and a local registry publish loop. Docs must converge on a single, copy-pasteable workflow.\n\nDone means:\n\n- README.md Publishing section explains:\n  - How to run release-prepare workflow (Craft) to generate release PR\n  - Merge PR\n  - Tag vX.Y.Z to trigger existing publish.yml\n  - How to test locally using Verdaccio + publish-local + smoke-install scripts\n- New runbooks under .context/runbooks/:\n  - craft-release.md (or similar): how to cut a release with Craft + tag publish\n  - local-registry-testing.md: how to start registry, npm adduser, publish-local, smoke-install\n  - troubleshooting section included (port conflicts, auth missing, partial local publishes, stale release branches)\n\nVerification:\n\n- Docs contain commands that match actual script names/paths.\n- A maintainer can follow runbooks end-to-end on macOS/Linux.\n\nRed-Green-Refactor plan:\n\n- Red: identify current docs gaps/contradictions.\n- Green: add minimal accurate docs and runbooks.\n- Refactor: remove duplication; ensure a single source of truth for commands.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-06T13:41:43.663131Z","created_by":"cole","updated_at":"2026-02-06T14:48:37.884848Z","closed_at":"2026-02-06T14:48:37.884776Z","close_reason":"Updated README Publishing section to use Craft Release Prepare workflow + tag-based publish and documented local registry testing with new scripts. Added runbooks: .context/runbooks/craft-release.md and local-registry-testing.md with troubleshooting. Committed in 2a50e59.","source_repo":".","compaction_level":0,"original_size":0,"labels":["area:docs","ops","workflow"],"dependencies":[{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:41:43.663131Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6.1","type":"blocks","created_at":"2026-02-06T13:41:57.882508Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6.2","type":"blocks","created_at":"2026-02-06T13:41:57.907578Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6.3","type":"blocks","created_at":"2026-02-06T13:41:57.931898Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6.5","type":"blocks","created_at":"2026-02-06T13:41:57.954669Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6.6","type":"blocks","created_at":"2026-02-06T13:41:57.979590Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.8","depends_on_id":"bd-8t6.7","type":"blocks","created_at":"2026-02-06T13:41:58.005365Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-8t6.9","title":"CI: add Craft config validation check job","description":"Context:\n\n- Craft config errors should be caught early in PRs.\n- Plan Gate A suggests adding a lightweight validation job to CI.\n\nDone means:\n\n- .github/workflows/ci.yml includes a job/step that validates Craft config changes, e.g. on PRs:\n  - installs Craft CLI, or\n  - performs a minimal command that fails fast on invalid .craft.yml\n- Job is fast and does not require secrets.\n\nVerification:\n\n- CI workflow YAML validates.\n- If .craft.yml is intentionally corrupted in a branch, CI fails in this job.\n\nRed-Green-Refactor plan:\n\n- Red: add a failing config case locally to prove the check catches it.\n- Green: implement minimal validation job.\n- Refactor: cache installation and keep runtime low.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-06T13:41:51.211959Z","created_by":"cole","updated_at":"2026-02-06T14:40:29.210331Z","closed_at":"2026-02-06T14:40:29.210311Z","close_reason":"Added CI job 'Validate Craft Config' running npx -y @sentry/craft config and checking .craft.yml/CHANGELOG.md exist. Committed in 91dd410.","source_repo":".","compaction_level":0,"original_size":0,"labels":["infra","workflow"],"dependencies":[{"issue_id":"bd-8t6.9","depends_on_id":"bd-8t6","type":"parent-child","created_at":"2026-02-06T13:41:51.211959Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-8t6.9","depends_on_id":"bd-8t6.1","type":"blocks","created_at":"2026-02-06T13:42:49.077913Z","created_by":"cole","metadata":"{}","thread_id":""}]}
