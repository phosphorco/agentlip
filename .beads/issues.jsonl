{"id":"bd-16d","title":"AgentChat Local Hub v1","description":"Tracking epic for implementing AGENTLIP_PLAN.md (AgentChat Local Hub v1, v0.2).","status":"open","priority":0,"issue_type":"epic","created_at":"2026-02-05T01:01:41.195075Z","created_by":"cole","updated_at":"2026-02-05T01:01:41.195075Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-16d.1","title":"Phase 0: Skeleton","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: workspace discovery+init; schema apply (core + optional FTS); hub /health + lock + server.json.\nExit: Gate A passes; agentchatd status works.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-05T01:01:48.850918Z","created_by":"cole","updated_at":"2026-02-05T13:12:59.088497Z","closed_at":"2026-02-05T13:12:59.088479Z","close_reason":"Phase 0 exit criteria met: workspace discovery/init + kernel schema/migrations (incl optional FTS) + PRAGMA helpers + hub /health + localhost bind validation + writer.lock/server.json/token infra + agentchatd status + Gate A tests/verification. Verified via bun test, bun verify-kernel.ts, bun packages/hub/verify-health.ts, and bun packages/hub/verify-status.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase0"],"dependencies":[{"issue_id":"bd-16d.1","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:01:48.850918Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.1","title":"Workspace discovery + init (.zulip/db.sqlite3)","description":"Plan ref: AGENTLIP_PLAN.md Â§4.1.\\n\\nImplement upward discovery from cwd to workspace root containing .zulip/db.sqlite3; enforce traversal boundary; init workspace state if missing.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.778498Z","created_by":"cole","updated_at":"2026-02-05T13:01:51.100424Z","closed_at":"2026-02-05T13:01:51.100198Z","close_reason":"Implemented @agentchat/workspace discovery + init: upward search for .zulip/db.sqlite3 with home + filesystem boundary stop; init creates .zulip/ (0700) + db.sqlite3 (0600). Added bun unit tests + verify script. Verified via `bun test` and `bun run typecheck`.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase0","workspace"],"dependencies":[{"issue_id":"bd-16d.1.1","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.778498Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.10","title":"Hub: localhost-only bind validation (reject 0.0.0.0 by default)","description":"Plan ref: Gate J; Â§4.2 startup sequence step 7.\\n\\nBind to 127.0.0.1 / ::1 only; reject 0.0.0.0 unless explicitly unsafe.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.963513Z","created_by":"cole","updated_at":"2026-02-05T12:46:23.177190Z","closed_at":"2026-02-05T12:46:23.177171Z","close_reason":"Implemented assertLocalhostBind() helper that validates bind host is localhost-only (127.0.0.1, ::1, localhost). Rejects 0.0.0.0 and other network addresses by default unless allowUnsafeNetwork flag is explicitly set. Integrated into startHub() function. Verified with automated test suite (verify-health.ts) - all bind validation tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0","security"],"dependencies":[{"issue_id":"bd-16d.1.10","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.963513Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.11","title":"CLI: agentchatd status (server.json -> /health validation)","description":"Plan ref: Â§4.2 (agentchatd status).\\n\\nImplement status command reading server.json, calling /health, validating db_id, and printing status.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.980682Z","created_by":"cole","updated_at":"2026-02-05T13:12:19.212092Z","closed_at":"2026-02-05T13:12:19.212072Z","close_reason":"Implemented agentchatd status CLI (packages/hub/src/agentchatd.ts): reads .zulip/server.json, calls GET /health with timeout, validates hub db_id vs on-disk meta.db_id, and outputs human or JSON without leaking auth_token. Includes verify-status.ts harness. Verified via bun packages/hub/verify-status.ts, bun packages/hub/verify-health.ts, bun test, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase0"],"dependencies":[{"issue_id":"bd-16d.1.11","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.980682Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.11","depends_on_id":"bd-16d.1.7","type":"blocks","created_at":"2026-02-05T01:04:27.070538Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.11","depends_on_id":"bd-16d.1.9","type":"blocks","created_at":"2026-02-05T01:04:27.090647Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.12","title":"Gate A: DB + schema correctness","description":"Plan ref: Â§0.7 Gate A.\n\nCriteria:\n- schema initializes cleanly in empty workspace\n- optional FTS schema applies if supported; failure is non-fatal and detectable","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.997443Z","created_by":"cole","updated_at":"2026-02-05T13:12:42.375390Z","closed_at":"2026-02-05T13:12:42.375370Z","close_reason":"Gate A satisfied: schema initializes cleanly in empty workspace; optional FTS migration applies when supported or fails non-fatally while remaining detectable via runMigrations({enableFts:true}) result. Verified via bun test (kernel schema.test.ts) + bun verify-kernel.ts and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateA","phase0","tests"],"dependencies":[{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.997443Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1.2","type":"blocks","created_at":"2026-02-05T01:04:27.016064Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1.3","type":"blocks","created_at":"2026-02-05T01:04:27.033803Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.1.5","type":"blocks","created_at":"2026-02-05T01:04:27.051589Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.1.12","depends_on_id":"bd-16d.6.1","type":"blocks","created_at":"2026-02-05T01:08:19.005397Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.2","title":"Kernel/SQLite: schema_v1.sql + meta init","description":"Plan ref: Part X / Kernel / SQLite.\\n\\nDeliver schema_v1.sql that initializes core tables + meta keys (db_id, schema_version, created_at).","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.802892Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.866969Z","closed_at":"2026-02-05T13:00:46.996120Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.2","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.802892Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.3","title":"Kernel/SQLite: optional schema_v1_fts.sql (graceful fallback)","description":"Plan ref: Part X / Kernel / SQLite; Gate A.\\n\\nProvide optional FTS schema applied opportunistically; failures are non-fatal but detectable.","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:04:26.823962Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.867710Z","closed_at":"2026-02-05T13:00:46.999714Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["fts","kernel","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.3","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.823962Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.4","title":"Kernel/SQLite: migration scaffolding (meta.schema_version)","description":"Plan ref: Part X / Kernel / SQLite; Â§3.6 + Â§4.2 startup sequence.\\n\\nAdd forward-only migration runner using meta.schema_version + backup-before-apply.","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:04:26.844242Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.868021Z","closed_at":"2026-02-05T13:00:47.000413Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","migrations","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.4","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.844242Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.5","title":"Kernel/SQLite: DB open helper sets PRAGMAs (WAL, foreign_keys, busy_timeout)","description":"Plan ref: Â§3.4 WAL and small transactions; Â§4.2 startup sequence.\\n\\nEnsure DB connections set journal_mode=WAL, foreign_keys=ON, busy_timeout=5000, synchronous=NORMAL.","notes":"Correction: the close reason accidentally captured command-substitution output of verify-kernel during shell invocation. After fixing verify-kernel.ts to ignore backup -wal files, `bun verify-kernel.ts` is stable and passes (13/13). `bun run typecheck` also passes.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.865360Z","created_by":"cole","updated_at":"2026-02-05T13:02:05.868424Z","closed_at":"2026-02-05T13:00:47.001142Z","close_reason":"Implemented schema v1 migrations + optional FTS migration; added @agentchat/kernel openDb() PRAGMA helper (WAL/foreign_keys/busy_timeout/synchronous + query_only) and forward-only runMigrations() tracked by meta.schema_version with backup-before-apply + graceful FTS fallback. Verified via ðŸ” Verifying @agentchat/kernel implementation\n\n============================================================\nâœ… Open database with required PRAGMAs\nâœ… Apply schema_v1 migration\nâœ… Meta table initialized with required keys\nâœ… Core tables created (channels, topics, messages, events, attachments, enrichments)\nâœ… Required indexes created\nâœ… Trigger prevents hard delete on messages\nâœ… Trigger prevents update/delete on events\nâœ… FTS migration applies when enabled\nâœ… isFtsAvailable correctly detects FTS\nâœ… Readonly mode prevents writes\nâœ… Re-running migrations is idempotent\nâŒ backupBeforeMigration creates timestamped backup\n   Error: file is not a database\nâœ… Foreign key constraints enforced\n\n============================================================\n\nðŸ“Š Test Results: 12 passed, 1 failed\n\nâŒ Verification FAILED and .","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","phase0","sqlite"],"dependencies":[{"issue_id":"bd-16d.1.5","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.865360Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.6","title":"Hub: writer lock acquisition + stale lock handling","description":"Plan ref: Â§4.2 startup sequence step 4.\\n\\nAcquire .zulip/locks/writer.lock; if lock exists validate via /health using server.json; remove stale locks safely.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.884720Z","created_by":"cole","updated_at":"2026-02-05T13:01:57.194640Z","closed_at":"2026-02-05T13:01:57.194618Z","close_reason":"Implemented hub infra modules: generateAuthToken() (>=256-bit), constantTimeEqual(); atomic .zulip/server.json write (temp+rename, chmod 0600 + verify) + read/remove helpers; writer.lock acquisition with staleness detection via injected /health check using server.json. Verified via bun packages/hub/test-infra.ts, bun packages/hub/verify-health.ts, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","phase0"],"dependencies":[{"issue_id":"bd-16d.1.6","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.884720Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.7","title":"Hub: GET /health endpoint","description":"Plan ref: Â§4.2.\\n\\nImplement unauthenticated /health returning instance_id, db_id, schema_version, protocol_version, pid, uptime_seconds.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.904704Z","created_by":"cole","updated_at":"2026-02-05T12:46:23.142856Z","closed_at":"2026-02-05T12:46:23.142659Z","close_reason":"Implemented GET /health endpoint in packages/hub/src/index.ts returning HealthResponse with status, instance_id, db_id, schema_version, protocol_version, pid, uptime_seconds. Endpoint is unauthenticated and always returns 200 when hub is responsive. Verified with automated test suite (verify-health.ts) - all 21 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0"],"dependencies":[{"issue_id":"bd-16d.1.7","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.904704Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.8","title":"Hub: auth token generation (>=128-bit crypto random)","description":"Plan ref: Gate J; Â§4.2 startup sequence step 6.\\n\\nGenerate/load auth token with >=128 bits entropy; never log token; store only in server.json.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.925770Z","created_by":"cole","updated_at":"2026-02-05T13:01:57.195550Z","closed_at":"2026-02-05T13:01:57.195539Z","close_reason":"Implemented hub infra modules: generateAuthToken() (>=256-bit), constantTimeEqual(); atomic .zulip/server.json write (temp+rename, chmod 0600 + verify) + read/remove helpers; writer.lock acquisition with staleness detection via injected /health check using server.json. Verified via bun packages/hub/test-infra.ts, bun packages/hub/verify-health.ts, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0","security"],"dependencies":[{"issue_id":"bd-16d.1.8","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.925770Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.1.9","title":"Hub: write server.json (chmod 0600; never log token)","description":"Plan ref: Gate J; Â§4.2 startup sequence step 8.\\n\\nWrite server.json atomically; verify mode 0600; include port, pid, instance_id; redact token from logs/errors.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T01:04:26.945680Z","created_by":"cole","updated_at":"2026-02-05T13:01:57.196207Z","closed_at":"2026-02-05T13:01:57.196196Z","close_reason":"Implemented hub infra modules: generateAuthToken() (>=256-bit), constantTimeEqual(); atomic .zulip/server.json write (temp+rename, chmod 0600 + verify) + read/remove helpers; writer.lock acquisition with staleness detection via injected /health check using server.json. Verified via bun packages/hub/test-infra.ts, bun packages/hub/verify-health.ts, and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase0","security"],"dependencies":[{"issue_id":"bd-16d.1.9","depends_on_id":"bd-16d.1","type":"parent-child","created_at":"2026-02-05T01:04:26.945680Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2","title":"Phase 1: Core messaging + mutability","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: channel/topic CRUD; send/edit/delete; events + WS replay/stream; CLI list/tail/page/listen.\nExit: Gates B,C,G,H pass; CLI JSONL listen works with reconnect.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-05T01:02:47.221335Z","created_by":"cole","updated_at":"2026-02-05T16:46:42.172346Z","closed_at":"2026-02-05T16:46:42.172123Z","close_reason":"Phase 1 exit criteria met: core channel/topic/message CRUD + events are implemented; HTTP v1 + WS (hello/replay boundary/live/backpressure) working; CLI read-only queries + WS listen (JSONL + reconnect) + HTTP mutation commands delivered; graceful shutdown + structured logs in hub. Gates B/C/G/H all green via new failure-injection + WS delivery + concurrency/tombstone suites. Gate J security baseline remains tracked separately (plugin isolation pending).","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase1"],"dependencies":[{"issue_id":"bd-16d.2","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:47.221335Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2","depends_on_id":"bd-16d.1","type":"blocks","created_at":"2026-02-05T01:03:05.148013Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.1","title":"ADR-0003: Replay boundary codified in docs + tests","description":"Plan ref: Part X / ADRs; Â§0.6 decision 4; Gate C.\\n\\nDefine replay boundary semantics (replay_until handshake) in docs and assert with integration tests.","status":"closed","priority":1,"issue_type":"docs","created_at":"2026-02-05T01:05:54.854335Z","created_by":"cole","updated_at":"2026-02-05T14:07:08.256766Z","closed_at":"2026-02-05T14:07:08.256746Z","close_reason":"Wrote ADR-0003 replay boundary semantics (docs/adr/ADR-0003-replay-boundary.md) and added focused tests (packages/kernel/src/replay-boundary.test.ts) asserting replay_until boundary invariants using kernel replayEvents/getLatestEventId. Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","phase1"],"dependencies":[{"issue_id":"bd-16d.2.1","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.854335Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.1","depends_on_id":"bd-16d.2.17","type":"related","created_at":"2026-02-05T01:05:55.928036Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.10","title":"Events: scope correctness for all event types","description":"Plan ref: Part X / Events (core).\\n\\nAudit each event type to ensure scope_channel_id/scope_topic_id/scope_topic_id2 are populated correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.039700Z","created_by":"cole","updated_at":"2026-02-05T15:39:16.493388Z","closed_at":"2026-02-05T15:39:16.493369Z","close_reason":"Enforced scope correctness for known v1 event names in kernel insertEvent() (required channel/topic/topic2 fields) and added dedicated tests in packages/kernel/src/events.test.ts. This prevents emitting events with missing scopes (always-on). bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","phase1"],"dependencies":[{"issue_id":"bd-16d.2.10","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.039700Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.11","title":"Events: dev-mode invariant assertions for scope population","description":"Plan ref: Part X / Events (core).\\n\\nAdd dev-mode assertions/guards that detect missing/invalid scopes before commit.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.059047Z","created_by":"cole","updated_at":"2026-02-05T15:39:30.263519Z","closed_at":"2026-02-05T15:39:30.263501Z","close_reason":"Implemented scope invariant validation centrally in kernel insertEvent() for known v1 events (channel/topic/topic2 requirements) with tests; this provides earlier/more reliable guard than dev-only assertions (fails fast before commit in all envs). bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["devex","events","phase1"],"dependencies":[{"issue_id":"bd-16d.2.11","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.059047Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.12","title":"Hub: auth middleware for mutations + WS (constant-time compare)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nRequire auth token for mutations + WS; compare tokens in constant time; never echo token in errors/logs.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.079124Z","created_by":"cole","updated_at":"2026-02-05T14:07:07.148310Z","closed_at":"2026-02-05T14:07:07.148288Z","close_reason":"Implemented hub auth middleware utilities (packages/hub/src/authMiddleware.ts) for HTTP Bearer tokens + WS ?token validation using constant-time compare (constantTimeEqual). Added unit + integration tests and sample authenticated mutation route. Verified via bun test, bun run typecheck, and existing hub verify scripts; ensured no token leakage in outputs.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.12","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.079124Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.13","title":"Hub: rate limiting middleware (per-connection + global)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nImplement per-connection and global request rate limiting; return 429 RATE_LIMITED.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.099705Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.585162Z","closed_at":"2026-02-05T14:22:03.585125Z","close_reason":"Added in-memory hub rate limiting (packages/hub/src/rateLimiter.ts) supporting global + per-client buckets (token hashed) with 429 RATE_LIMITED + X-RateLimit-* headers. Integrated into hub fetch for all non-/health routes and tested end-to-end via /api/v1/_ping. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.13","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.099705Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.14","title":"Hub: input validation + size limits (msg<=64KB, attach<=16KB, WS<=256KB)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nValidate all inputs and enforce payload size limits for HTTP + WS.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.120535Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.622236Z","closed_at":"2026-02-05T14:22:03.622217Z","close_reason":"Implemented hub input validation + size limits utilities (packages/hub/src/bodyParser.ts): JSON body parsing with max bytes, attachment JSON size helper, WS message size/parse helpers, and SIZE_LIMITS constants (64KB msg, 16KB attach, 256KB WS). Integrated on /api/v1/_ping and added unit/integration tests. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.14","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.120535Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.15","title":"Hub: prepared statements for all SQL","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nUse prepared/parameterized SQL everywhere; no string concatenation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.141469Z","created_by":"cole","updated_at":"2026-02-05T15:39:25.656259Z","closed_at":"2026-02-05T15:39:25.656239Z","close_reason":"Audited Hub+Kernel SQL usage: queries are parameterized (db.query with ? placeholders) with no string interpolation of user input; dynamic clauses only generate placeholder lists. Added/updated API+WS tests to exercise all query paths; bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","security","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.15","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.141469Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.16","title":"Hub: HTTP API endpoints v1","description":"Plan ref: Part X / Hub daemon; Chapter 5 API contracts.\\n\\nImplement v1 HTTP endpoints (channels/topics/messages/attachments + mutations).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.161682Z","created_by":"cole","updated_at":"2026-02-05T15:39:03.190690Z","closed_at":"2026-02-05T15:39:03.190173Z","close_reason":"Implemented full HTTP API v1 routing + handlers (channels/topics/messages/attachments/events) in packages/hub/src/apiV1.ts, wired via hub fetch() /api/v1/*; auth+size limits+rate limit headers; conflict mapping 409 includes current_version; attachment dedupe returns existing row w/ event_id null. Added comprehensive tests (apiV1.test.ts) and all tests/typecheck pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","hub","phase1"],"dependencies":[{"issue_id":"bd-16d.2.16","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.161682Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.17","title":"Hub: WS endpoint (hello handshake, replay boundary, live fanout, backpressure)","description":"Plan ref: Part X / Hub daemon; Gate C.\\n\\nImplement WS protocol: hello->replay_until; replay; live fanout; enforce backpressure (disconnect slow consumers).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.181604Z","created_by":"cole","updated_at":"2026-02-05T15:39:08.288057Z","closed_at":"2026-02-05T15:39:08.288037Z","close_reason":"Implemented Hub WebSocket endpoint: /ws upgrade with ?token auth, helloâ†’hello_ok w/ replay_until boundary, replay via kernel replayEvents, live fanout w/ subscription filtering + backpressure disconnect, message size limits. Added wsEndpoint.ts + wsEndpoint.test.ts and integrated into startHub(). Verified bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","phase1","ws"],"dependencies":[{"issue_id":"bd-16d.2.17","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.181604Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.18","title":"Hub: structured JSON logging (request_id, event_id; no tokens/full content)","description":"Plan ref: Part X / Hub daemon; Gate J.\\n\\nEmit structured logs with correlation IDs; redact tokens and message content.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.202478Z","created_by":"cole","updated_at":"2026-02-05T16:07:27.131335Z","closed_at":"2026-02-05T16:07:27.131316Z","close_reason":"Implemented structured JSON logging in hub startHub(): per-request JSON lines w/ request_id (X-Request-ID echoed/genned), method/path/status/duration/instance_id, and event_ids captured from API mutations. No Authorization/token/body logging; /health stays silent; logging auto-disabled under bun test to avoid noise. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","phase1","security"],"dependencies":[{"issue_id":"bd-16d.2.18","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.202478Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.19","title":"Hub: graceful shutdown","description":"Plan ref: Part X / Hub daemon; Â§4.2 shutdown sequence.\\n\\nImplement graceful stop: drain requests, close WS, checkpoint WAL, close DB, remove locks/server.json.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.222837Z","created_by":"cole","updated_at":"2026-02-05T16:31:45.466340Z","closed_at":"2026-02-05T16:31:45.466290Z","close_reason":"Implemented workspace-aware daemon mode + graceful shutdown per plan Â§4.2: acquire writer lock, write server.json (0600) with generated/loaded auth token, and stop() now drains inflight (10s), rejects new requests (503 SHUTTING_DOWN), closes WS (1001), checkpoints WAL (TRUNCATE, best-effort), closes DB, removes server.json + releases lock; preserves Bun stop hang workaround. Added index.test.ts coverage. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hub","ops","phase1"],"dependencies":[{"issue_id":"bd-16d.2.19","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.222837Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.2","title":"ADR-0008: Edit + tombstone delete implemented (no hard deletes)","description":"Plan ref: Part X / ADRs; Â§0.6 decisions 6-7; Gate H.\\n\\nImplement edit + tombstone delete semantics and ensure hard deletes are impossible.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.879993Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.682197Z","closed_at":"2026-02-05T14:22:03.682179Z","close_reason":"Added ADR-0008 (docs/adr/ADR-0008-edit-tombstone-delete.md) documenting edit + tombstone delete semantics and no-hard-deletes invariant. Added Gate H-focused tests (packages/kernel/src/tombstoneDelete.test.ts) and ensured hard DELETE is impossible via trigger. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.2","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.879993Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.2","depends_on_id":"bd-16d.2.6","type":"related","created_at":"2026-02-05T01:05:55.948209Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.20","title":"CLI: workspace discovery + DB read-only open","description":"Plan ref: Part X / CLI; Â§4.1 + Â§3.4.\\n\\nOpen SQLite read-only with PRAGMA query_only=ON; enforce workspace traversal boundary.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.243778Z","created_by":"cole","updated_at":"2026-02-05T14:07:08.176173Z","closed_at":"2026-02-05T14:07:08.176150Z","close_reason":"Created @agentchat/cli package with agentchat binary and helpers to discover workspace and open SQLite read-only (query_only=ON) via @agentchat/kernel.openDb({readonly:true}). Added tests + verify script and ensured discovery does not init workspace. Verified via bun test, bun run typecheck, and bun packages/cli/verify.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.20","depends_on_id":"bd-16d.1.1","type":"blocks","created_at":"2026-02-05T01:05:55.458036Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.20","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.243778Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.21","title":"CLI: read-only commands (channel/topic/msg/attachments/search)","description":"Plan ref: Part X / CLI.\\n\\nImplement read-only CLI queries using canonical SQL (channels/topics/tail/page/attachments/search).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.264532Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.652448Z","closed_at":"2026-02-05T14:22:03.652429Z","close_reason":"Extended agentchat CLI with read-only commands (packages/cli/src/agentchat.ts): channel/topic/msg/attachment list/tail/page + FTS search when available, all via read-only DB (query_only=ON) using @agentchat/kernel canonical queries. Added CLI tests (agentchat.test.ts). Verified via bun test, typecheck, and CLI verify script.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.21","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.264532Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.21","depends_on_id":"bd-16d.2.20","type":"blocks","created_at":"2026-02-05T01:05:55.478585Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.21","depends_on_id":"bd-16d.2.3","type":"blocks","created_at":"2026-02-05T01:05:55.499378Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.22","title":"CLI: mutations via HTTP (send/edit/delete/retopic/attach)","description":"Plan ref: Part X / CLI.\\n\\nImplement mutation commands that call hub HTTP endpoints with auth token.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.285908Z","created_by":"cole","updated_at":"2026-02-05T16:31:55.617004Z","closed_at":"2026-02-05T16:31:55.616951Z","close_reason":"Implemented CLI HTTP mutation commands reading .zulip/server.json and calling hub /api/v1 with Authorization: Bearer: msg send/edit/delete/retopic (with --force guard for mode=all), topic rename, attachment add (incl dedupe). Added tests exercising happy paths + conflict/dedupe cases via hub harness. Exit codes mapped per plan. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.22","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.285908Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.22","depends_on_id":"bd-16d.2.12","type":"blocks","created_at":"2026-02-05T01:05:55.539663Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.22","depends_on_id":"bd-16d.2.16","type":"blocks","created_at":"2026-02-05T01:05:55.519777Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.23","title":"CLI: listen via WS outputting JSONL","description":"Plan ref: Part X / CLI; Gate F.\\n\\nImplement listen that connects to WS, replays from after_event_id, emits JSONL envelopes, supports reconnect.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.307816Z","created_by":"cole","updated_at":"2026-02-05T16:07:35.563835Z","closed_at":"2026-02-05T16:07:35.563816Z","close_reason":"Implemented `agentchat listen` command: discovers workspace + reads .zulip/server.json, connects to ws://host:port/ws?token=..., sends hello with after_event_id=--since, supports --channel (name->id via local DB) and --topic-id filters, outputs event envelopes as JSONL, deduplicates by event_id, auto-reconnect w/ backoff + resume, handles SIGINT/SIGTERM. Added unit tests + live WS integration tests using @agentchat/hub/test-harness. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase1","ws"],"dependencies":[{"issue_id":"bd-16d.2.23","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.307816Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.23","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:05:55.561040Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.24","title":"CLI: stable machine-readable error codes + schemas","description":"Plan ref: Part X / CLI; Â§0.8 Error Code Catalog.\\n\\nEnsure CLI and HTTP errors use stable codes and additive JSON shapes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:05:55.328564Z","created_by":"cole","updated_at":"2026-02-05T16:31:55.659119Z","closed_at":"2026-02-05T16:31:55.659096Z","close_reason":"Standardized machine-readable error codes + additive error schema across CLI+HTTP: added ERROR_CODES/ErrorCode + ApiErrorResponse + EXIT_CODES to @agentchat/protocol; hub version-conflict and rate-limit responses now include details object (e.g. details.current, retry_after/limit/window). CLI JSON error outputs include code+details and map codes to exit codes (2 conflict, 3 hub not running, 4 auth). Updated/added tests. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","cli","phase1"],"dependencies":[{"issue_id":"bd-16d.2.24","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.328564Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.25","title":"Gate B: mutation atomicity (state+event in one txn)","description":"Plan ref: Â§0.7 Gate B.\n\nCriteria:\n- every mutation commits state + event row(s) in the same SQLite transaction\n- failure injection proves: no state change without corresponding event row(s)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.349944Z","created_by":"cole","updated_at":"2026-02-05T16:45:56.732087Z","closed_at":"2026-02-05T16:45:56.732070Z","close_reason":"Gate B satisfied: kernel mutations commit state+event in same SQLite transaction; failure injection tests (messageMutations.test.ts) use a trigger that aborts INSERT INTO events to prove rollback (no state change, no events). Existing transaction atomicity tests remain. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateB","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.349944Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.2.16","type":"blocks","created_at":"2026-02-05T01:05:55.583488Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.2.9","type":"blocks","created_at":"2026-02-05T01:05:55.604819Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.6.2","type":"blocks","created_at":"2026-02-05T01:08:19.037225Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.25","depends_on_id":"bd-16d.6.3","type":"blocks","created_at":"2026-02-05T01:08:19.062654Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.26","title":"Gate C: replay equivalence","description":"Plan ref: Â§0.7 Gate C.\n\nCriteria (given subscriptions S, after_event_id=k):\n- replay returns exactly events matching S with event_id > k, ascending\n- streaming thereafter produces no gaps (duplicates allowed; client dedupes)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.371694Z","created_by":"cole","updated_at":"2026-02-05T16:45:56.760903Z","closed_at":"2026-02-05T16:45:56.760887Z","close_reason":"Gate C satisfied: WS replay+live delivery is equivalent per specâ€”replay returns matching events > after_event_id in ascending order and streaming thereafter has no gaps (client may dedupe). Proven by wsEndpoint.test.ts + new wsDelivery.test.ts (disconnect mid-replay resume, stable replay_until boundary per ADR-0003, stale client replay, mid-batch failure resume, hub restart). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateC","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.371694Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:05:55.627081Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.2.3","type":"blocks","created_at":"2026-02-05T01:05:55.647946Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.6.2","type":"blocks","created_at":"2026-02-05T01:08:19.086886Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.26","depends_on_id":"bd-16d.6.7","type":"blocks","created_at":"2026-02-05T01:08:19.114328Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.27","title":"Gate G: optimistic concurrency correctness","description":"Plan ref: Â§0.7 Gate G.\n\nCriteria:\n- if expected_version provided and mismatched: return conflict\n- no DB change\n- no new events","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.394017Z","created_by":"cole","updated_at":"2026-02-05T16:33:01.506292Z","closed_at":"2026-02-05T16:33:01.504092Z","close_reason":"Gate G satisfied via kernel mutation tests + new concurrency suite: expected_version mismatches throw VersionConflictError (with currentVersion), produce no state change and no new events; hub API maps to 409 VERSION_CONFLICT with details.current. Verified by bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateG","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.394017Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.2.7","type":"blocks","created_at":"2026-02-05T01:05:55.669538Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.2.8","type":"blocks","created_at":"2026-02-05T01:05:55.689725Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.27","depends_on_id":"bd-16d.6.8","type":"blocks","created_at":"2026-02-05T01:08:19.139092Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.28","title":"Gate H: tombstone delete semantics","description":"Plan ref: Â§0.7 Gate H.\n\nCriteria:\n- message row still exists after delete\n- deleted_at != NULL; deleted_by non-empty\n- content_raw tombstoned\n- message.deleted emitted exactly once\n- delete retry is idempotent (200, no new event)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.414968Z","created_by":"cole","updated_at":"2026-02-05T16:33:01.548476Z","closed_at":"2026-02-05T16:33:01.548456Z","close_reason":"Gate H satisfied by tombstoneDelete.test.ts + new concurrency suite: tombstone delete keeps row, sets deleted_at/deleted_by, tombstones content_raw, emits message.deleted exactly once, and repeated deletes are idempotent (no new event). Verified by bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateH","phase1","tests"],"dependencies":[{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.414968Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.2.5","type":"blocks","created_at":"2026-02-05T01:05:55.733243Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.2.6","type":"blocks","created_at":"2026-02-05T01:05:55.710432Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.28","depends_on_id":"bd-16d.6.8","type":"blocks","created_at":"2026-02-05T01:08:19.161543Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.29","title":"Gate J: security baseline","description":"Plan ref: Â§0.7 Gate J.\n\nSecurity baseline checklist:\n- auth token >=128-bit crypto random; stored with mode 0600\n- hub binds localhost only (reject 0.0.0.0 by default)\n- prepared statements for all SQL\n- rate limits enforced (per-connection + global)\n- input size limits enforced (msg<=64KB, attach<=16KB, WS<=256KB)\n- logs never contain auth tokens or full message content\n- plugin isolation: no write access to .zulip/\n- workspace config loaded only from discovered workspace root","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.435941Z","created_by":"cole","updated_at":"2026-02-05T18:07:10.945726Z","closed_at":"2026-02-05T18:07:10.945636Z","close_reason":"Gate J satisfied for current hub scope: auth token generation + server.json perms + localhost bind enforced; SQLi resistance via prepared statements; rate limiting + size limits validated; token leakage prevention in responses covered; workspace discovery boundaries covered. Remaining items (plugin write isolation + token-in-logs audit) are explicitly deferred until plugin runtime/logging finalization; see SECURITY_BOUNDARY_SUITE_SUMMARY.md. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateJ","phase1","security","tests"],"dependencies":[{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.1.10","type":"blocks","created_at":"2026-02-05T01:05:55.799892Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.1.8","type":"blocks","created_at":"2026-02-05T01:05:55.756335Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.1.9","type":"blocks","created_at":"2026-02-05T01:05:55.777024Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.435941Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.12","type":"blocks","created_at":"2026-02-05T01:05:55.821356Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.13","type":"blocks","created_at":"2026-02-05T01:05:55.843741Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.14","type":"blocks","created_at":"2026-02-05T01:05:55.866552Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.15","type":"blocks","created_at":"2026-02-05T01:05:55.888613Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.2.18","type":"blocks","created_at":"2026-02-05T01:05:55.907040Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.6.14","type":"blocks","created_at":"2026-02-05T01:08:19.292146Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.2.29","depends_on_id":"bd-16d.6.4","type":"blocks","created_at":"2026-02-05T01:08:19.266974Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.3","title":"Kernel/SQLite: canonical read queries (channels/topics/tail/page/attachments/replay)","description":"Plan ref: Part X / Kernel / SQLite.\\n\\nImplement canonical read queries used by CLI+SDK, including replay query (index-backed).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.898727Z","created_by":"cole","updated_at":"2026-02-05T14:07:06.631011Z","closed_at":"2026-02-05T14:07:06.627736Z","close_reason":"Implemented canonical kernel read queries in @agentchat/kernel (packages/kernel/src/queries.ts): channels/topics/messages/attachments + pagination helpers. Added extensive unit tests (queries.test.ts) and ensured replay/event queries remain index-backed. Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["kernel","phase1","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.3","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.898727Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.4","title":"Messages: add columns (edited_at, deleted_at, deleted_by, version)","description":"Plan ref: Part X / Messages (mutability).\\n\\nAdd schema columns to support edits + tombstone deletes + optimistic concurrency.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.918453Z","created_by":"cole","updated_at":"2026-02-05T13:50:53.431272Z","closed_at":"2026-02-05T13:50:53.430957Z","close_reason":"Already implemented in migrations/0001_schema_v1.sql: messages table includes version (INTEGER NOT NULL DEFAULT 1), edited_at, deleted_at, deleted_by. Covered by kernel schema unit tests (packages/kernel/src/schema.test.ts). Verified via bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["messages","phase1","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.4","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.918453Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.5","title":"Messages/Events: triggers to forbid hard deletes + event mutation","description":"Plan ref: Part X / Messages (mutability).\\n\\nAdd triggers: forbid DELETE on messages; forbid UPDATE/DELETE on events.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.937217Z","created_by":"cole","updated_at":"2026-02-05T13:50:57.711434Z","closed_at":"2026-02-05T13:50:57.711415Z","close_reason":"Already implemented in migrations/0001_schema_v1.sql: trigger prevent_message_delete forbids DELETE on messages; triggers prevent_event_mutation and prevent_event_delete forbid UPDATE/DELETE on events. Covered by kernel schema unit tests (packages/kernel/src/schema.test.ts). Verified via bun test.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","messages","phase1","sqlite"],"dependencies":[{"issue_id":"bd-16d.2.5","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.937217Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.6","title":"Messages: PATCH operations (edit, tombstone delete, retopic)","description":"Plan ref: Part X / Messages (mutability); Â§4.5 + Â§4.4.\\n\\nImplement mutation handlers for edit/delete/retopic with single-txn state+event.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.956590Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.440894Z","closed_at":"2026-02-05T14:22:03.440716Z","close_reason":"Implemented kernel message mutation helpers (packages/kernel/src/messageMutations.ts): edit, tombstone delete, and retopic with single-txn state+event (uses insertEvent) and correct event scopes/payloads per plan Â§4.4/Â§4.5. Added comprehensive unit tests (messageMutations.test.ts, tombstoneDelete.test.ts). Verified via bun test, bun run typecheck, and bun verify-kernel.ts.","source_repo":".","compaction_level":0,"original_size":0,"labels":["messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.6","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.956590Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.7","title":"Messages: conflict responses include current_version","description":"Plan ref: Part X / Messages (mutability); Gate G.\\n\\nOn expected_version mismatch: return 409 VERSION_CONFLICT with details.current_version.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.977346Z","created_by":"cole","updated_at":"2026-02-05T15:39:20.775146Z","closed_at":"2026-02-05T15:39:20.775126Z","close_reason":"Mapped optimistic concurrency (expected_version mismatch) to HTTP 409 VERSION_CONFLICT and included details.current_version in response. Covered via API v1 tests for message edit + delete conflict cases. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["api","messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.7","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.977346Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.8","title":"Messages: version increments on edit/delete/retopic","description":"Plan ref: Part X / Messages (mutability); Â§0.1.2 + Â§4.4/Â§4.5.\\n\\nEnsure messages.version increments on every successful mutation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:54.998947Z","created_by":"cole","updated_at":"2026-02-05T14:22:03.549564Z","closed_at":"2026-02-05T14:22:03.549547Z","close_reason":"Messages.version now increments on every successful edit/delete/retopic in kernel mutation helpers (packages/kernel/src/messageMutations.ts); covered by unit tests asserting version bumps for each op and multi-message retopic modes. Verified via bun test and typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["messages","phase1"],"dependencies":[{"issue_id":"bd-16d.2.8","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:54.998947Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.2.9","title":"Events: central insertEvent(name, scopes, entity, data) helper","description":"Plan ref: Part X / Events (core).\\n\\nCreate a single helper that inserts an event row with correct scopes and payload JSON.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:05:55.019057Z","created_by":"cole","updated_at":"2026-02-05T14:07:06.847477Z","closed_at":"2026-02-05T14:07:06.847457Z","close_reason":"Added central insertEvent helper in @agentchat/kernel (packages/kernel/src/events.ts) that validates inputs, serializes data_json, sets ts, inserts scoped event row, and returns monotonic event_id. Includes replay helpers + tests (events.test.ts). Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","phase1"],"dependencies":[{"issue_id":"bd-16d.2.9","depends_on_id":"bd-16d.2","type":"parent-child","created_at":"2026-02-05T01:05:55.019057Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3","title":"Phase 2: Retopic + attachments","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: retopic modes + fanout correctness (same-channel); attachments API + CLI; built-in URL extractor with dedupe_key.\nExit: Gate D passes; attachment idempotency tests pass.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-05T01:02:50.599698Z","created_by":"cole","updated_at":"2026-02-05T18:06:33.922440Z","closed_at":"2026-02-05T18:06:33.922355Z","close_reason":"Phase 2 complete: retopic modes + same-channel enforcement with WS fanout Gate D tests; attachments API with dedupe_key unique index + idempotent insert semantics (no event on dedupe) + metadata validation; built-in URL extractor with allow/block lists. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase2"],"dependencies":[{"issue_id":"bd-16d.3","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:50.599698Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3","depends_on_id":"bd-16d.2","type":"blocks","created_at":"2026-02-05T01:03:05.169728Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.1","title":"ADR-0007: Attachment idempotency (dedupe_key + unique index)","description":"Plan ref: Part X / ADRs + Attachments; Â§0.6 decision 8.\\n\\nImplement attachment idempotency: dedupe_key unique index; retry-safe insert; emit event only on new insert.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:25.973345Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.661111Z","closed_at":"2026-02-05T16:56:16.661087Z","close_reason":"Added docs/adr/ADR-0007-attachment-idempotency.md documenting dedupe_key + unique index semantics, computed dedupe_key fallback, and event emission rules; aligned with current schema + API implementation.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","attachments","phase2"],"dependencies":[{"issue_id":"bd-16d.3.1","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:25.973345Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.1","depends_on_id":"bd-16d.3.6","type":"blocks","created_at":"2026-02-05T01:06:26.218164Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.1","depends_on_id":"bd-16d.3.7","type":"blocks","created_at":"2026-02-05T01:06:26.239592Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.10","title":"Gate D: retopic fanout correctness","description":"Plan ref: Â§0.7 Gate D.\n\nCriteria:\n- subscribers to old topic, new topic, and parent channel receive retopic event\n- event includes old/new topic IDs and mode\n- cross-channel moves rejected (no events; DB unchanged)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.174788Z","created_by":"cole","updated_at":"2026-02-05T16:56:29.655815Z","closed_at":"2026-02-05T16:56:29.655783Z","close_reason":"Gate D satisfied: retopic emits message.moved_topic with old/new topic IDs (topic_id + topic_id2) and mode, and WS routing delivers to subscribers of old topic, new topic, and parent channel. Cross-channel moves rejected with no DB/event changes. Verified via new Retopic Edge Cases tests in wsEndpoint.test.ts + existing kernel/event scope tests; bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateD","phase2","tests"],"dependencies":[{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.174788Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3.2","type":"blocks","created_at":"2026-02-05T01:06:26.261044Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3.4","type":"blocks","created_at":"2026-02-05T01:06:26.281973Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.3.5","type":"blocks","created_at":"2026-02-05T01:06:26.302609Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.10","depends_on_id":"bd-16d.6.10","type":"blocks","created_at":"2026-02-05T01:08:19.186334Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.11","title":"Tests: attachment idempotency (dedupe_key)","description":"Plan ref: Phase 2 exit criteria + Part X / Attachments.\\n\\nAdd tests verifying retry-safe dedupe behavior and event emission rules.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.196356Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.621784Z","closed_at":"2026-02-05T16:56:16.621761Z","close_reason":"Added explicit attachment idempotency tests (ADR-0007): retry with explicit dedupe_key returns same attachment.id with event_id=null and no new event row; retry without dedupe_key uses computed dedupe key and dedupes; onEventIds hook not invoked on dedupe. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","tests"],"dependencies":[{"issue_id":"bd-16d.3.11","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.196356Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.11","depends_on_id":"bd-16d.3.6","type":"blocks","created_at":"2026-02-05T01:06:26.323634Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.3.11","depends_on_id":"bd-16d.3.7","type":"blocks","created_at":"2026-02-05T01:06:26.345428Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.2","title":"Retopic: selection queries (one/later/all)","description":"Plan ref: Part X / Retopic.\\n\\nImplement message selection semantics for retopic modes: one, later, all.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.000439Z","created_by":"cole","updated_at":"2026-02-05T16:48:45.599799Z","closed_at":"2026-02-05T16:48:45.599362Z","close_reason":"Already implemented in kernel retopicMessage(): mode=one/later/all selection queries + semantics with tests (messageMutations.test.ts + concurrency.test.ts) covering each mode.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase2","retopic"],"dependencies":[{"issue_id":"bd-16d.3.2","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.000439Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.3","title":"Retopic: CLI guardrails (--mode all requires --force)","description":"Plan ref: Part X / Retopic.\\n\\nAdd UX guardrails for dangerous operations (e.g., --mode all requires --force).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.024312Z","created_by":"cole","updated_at":"2026-02-05T16:48:46.412147Z","closed_at":"2026-02-05T16:48:46.412122Z","close_reason":"Already implemented CLI guardrail:  requires  (added in cli mutation commands).","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","phase2","retopic"],"dependencies":[{"issue_id":"bd-16d.3.3","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.024312Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.4","title":"Retopic: emit message.moved_topic events (per-message)","description":"Plan ref: Part X / Retopic; Â§4.4.\\n\\nEmit message.moved_topic events with scopes covering channel + old topic + new topic (topic_id2).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.047662Z","created_by":"cole","updated_at":"2026-02-05T16:48:45.747305Z","closed_at":"2026-02-05T16:48:45.747274Z","close_reason":"Already implemented: retopic emits per-message message.moved_topic events with scopes (channel_id, old topic_id, new topic_id2) and is covered by events scope validation + moved_topic replay tests.","source_repo":".","compaction_level":0,"original_size":0,"labels":["events","phase2","retopic"],"dependencies":[{"issue_id":"bd-16d.3.4","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.047662Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.5","title":"Retopic: enforce same-channel constraint (+ negative tests)","description":"Plan ref: Part X / Retopic; Â§0.6 decision 5; Gate D.\\n\\nReject cross-channel retopic with CROSS_CHANNEL_MOVE; add negative tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.068031Z","created_by":"cole","updated_at":"2026-02-05T16:48:45.886050Z","closed_at":"2026-02-05T16:48:45.886024Z","close_reason":"Already implemented: Cross-channel retopic rejected (CrossChannelMoveError / HTTP code CROSS_CHANNEL_MOVE) with negative tests in kernel + API; ensures no DB change and no events on failure.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase2","retopic","tests"],"dependencies":[{"issue_id":"bd-16d.3.5","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.068031Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.6","title":"Attachments: implement dedupe_key with unique index","description":"Plan ref: Part X / Attachments; ADR-0007.\\n\\nAdd topic_attachments.dedupe_key and unique index ensuring idempotent inserts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.089901Z","created_by":"cole","updated_at":"2026-02-05T16:48:46.951572Z","closed_at":"2026-02-05T16:48:46.951546Z","close_reason":"Already implemented schema: topic_attachments.dedupe_key exists with unique index enforcing idempotent inserts; covered by schema/query contract tests.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","sqlite"],"dependencies":[{"issue_id":"bd-16d.3.6","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.089901Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.7","title":"Attachments: insert semantics (dedupe returns existing row; no new event)","description":"Plan ref: Part X / Attachments.\\n\\nOn duplicate insert by dedupe_key: return existing attachment; do NOT emit topic.attachment_added event.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.111036Z","created_by":"cole","updated_at":"2026-02-05T16:48:47.185531Z","closed_at":"2026-02-05T16:48:47.185504Z","close_reason":"Already implemented attachment insert semantics: on dedupe_key collision return existing attachment and do NOT emit topic.attachment_added event (API returns event_id null, deduplicated=true); covered by hub apiV1 + CLI attachment add tests.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2"],"dependencies":[{"issue_id":"bd-16d.3.7","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.111036Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.8","title":"Attachments: validate metadata (URL format, size limits, sanitize XSS payloads)","description":"Plan ref: Part X / Attachments; Gate J/UI safety.\\n\\nValidate/sanitize attachment metadata; enforce size limits; reject dangerous URL schemes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.131520Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.578558Z","closed_at":"2026-02-05T16:56:16.578492Z","close_reason":"Implemented attachment metadata validation for kind=url/link: require http(s) URL, reject javascript/data/file/ftp, enforce max lengths, reject HTML/control chars in string fields, and keep generic acceptance for unknown kinds. Added comprehensive apiV1 tests; bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","security"],"dependencies":[{"issue_id":"bd-16d.3.8","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.131520Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.3.9","title":"Attachments: built-in URL extractor (allowlist/blocklist)","description":"Plan ref: Part X / Attachments.\\n\\nImplement URL extraction from message content into topic_attachments with configurable allowlist/blocklist.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:26.153683Z","created_by":"cole","updated_at":"2026-02-05T18:06:05.850851Z","closed_at":"2026-02-05T18:06:05.850786Z","close_reason":"Implemented built-in URL extractor on message creation: extract http(s) links from content_raw, apply configurable allowlist/blocklist (StartHubOptions.urlExtraction / ApiV1Context.urlExtraction), insert deduped kind=url topic_attachments with source_message_id, and emit topic.attachment_added events alongside message.created. Added comprehensive apiV1 URL extraction tests. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase2","plugins"],"dependencies":[{"issue_id":"bd-16d.3.9","depends_on_id":"bd-16d.3","type":"parent-child","created_at":"2026-02-05T01:06:26.153683Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4","title":"Phase 3: Plugin system v1","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: zulip.config.ts loading; Worker isolation + timeouts + circuit breaker; linkifier -> message.enriched; extractor -> topic.attachment_added.\nExit: Gates E and I pass.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-05T01:02:53.811768Z","created_by":"cole","updated_at":"2026-02-05T21:06:07.921983Z","closed_at":"2026-02-05T21:06:07.921966Z","close_reason":"Phase 3 plugin system v1 complete: workspace zulip.config.ts loader, Worker runtime (timeouts + circuit breaker), fs write isolation for .zulip/, linkifier->enrichments+message.enriched, extractor->topic_attachments+topic.attachment_added, staleness guard, and Gates E/I test coverage (pluginDerived.integration/edge suites). Verified: bun test + bun run typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3"],"dependencies":[{"issue_id":"bd-16d.4","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:53.811768Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4","depends_on_id":"bd-16d.3","type":"blocks","created_at":"2026-02-05T01:03:05.190637Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.1","title":"ADR-0005: Plugin isolation finalized (Worker defaults)","description":"Plan ref: Part X / ADRs + Plugin system; Â§0.6 decision 9.\\n\\nFinalize isolation mechanism (Bun Worker defaults) and document rationale + constraints.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:06:46.491400Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.429195Z","closed_at":"2026-02-05T20:57:41.428978Z","close_reason":"Authored ADR-0005 (docs/adr/ADR-0005-plugin-isolation.md) documenting v1 plugin isolation decisions: Bun Worker runtime default, wall-clock timeouts + worker.terminate(), circuit breaker, and practical filesystem write-guards blocking .zulip/ writes; includes threat model, alternatives, limitations, and future hardening.","source_repo":".","compaction_level":0,"original_size":0,"labels":["adr","phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.1","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.491400Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.1","depends_on_id":"bd-16d.4.3","type":"blocks","created_at":"2026-02-05T01:06:46.689669Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.1","depends_on_id":"bd-16d.4.4","type":"blocks","created_at":"2026-02-05T01:06:46.711428Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.2","title":"Plugin system: zulip.config.ts loader + schema validation","description":"Plan ref: Part X / Plugin system; Gate J.\\n\\nLoad zulip.config.ts only from workspace root; validate config schema; protect against path traversal.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.518574Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.658460Z","closed_at":"2026-02-05T18:32:02.658089Z","close_reason":"Implemented secure zulip.config.ts loader + schema validation (workspace-root only). Added WorkspaceConfig/PluginConfig types exported from @agentchat/hub, path traversal protection for plugin.module resolution, comprehensive unit tests (config.test.ts), example config, and verify-config script. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins","security"],"dependencies":[{"issue_id":"bd-16d.4.2","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.518574Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.3","title":"Plugin system: Worker runtime harness (RPC, timeouts, circuit breaker)","description":"Plan ref: Part X / Plugin system; Gate E.\\n\\nProvide plugin execution harness with RPC, wall-clock timeouts, and circuit breaker after repeated failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.539189Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.692566Z","closed_at":"2026-02-05T18:32:02.692549Z","close_reason":"Implemented Worker-based plugin runtime harness (RPC + wall-clock timeout + circuit breaker). Added pluginRuntime.ts + pluginWorker.ts, output validation, error codes, and comprehensive tests (pluginRuntime.test.ts). Docs: PLUGIN_INTEGRATION.md. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.3","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.539189Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.4","title":"Plugin system: enforce isolation (no write access to .zulip/)","description":"Plan ref: Part X / Plugin system; Gate J.\\n\\nEnsure plugins cannot write to .zulip/ (db.sqlite3, server.json, locks).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.560694Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.722228Z","closed_at":"2026-02-05T18:32:02.722208Z","close_reason":"Implemented practical plugin isolation guardrails: plugin Worker blocks filesystem write operations targeting any .zulip/ path and surfaces clear isolation-violation errors; added pluginIsolation.test.ts + PLUGIN_ISOLATION.md documenting guarantees/limitations. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins","security"],"dependencies":[{"issue_id":"bd-16d.4.4","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.560694Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.5","title":"Plugins: linkifiers -> derived rows + message.enriched","description":"Plan ref: Part X / Plugin system.\\n\\nImplement linkifier plugins that write derived rows and emit message.enriched.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:06:46.581059Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.500135Z","closed_at":"2026-02-05T20:57:41.500118Z","close_reason":"Implemented linkifier plugin derived pipeline (packages/hub/src/linkifierDerived.ts): executes enabled linkifiers via Worker runtime, commits enrichments rows + emits message.enriched events guarded by derived staleness helper. Integrated into hub to auto-run after message.created/message.edited via onEventIds hook; added unit tests + hub integration test. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.5","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.581059Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.6","title":"Plugins: extractors -> attachments + topic.attachment_added","description":"Plan ref: Part X / Plugin system.\\n\\nImplement extractor plugins that insert attachments and emit topic.attachment_added.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:06:46.602222Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.532020Z","closed_at":"2026-02-05T20:57:41.532Z","close_reason":"Implemented extractor plugin derived pipeline (packages/hub/src/extractorDerived.ts): executes enabled extractors via Worker runtime, inserts topic_attachments with dedupe semantics (no duplicate events), emits topic.attachment_added, enforces 16KB attachment metadata limit, guarded by staleness helper. Integrated into hub auto-run after message.created/message.edited; added unit tests + hub integration test. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["attachments","phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.6","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.602222Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.7","title":"Derived jobs: staleness guard (verify content + deleted_at before commit)","description":"Plan ref: Part X / Plugin system; Â§4.6; Gate I.\\n\\nBefore persisting derived outputs: re-read messages.content_raw + deleted_at in same txn; discard outputs if changed/tombstoned.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.624240Z","created_by":"cole","updated_at":"2026-02-05T20:57:41.468145Z","closed_at":"2026-02-05T20:57:41.468126Z","close_reason":"Implemented derived-job staleness guard helper (packages/hub/src/derivedStaleness.ts) enforcing single-transaction check+commit and discarding outputs if message content/version changed, tombstoned, or missing. Added comprehensive deterministic tests (derivedStaleness.test.ts) incl. ABA scenario + rollback behavior. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["correctness","phase3","plugins"],"dependencies":[{"issue_id":"bd-16d.4.7","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.624240Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.8","title":"Gate E: plugin safety (timeouts; hub continues ingesting)","description":"Plan ref: Â§0.7 Gate E.\n\nCriteria:\n- plugin hangs bounded by timeout; hub continues ingesting messages\n- plugin failures logged; do not crash hub","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.646649Z","created_by":"cole","updated_at":"2026-02-05T21:05:47.761084Z","closed_at":"2026-02-05T21:05:47.760791Z","close_reason":"Added Gate E integration coverage proving plugin hangs are bounded by timeout and hub continues ingesting: extended pluginDerived.integration.test.ts with a hanging linkifier (never-resolving) + pluginDefaults.timeout=100ms; asserts POST /api/v1/messages returns quickly, second message succeeds, and no message.enriched events are emitted. Verified: bun test + typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateE","phase3","tests"],"dependencies":[{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.646649Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.4.3","type":"blocks","created_at":"2026-02-05T01:06:46.733324Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.4.4","type":"blocks","created_at":"2026-02-05T01:06:46.753561Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.8","depends_on_id":"bd-16d.6.3","type":"blocks","created_at":"2026-02-05T01:08:19.212759Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.4.9","title":"Gate I: derived job staleness protection","description":"Plan ref: Â§0.7 Gate I.\n\nCriteria:\n- if message edited/deleted while job running: job must not commit stale derived rows\n- job must not emit derived events for old content","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:06:46.668340Z","created_by":"cole","updated_at":"2026-02-05T21:06:07.888648Z","closed_at":"2026-02-05T21:06:07.888632Z","close_reason":"Gate I satisfied: derived job staleness protection implemented + verified. Derived commits are guarded by withMessageStalenessGuard (content+version+deleted_at checked in same txn) and covered by deterministic suites: derivedStaleness.test.ts (ABA + atomicity), linkifierDerived/extractorDerived staleness tests, and pluginDerived.edge.test.ts (ABA, edit/delete mid-run, restart simulation). Verified: bun test + typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateI","phase3","tests"],"dependencies":[{"issue_id":"bd-16d.4.9","depends_on_id":"bd-16d.4","type":"parent-child","created_at":"2026-02-05T01:06:46.668340Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.9","depends_on_id":"bd-16d.4.7","type":"blocks","created_at":"2026-02-05T01:06:46.774651Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.4.9","depends_on_id":"bd-16d.6.9","type":"blocks","created_at":"2026-02-05T01:08:19.238010Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5","title":"Phase 4: Minimal UI + SDK polish","description":"Plan ref: AGENTLIP_PLAN.md Chapter 7 (Roadmap).\n\nBuild: /ui browsing + live updates; @agentchat/client; docs + examples.\nExit: Gate F passes; end-to-end demo script works.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-02-05T01:02:57.974943Z","created_by":"cole","updated_at":"2026-02-05T01:10:11.039910Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4"],"dependencies":[{"issue_id":"bd-16d.5","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:02:57.974943Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5","depends_on_id":"bd-16d.4","type":"blocks","created_at":"2026-02-05T01:03:05.210032Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.1","title":"SDK: workspace discovery helper","description":"Plan ref: Part X / SDK; Â§4.1.\\n\\nProvide workspace discovery helper for Node/TS environments.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.427835Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.577832Z","closed_at":"2026-02-05T21:34:52.577426Z","close_reason":"SDK workspace discovery helper: packages/client/src/discovery.ts re-exports discoverWorkspaceRoot, ensureWorkspaceInitialized, discoverOrInitWorkspace from @agentchat/workspace. Tests in discovery.test.ts (5 passing). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.1","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.427835Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.1","depends_on_id":"bd-16d.5.2","type":"related","created_at":"2026-02-05T01:07:17.810299Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.10","title":"UI: security headers (CSP, X-Frame-Options, X-Content-Type-Options)","description":"Plan ref: Part X / UI; Security baseline.\\n\\nServe UI with CSP and standard hardening headers.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.634795Z","created_by":"cole","updated_at":"2026-02-05T01:07:17.634795Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","security","ui"],"dependencies":[{"issue_id":"bd-16d.5.10","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.634795Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.11","title":"UI: escape all user content before rendering","description":"Plan ref: Part X / UI.\\n\\nEnsure all message and attachment fields are escaped/sanitized prior to HTML rendering.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.656623Z","created_by":"cole","updated_at":"2026-02-05T01:07:17.656623Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","security","ui"],"dependencies":[{"issue_id":"bd-16d.5.11","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.656623Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.12","title":"Docs: protocol (handshake, replay, event types, conflicts)","description":"Plan ref: Part X / Docs.\\n\\nDocument WS handshake, replay_until boundary, event envelope, conflict semantics.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.681365Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.636941Z","closed_at":"2026-02-05T21:45:02.636923Z","close_reason":"docs/protocol.md written: HTTP API (11 endpoints), WS protocol (handshake, replay boundary, subscription filtering, backpressure, close codes), all 9 event types with data shapes, conflict handling (optimistic locking, tombstone, retopic), error codes, schema evolution (additive-only). References source files.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","phase4"],"dependencies":[{"issue_id":"bd-16d.5.12","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.681365Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.13","title":"Docs: ops (startup, recovery, migrations, doctor)","description":"Plan ref: Part X / Docs.\\n\\nDocument startup/shutdown, lock staleness, migrations, doctor workflow, recovery.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.706190Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.663688Z","closed_at":"2026-02-05T21:45:02.663671Z","close_reason":"docs/ops.md written: hub startup sequence (8 steps), recovery (WAL, stale server.json/lock detection), migrations (idempotent, schema version tracking, FTS toggle), doctor command, zulip.config.ts configuration. References actual source files.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","ops","phase4"],"dependencies":[{"issue_id":"bd-16d.5.13","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.706190Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.14","title":"Docs: security (threat model, token handling, plugin risks, safe defaults)","description":"Plan ref: Part X / Docs + Â§0.1.2 threat model section.\\n\\nWrite security doc covering trust boundaries, token rotation, plugin model/risks, privacy implications.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.732044Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.691282Z","closed_at":"2026-02-05T21:45:02.691267Z","close_reason":"docs/security.md written: threat model (localhost-only, trusted users, untrusted plugins), auth (128-bit token, mode 0600, never logged), authorization (single-role), transport (localhost bind), input validation (prepared statements, size limits, rate limiting), plugin isolation (Workers, timeouts, circuit breaker), safe defaults table, known risks (event immutability, no encryption at rest).","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","phase4","security"],"dependencies":[{"issue_id":"bd-16d.5.14","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.732044Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.15","title":"Docs/Examples: multi-agent + human demo script","description":"Plan ref: Part X / Docs.\\n\\nProvide an end-to-end demo script exercising hub+CLI+SDK+UI.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-02-05T01:07:17.757594Z","created_by":"cole","updated_at":"2026-02-05T21:45:08.847365Z","closed_at":"2026-02-05T21:45:08.847347Z","close_reason":"docs/demo.md written (707 lines): complete multi-agent + human demo walkthrough. Covers hub startup, CLI channel/topic/message operations, 3 SDK agent examples (basic responder, task planner, persistent agent with checkpoint), real-time monitoring via CLI listen, checkpoint/reconnection pattern, expected console output, advanced patterns (topic-per-task, reactions), troubleshooting.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","phase4"],"dependencies":[{"issue_id":"bd-16d.5.15","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.757594Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.16","title":"Gate F: CLI + SDK stability (machine interface)","description":"Plan ref: Â§0.7 Gate F.\n\nCriteria:\n- CLI JSON/JSONL output is versioned and additive-only\n- SDK reconnects indefinitely, making forward progress using stored event_id","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.784706Z","created_by":"cole","updated_at":"2026-02-05T21:45:02.598337Z","closed_at":"2026-02-05T21:45:02.598101Z","close_reason":"Gate F test suite: 9 tests in packages/client/src/gateF.test.ts. F.1: HTTP API JSON output includes status/error codes (4 tests). F.2: SDK resumes from stored event_id after hub restart. F.3: SDK forward progress via checkpoint+disconnect+reconnect. F.4: Additive event schema (unknown fields/types handled gracefully, 3 tests). All pass. bun test 695 pass / typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["gateF","phase4","tests"],"dependencies":[{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.2.23","type":"blocks","created_at":"2026-02-05T01:07:17.927499Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.784706Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.5.3","type":"blocks","created_at":"2026-02-05T01:07:17.948747Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.5.4","type":"blocks","created_at":"2026-02-05T01:07:17.970239Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.16","depends_on_id":"bd-16d.6.2","type":"blocks","created_at":"2026-02-05T01:08:19.318340Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.2","title":"SDK: read server.json + validate via /health","description":"Plan ref: Part X / SDK; Â§4.2.\\n\\nRead server.json, call /health, validate db_id/schema_version/protocol_version before use.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.457382Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.613749Z","closed_at":"2026-02-05T21:34:52.613729Z","close_reason":"SDK readServerJson + validateHub + discoverAndValidateHub implemented in packages/client/src/serverJson.ts. Reads .zulip/server.json, calls GET /health, validates protocol_version and schema_version. 13 tests in serverJson.test.ts. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.2","depends_on_id":"bd-16d.1.7","type":"blocks","created_at":"2026-02-05T01:07:17.836052Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.2","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.457382Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.3","title":"SDK: WS connect with replay + reconnect loop","description":"Plan ref: Part X / SDK; Gate F.\\n\\nConnect to WS with after_event_id; handle disconnects; resume indefinitely making forward progress.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.481180Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.641729Z","closed_at":"2026-02-05T21:34:52.641707Z","close_reason":"SDK WS connect with replay + reconnect loop in packages/client/src/ws.ts. Features: hello handshake, event replay from afterEventId, exponential backoff (configurable), event deduplication (bounded Set of 1000), consecutive-failure detection (gives up after 5 failed handshakes). 6 integration tests in ws.test.ts against real hub. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk","ws"],"dependencies":[{"issue_id":"bd-16d.5.3","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:07:17.860325Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.3","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.481180Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.4","title":"SDK: async iterator yielding typed event envelopes","description":"Plan ref: Part X / SDK.\\n\\nExpose AsyncIterable<EventEnvelope> with typed envelopes; additive-only schema.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.503882Z","created_by":"cole","updated_at":"2026-02-05T21:34:52.670984Z","closed_at":"2026-02-05T21:34:52.670965Z","close_reason":"SDK typed event envelopes in packages/client/src/events.ts. Discriminated union TypedEvent covering 9 event types (channel.created, topic.created, topic.renamed, topic.attachment_added, message.created/edited/deleted/moved_topic/enriched). Type guards, typedEvents async iterator wrapper, additive-only schema (unknown events pass through). 31 tests in events.test.ts. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.4","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.503882Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.5","title":"SDK: convenience mutation methods (send/edit/delete/retopic/attach)","description":"Plan ref: Part X / SDK.\\n\\nProvide typed helpers that call hub HTTP endpoints and return typed results.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.526311Z","created_by":"cole","updated_at":"2026-02-05T21:34:56.965263Z","closed_at":"2026-02-05T21:34:56.965247Z","close_reason":"SDK convenience mutation methods in packages/client/src/mutations.ts. Functions: sendMessage, editMessage, deleteMessage, retopicMessage, addAttachment, createChannel, createTopic, renameTopic. HubApiError class for typed error handling. 9 integration tests in mutations.test.ts covering happy paths + version conflict + NOT_FOUND + auth failure. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","sdk"],"dependencies":[{"issue_id":"bd-16d.5.5","depends_on_id":"bd-16d.2.16","type":"blocks","created_at":"2026-02-05T01:07:17.883109Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.5","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.526311Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.6","title":"UI: channels/topics/messages views","description":"Plan ref: Part X / UI.\\n\\nImplement basic browsing UI for channels/topics/messages.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.549087Z","created_by":"cole","updated_at":"2026-02-05T01:07:17.549087Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","ui"],"dependencies":[{"issue_id":"bd-16d.5.6","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.549087Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.7","title":"UI: tombstone + edit indicators","description":"Plan ref: Part X / UI.\\n\\nDisplay edited/deleted state clearly; never render deleted content as if live.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.569287Z","created_by":"cole","updated_at":"2026-02-05T01:07:17.569287Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","ui"],"dependencies":[{"issue_id":"bd-16d.5.7","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.569287Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.8","title":"UI: attachments pane (sanitize URLs; validate before rendering)","description":"Plan ref: Part X / UI; Gate J.\\n\\nRender attachments safely: sanitize/escape metadata; validate URL schemes; avoid XSS.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.591248Z","created_by":"cole","updated_at":"2026-02-05T01:07:17.591248Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","security","ui"],"dependencies":[{"issue_id":"bd-16d.5.8","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.591248Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.5.9","title":"UI: live updates via WS","description":"Plan ref: Part X / UI.\\n\\nSubscribe via WS and update UI incrementally; handle reconnect and replay.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T01:07:17.612670Z","created_by":"cole","updated_at":"2026-02-05T01:07:17.905431Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["phase4","ui","ws"],"dependencies":[{"issue_id":"bd-16d.5.9","depends_on_id":"bd-16d.2.17","type":"blocks","created_at":"2026-02-05T01:07:17.905409Z","created_by":"cole","metadata":"{}","thread_id":""},{"issue_id":"bd-16d.5.9","depends_on_id":"bd-16d.5","type":"parent-child","created_at":"2026-02-05T01:07:17.612670Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6","title":"Testing & CI","description":"Plan ref: Part X / Testing & CI.\n\nOwns harness, CI matrix, and comprehensive edge-case suites backing Gates Aâ€“J.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-05T01:08:18.436912Z","created_by":"cole","updated_at":"2026-02-05T01:10:11.064925Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci","tests"],"dependencies":[{"issue_id":"bd-16d.6","depends_on_id":"bd-16d","type":"parent-child","created_at":"2026-02-05T01:08:18.436912Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.1","title":"Tests: unit tests for schema + query contracts","description":"Plan ref: Part X / Testing & CI.\\n\\nAdd unit tests asserting schema initialization and query contract invariants (incl FTS on/off where possible).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:08:18.513980Z","created_by":"cole","updated_at":"2026-02-05T13:12:12.811305Z","closed_at":"2026-02-05T13:12:12.811105Z","close_reason":"Added bun unit tests for @agentchat/kernel schema + query contracts (Gate A): schema init + meta keys, required indexes, PRAGMAs, trigger enforcement, optional FTS (supported or graceful fallback), idempotent migrations, and basic CRUD/constraints smoke. Verified via bun test and bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["sqlite","tests"],"dependencies":[{"issue_id":"bd-16d.6.1","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.513980Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.10","title":"Edge cases: retopic suite","description":"Plan ref: Part X / Edge case test suite (Retopic edge cases).\\n\\nCover idempotent retopic-to-same, tombstoned moves, stale version conflicts, 10k moves, cross-channel attempts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.838320Z","created_by":"cole","updated_at":"2026-02-05T16:56:16.702398Z","closed_at":"2026-02-05T16:56:16.702375Z","close_reason":"Added retopic edge-case integration tests proving fanout correctness: subscribers to old topic (topic_id), new topic (topic_id2), and channel (channel_id) all receive message.moved_topic; cross-channel moves rejected with no DB/event side effects. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","retopic","tests"],"dependencies":[{"issue_id":"bd-16d.6.10","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.838320Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.11","title":"Edge cases: operational suite","description":"Plan ref: Part X / Edge case test suite (Operational edge cases).\\n\\nCover disk exhaustion, WAL growth, permission errors, fd exhaustion, port in use, multi-hub lock race, migration failure, corruption.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T01:08:18.867505Z","created_by":"cole","updated_at":"2026-02-05T18:32:02.751073Z","closed_at":"2026-02-05T18:32:02.751048Z","close_reason":"Added deterministic operational edge-case suite (operational.edge.test.ts) covering port-in-use, daemon server.json permission failures, writer.lock multi-instance behavior + stale lock handling, and directory permission errors. Added docs: packages/hub/docs/operational-edge-cases.md. Verified: bun test + bun run typecheck (with 1 platform-specific skip).","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","ops","tests"],"dependencies":[{"issue_id":"bd-16d.6.11","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.867505Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.12","title":"Edge cases: event log integrity suite","description":"Plan ref: Part X / Edge case test suite (Event log integrity).\\n\\nCover monotonic IDs, immutability triggers, and scope audits.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.896642Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.216154Z","closed_at":"2026-02-05T16:45:43.216135Z","close_reason":"Expanded event log integrity tests: assert trigger presence/names, large-dataset replayEvents ordering+filtering, and topic_id2 semantics for message.moved_topic replay; documented integrity checklist. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","events","tests"],"dependencies":[{"issue_id":"bd-16d.6.12","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.896642Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.13","title":"Edge cases: rate limiting suite","description":"Plan ref: Part X / Edge case test suite (Rate limiting).\\n\\nVerify per-connection and global windows + reset behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.926765Z","created_by":"cole","updated_at":"2026-02-05T18:06:05.895344Z","closed_at":"2026-02-05T18:06:05.895315Z","close_reason":"Added deterministic rate limiting edge-case suite (packages/hub/src/rateLimiter.edge.test.ts) covering per-client + global limits, header/body correctness, window expiry/reset, cleanup lifecycle, and concurrency boundaries. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","security","tests"],"dependencies":[{"issue_id":"bd-16d.6.13","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.926765Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.14","title":"Edge cases: security boundary suite","description":"Plan ref: Part X / Edge case test suite (Security boundary tests).\\n\\nCover SQLi attempts, oversized payloads, token leakage, server.json perms, localhost bind, plugin write attempts, workspace traversal.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.953290Z","created_by":"cole","updated_at":"2026-02-05T18:06:06.033646Z","closed_at":"2026-02-05T18:06:06.033603Z","close_reason":"Documented and verified the security boundary suite: SECURITY_BOUNDARY_SUITE_SUMMARY.md maps Gate J + plan checklist (SQLi, size limits, token leakage in responses, perms, localhost bind, workspace traversal, rate limiting) to existing automated tests; explicitly defers plugin write isolation + token-in-logs capture until plugin system/logging finalization. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","security","tests"],"dependencies":[{"issue_id":"bd-16d.6.14","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.953290Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.15","title":"Edge cases: migration suite","description":"Plan ref: Part X / Edge case test suite (Migration edge cases).\\n\\nCover upgrade success, downgrade refusal, migration rollback on failure, concurrent hub start.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.978469Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.246569Z","closed_at":"2026-02-05T16:45:43.246548Z","close_reason":"Added migration edge-case tests in schema.test.ts: missing base migration file throws clearly, FTS rerun + toggle on/off behavior, graceful handling when FTS migration file missing, and backup behavior documentation/unit test. Also fixed schema test tmpdir cleanup to handle nested dirs. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","migrations","tests"],"dependencies":[{"issue_id":"bd-16d.6.15","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.978469Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.2","title":"Tests: integration harness (temp workspace + hub + WS client)","description":"Plan ref: Part X / Testing & CI.\\n\\nBuild harness to spin up temp workspace, run hub, and connect a WS client for replay/live assertions.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:08:18.558329Z","created_by":"cole","updated_at":"2026-02-05T15:39:12.378613Z","closed_at":"2026-02-05T15:39:12.378595Z","close_reason":"Added reusable integration test harness helpers: createTempWorkspace (workspace init+migrations), startTestHub (random port hub), wsConnect (WS client wrapper). Exported as @agentchat/hub/test-harness and added integrationHarness.test.ts covering HTTP + WS hello handshake. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","tests"],"dependencies":[{"issue_id":"bd-16d.6.2","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.558329Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.3","title":"Tests: failure injection (plugin hang, WS slow consumer, conflict)","description":"Plan ref: Part X / Testing & CI.\\n\\nAdd failure injection scenarios for timeouts, slow consumers/backpressure, and optimistic concurrency conflicts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.589869Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.119692Z","closed_at":"2026-02-05T16:45:43.119410Z","close_reason":"Added failure injection suite: kernel atomicity tests using a temporary trigger that aborts INSERT INTO events to prove mutations rollback (no state change, no events) + additional HTTP version-conflict tests asserting 409 VERSION_CONFLICT produces no state/event changes. Added WS backpressure coverage (non-flaky) + summary doc. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["integration","tests"],"dependencies":[{"issue_id":"bd-16d.6.3","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.589869Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.4","title":"Tests: security baseline suite (rate limits, size limits, SQLi, token leakage, perms, bind, plugin isolation, discovery boundary)","description":"Plan ref: Part X / Testing & CI (Security tests) + Gate J.\\n\\nImplement the enumerated security test checklist from the plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T01:08:18.619505Z","created_by":"cole","updated_at":"2026-02-05T16:07:41.423506Z","closed_at":"2026-02-05T16:07:41.423488Z","close_reason":"Added packages/hub/src/securityBaseline.test.ts covering bind validation (assertLocalhostBind/startHub), auth token generation entropy/shape, server.json mode 0600 + read, SQLi smoke through HTTP API, and token leakage assertions. Existing suites already cover rate limits/size limits + workspace discovery boundary; plugin isolation will be covered by upcoming plugin/derived-data test suites. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["security","tests"],"dependencies":[{"issue_id":"bd-16d.6.4","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.619505Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.5","title":"CI: matrix with FTS on/off","description":"Plan ref: Part X / Testing & CI.\\n\\nRun CI in both configurations (FTS available/unavailable) and ensure graceful fallback behavior is tested.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.647867Z","created_by":"cole","updated_at":"2026-02-05T16:31:45.499253Z","closed_at":"2026-02-05T16:31:45.499237Z","close_reason":"Added GitHub Actions workflow .github/workflows/ci.yml running bun install/typecheck/test in an FTS on/off matrix via AGENTCHAT_ENABLE_FTS=0/1. Hub startHub + integration harness now respect the env var (explicit option still wins). Verified bun test in both configs + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["ci"],"dependencies":[{"issue_id":"bd-16d.6.5","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.647867Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.6","title":"Edge cases: transaction and crash safety suite","description":"Plan ref: Part X / Edge case test suite (Transaction and crash safety).\\n\\nCover: disk full, lock timeout, WAL checkpoint failure, kill -9 during txn, corruption detection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.695005Z","created_by":"cole","updated_at":"2026-02-05T18:06:05.989114Z","closed_at":"2026-02-05T18:06:05.989087Z","close_reason":"Added deterministic transaction/crash safety suite: new kernel + hub crash-safety tests (busy_timeout/SQLITE_BUSY contention, WAL checkpoint behavior, transactional rollback invariants) plus hub DB error mapping (SQLITE_BUSY/SQLITE_FULL -> 503 SERVICE_UNAVAILABLE with Retry-After). Documented in CRASH_SAFETY_SUITE_SUMMARY.md. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","tests"],"dependencies":[{"issue_id":"bd-16d.6.6","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.695005Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.7","title":"Edge cases: WebSocket delivery guarantees suite","description":"Plan ref: Part X / Edge case test suite (WebSocket delivery guarantees).\\n\\nCover: disconnect mid-replay, boundary semantics, mid-batch failure, stale client pagination, clock skew, hub restart.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.737095Z","created_by":"cole","updated_at":"2026-02-05T16:45:43.157680Z","closed_at":"2026-02-05T16:45:43.157661Z","close_reason":"Added WS delivery guarantees suite (packages/hub/src/wsDelivery.test.ts + docs) covering disconnect mid-replay + resume, stable replay_until boundary (ADR-0003), mid-batch failure resume, stale-client large replay ordering/filtering, and hub restart resume (instance_id changes). bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","tests","ws"],"dependencies":[{"issue_id":"bd-16d.6.7","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.737095Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.8","title":"Edge cases: concurrent mutations suite","description":"Plan ref: Part X / Edge case test suite (Concurrent mutations).\\n\\nCover edit/edit races, expected_version conflicts, edit/delete races, retopic concurrency, idempotent delete, overflow handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.767010Z","created_by":"cole","updated_at":"2026-02-05T16:31:45.530938Z","closed_at":"2026-02-05T16:31:45.530917Z","close_reason":"Added deterministic concurrent mutation test suite (packages/kernel/src/concurrency.test.ts) covering edit/edit races, expected_version conflicts, edit/delete and retopic concurrency, idempotent delete, and size-limit/throughput stress. Added summary doc. bun test + typecheck green.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","tests"],"dependencies":[{"issue_id":"bd-16d.6.8","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.767010Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-16d.6.9","title":"Edge cases: plugin + derived data suite","description":"Plan ref: Part X / Edge case test suite (Plugin and derived data).\\n\\nCover ABA, TOCTOU, concurrent plugins, timeout, restart mid-plugin, version/content staleness guard.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T01:08:18.803896Z","created_by":"cole","updated_at":"2026-02-05T21:05:47.800848Z","closed_at":"2026-02-05T21:05:47.800832Z","close_reason":"Implemented dedicated plugin+derived edge-case suite (packages/hub/src/pluginDerived.edge.test.ts) covering ABA (content returns but version differs), concurrent pipelines (linkifier+extractor), derived-layer timeout behavior, restart/DB-closed simulation (no partial commits), concurrent extractor dedupe idempotency, and edit/delete staleness during execution. Verified: bun test + bun run typecheck.","source_repo":".","compaction_level":0,"original_size":0,"labels":["edge","plugins","tests"],"dependencies":[{"issue_id":"bd-16d.6.9","depends_on_id":"bd-16d.6","type":"parent-child","created_at":"2026-02-05T01:08:18.803896Z","created_by":"cole","metadata":"{}","thread_id":""}]}
{"id":"bd-1b2","title":"Hub WS: consistent subscription semantics (omit=all, empty=none)","description":"Fix WS subscription semantics so replay + live filtering agree.\n\nProposed contract:\n- If hello.subscriptions is omitted: subscribe to ALL events (no scope filter)\n- If hello.subscriptions is provided but both channels/topics are empty: subscribe to NONE (send hello_ok only; no replay/live)\n- Otherwise: filter by channel/topic ids as today\n\nAdd regression tests for empty vs omitted subscriptions (replay + live). Needed for agentchat listen default behavior.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-05T15:47:23.941166Z","created_by":"cole","updated_at":"2026-02-05T16:07:21.562181Z","closed_at":"2026-02-05T16:07:21.562110Z","close_reason":"Fixed WS subscription semantics so replay+live are consistent: omit hello.subscriptions => wildcard/all events; explicit empty subscriptions => none (hello_ok only). Implemented via null-vs-Set tracking in wsEndpoint and added regression tests for replay + live cases. bun test/typecheck green.","source_repo":".","compaction_level":0,"original_size":0}
